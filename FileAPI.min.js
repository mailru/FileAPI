/**!
 * FileAPI â€” a set of tools for working with files
 *
 * @author  RubaXa  <trash@rubaxa.org>
 * @build	lib/canvas-to-blob lib/FileAPI.core lib/FileAPI.Image lib/FileAPI.Form lib/FileAPI.XHR lib/FileAPI.Flash
 */
(function(a){var i=a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype,f;if(f=a.Blob)try{f=Boolean(new Blob)}catch(j){f=!1}var p=f;if(f=p)if(f=a.Uint8Array)try{f=100===(new Blob([new Uint8Array(100)])).size}catch(g){f=!1}var c=f,l=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder,q=(p||l)&&a.atob&&a.ArrayBuffer&&a.Uint8Array&&function(a){var q,g,f,m;q=0<=a.split(",")[0].indexOf("base64")?atob(a.split(",")[1]):decodeURIComponent(a.split(",")[1]);g=new ArrayBuffer(q.length);f=new Uint8Array(g);
for(m=0;m<q.length;m+=1)f[m]=q.charCodeAt(m);a=a.split(",")[0].split(":")[1].split(";")[0];if(p)return new Blob([c?f:g],{type:a});f=new l;f.append(g);return f.getBlob(a)};a.HTMLCanvasElement&&!i.toBlob&&(i.mozGetAsFile?i.toBlob=function(a,c){a(this.mozGetAsFile("blob",c))}:i.toDataURL&&q&&(i.toBlob=function(a,c){a(q(this.toDataURL(c)))}));"function"===typeof define&&define.amd?define(function(){return q}):a.dataURLtoBlob=q})(this);
(function(a,i){function f(b,s,a){if(b)if(e(b))for(var d=0,c=b.length;d<c;d++)d in b&&s.call(a,b[d],d,b);else for(d in b)b.hasOwnProperty(d)&&s.call(a,b[d],d,b)}function j(b,s,d){if(b){var a=h.uid(b);C[a]||(C[a]={});f(s.split(/\s+/),function(s){r?r.event.add(b,s,d):(C[a][s]||(C[a][s]=[]),C[a][s].push(d),b.addEventListener?b.addEventListener(s,d,!1):b.attachEvent?b.attachEvent("on"+s,d):b["on"+s]=d)})}}function p(b,s,d){if(b){var a=h.uid(b),c=C[a]||{};f(s.split(/\s+/),function(s){if(r)r.event.remove(b,
s,d);else{for(var a=c[s]||[],A=a.length;A--;)if(a[A]===d){a.splice(A,1);break}b.addEventListener?b.removeEventListener(s,d,!1):b.detachEvent?b.detachEvent("on"+s,d):b["on"+s]=null}})}}function g(b,s,d){j(b,s,function L(a){p(b,s,L);d(a)})}function c(b,s,d,a,c){b={type:d.type||d,target:b,result:a};h.extend(b,c);s(b)}function l(b,s,d,a){if(m){var e=new m;j(e,H,function N(d){var a=d.type;"progress"==a?c(b,s,d,d.target.result,{loaded:d.loaded,total:d.total}):"loadend"==a?(p(e,H,N),e=null):c(b,s,d,d.target.result)});
try{if(a)e["readAs"+d](a,b);else e["readAs"+d](b)}catch(n){c(b,s,"error",i,{error:n.toString()})}}else c(b,s,"error",i,{error:"filreader_not_support"})}function q(b,d){if(b)if(b.isFile)b.file(function(b){d(!1,[b])},function(){d("entry_file")});else if(b.isDirectory){var a=[];b.createReader().readEntries(function(b){h.afor(b,function(b,c){q(c,function(c,A){c||(a=a.concat(A));b?b():d(!1,a)})})},function(){d("directory_reader")})}else{var c=q,e;b.getAsEntry?e=b.getAsEntry():b.webkitGetAsEntry&&(e=b.webkitGetAsEntry());
c(e,d)}else d("empty_entry")}function e(b){return"object"==typeof b&&b&&"length"in b}var D=1,x=a.createObjectURL&&a||a.URL&&URL.revokeObjectURL&&URL||a.webkitURL&&webkitURL,z=a.File,m=a.FileReader,y=a.FormData,r=a.jQuery,F=(y=!(!z||!(m&&a.Uint8Array||y)))&&"withCredentials"in new XMLHttpRequest,w=y&&F,k=a.document,t=a.dataURLtoBlob,d={},n=/img/i,u=/canvas/i,J=/img|canvas/,E=/input/i,O=/^data:[^,]+,/,K=Math.pow,C={},G=[],H="abort progress error load loadend",P="status statusText readyState response responseXML responseText responseBody".split(" "),
h={build:2,debug:!1,staticPath:"./",KB:1024,MB:K(1024,2),GB:K(1024,3),TB:K(1024,4),expando:"fileapi"+ +new Date,uid:function(b){return b?b[h.expando]=b[h.expando]||h.uid():h.expando+ ++D},log:function(){h.debug&&(a.console&&console.log)&&(console.log.apply?console.log.apply(console,arguments):console.log([].join.call(arguments," ")))},getXHR:function(){var b;if(a.XMLHttpRequest)b=new XMLHttpRequest;else if(a.ActiveXObject)try{b=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(d){}return b},isArray:e,
support:{cors:F,html5:y,dataURI:!0},event:{on:j,off:p,one:g,fix:function(b){b.target||(b.target=a.event&&a.event.srcElement||k);3===b.target.nodeType&&(b.target=event.target.parentNode);return b}},throttle:function(b,d){var c,A,e;return function M(){A=arguments;e=!0;c||(e?(b.apply(a,A),e=!1,c=setTimeout(M,d)):c=null)}},F:function(){},parseJSON:function(b){return a.JSON&&JSON.parse?JSON.parse(b):(new Function("return ("+b.replace(/([\r\n])/g,"\\$1")+");"))()},trim:function(b){b=String(b);return b.trim?
b.trim():b.replace(/^\s+|\s+$/g,"")},queue:function(b){var d=0,a=0,c=!1,e=!1,n={inc:function(){a++},next:function(){d++;setTimeout(n.check,0)},check:function(){d>=a&&!c&&n.end()},isFail:function(){return c},fail:function(){!c&&b(c=!0)},end:function(){e||(e=!0,b())}};return n},each:f,afor:function(b,d){var a=0,c=b.length;e(b)&&c--?function v(){d(c!=a&&v,b[a],a++)}():d(!1)},extend:function(b){f(arguments,function(d){f(d,function(d,a){b[a]=d})});return b},isFile:function(b){return w&&b&&b instanceof
z},isCanvas:function(b){return b&&u.test(b.nodeName)},getFilesFilter:function(b){return(b="string"==typeof b?b:b.getAttribute&&b.getAttribute("accept")||"")?RegExp("("+b.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(b,d){h.isFile(b)?l(b,d,"DataURL"):h.isCanvas(b)?c(b,d,"load",h.toDataURL(b)):c(b,d,"error")},readAsBinaryString:function(b,d){h.isFile(b)?l(b,d,"BinaryString"):c(b,d,"error")},readAsArrayBuffer:function(b,d){h.isFile(b)?l(b,d,"ArrayBuffer"):c(b,d,"error")},
readAsText:function(b,d,a){a||(a=d,d="utf-8");h.isFile(b)?l(b,a,"Text",d):c(b,a,"error")},toDataURL:function(b){if("string"==typeof b)return b;if(b.toDataURL)return b.toDataURL("image/png")},toBinaryString:function(b){return a.atob(h.toDataURL(b).replace(O,""))},readAsImage:function(b,d,a){if(h.isFile(b))if(x){var e=x.createObjectURL(b);e===i?c(b,d,"error"):h.readAsImage(e,d,a)}else h.readAsDataURL(b,function(e){"load"==e.type?h.readAsImage(e.result,d,a):(a||"error"==e.type)&&c(b,d,e,null,{loaded:e.loaded,
total:e.total})});else h.isCanvas(b)?c(b,d,"load",b):n.test(b.nodeName)?b.complete?c(b,d,"load",b):g(b,"error abort load",function v(a){"load"==a.type&&x&&x.revokeObjectURL(b.src);p(b,"error abort load",v);c(b,d,a,b)}):b.iframe?c(b,d,{type:"error"}):(e=new Image,e.src=b.dataURL||b,h.readAsImage(e,d,a))},checkFileObj:function(b){var a={};"object"==typeof b?a=b:a.name=(b+"").split(/(\\|\/)/g).pop();a.type===i&&(a.type=a.name.split(".").pop());f(d,function(b,d){b.test(a.type)&&(a.type=d+"/"+a.type)});
return a},getDropFiles:function(b,d){var a=[],c=(b.originalEvent||b||"").dataTransfer||{},n=e(c.items),v=h.queue(function(){d(a)});f((n?c.items:c.files)||[],function(b){v.inc();if(n)q(b,function(b,d){!b&&a.push.apply(a,d);v.next()});else{var d=function(d){d&&a.push(b);v.next()};if(!b.type&&0==b.size%4096&&102400>=b.size)if(m)try{var c=new m;g(c,H,function(b){b="error"!=b.type;d(b);b&&c.abort()});c.readAsBinaryString(b)}catch(e){d(!1)}else d(null);else d(!0)}});v.check()},getFiles:function(b,d,a){var c=
[];if(a)return h.filterFiles(h.getFiles(b),d,a),null;b.jquery&&(b.each(function(){c=c.concat(h.getFiles(this))}),b=c,c=[]);"string"==typeof d&&(d=h.getFilesFilter(d));b.originalEvent&&(b=b.originalEvent);b.dataTransfer?b=b.dataTransfer:b.target&&(b=b.target);b.files?c=b.files:!w&&E.test(b&&b.tagName)?h.trim(b.value)&&(c=[h.checkFileObj(b.value)],c[0].blob=b,c[0].iframe=!0):e(b)&&(c=b);!d&&E.test(b&&b.tagName)&&(d=h.getFilesFilter(b));return h.filter(c,function(b){return!d||d.test(b.name)})},getInfo:function(b,
d){var a={},c=G.concat();h.isFile(b)?function v(){var e=c.shift();e?e.test(b.type)?e(b,function(b,c){b?d(b):(h.extend(a,c),v())}):v():d(!1,a)}():d("not_support",a)},addInfoReader:function(b,d){d.test=function(d){return b.test(d)};G.push(d)},addMime:function(b,a){d[b]=RegExp("("+a.replace(/,/g,"|")+")$","i")},filter:function(b,d){for(var a=[],c=0,e=b.length,n;c<e;c++)c in b&&(n=b[c],d.call(n,n,c,b)&&a.push(n));return a},filterFiles:function(b,d,a){if(b&&(w||b[0].id)){var c=b.concat(),e,n=[],q=[];(function I(){c.length?
(e=c.shift(),h.getInfo(e,function(b,a){(d(e,b?!1:a)?n:q).push(e);I()})):a(n,q)})()}else a(b,[])},upload:function(b){var b=h.extend({beforeupload:h.F,upload:h.F,fileupload:h.F,fileprogress:h.F,filecomplete:h.F,progress:h.F,complete:h.F},b),d=new h.XHR(b),a=this._getFilesDataArray(b.files),c=0,e=0,n=0,q=1;f(a,function(b){c+=b.size});d.total=c;d.loaded=0;b.beforeupload(d,b);(function I(){var g=a.shift(),k=this;d.currentFile=g;"abort"!=d.statusText&&g?this._getFormData(b,g,function(a){e||b.upload(d,b);
var B=g.file,u=new h.XHR(h.extend({},b,{upload:function(){b.fileupload(B,u,b)},progress:function(a){a.lengthComputable&&(n=e+=~~(c*q*(a.loaded/a.total)-n+0.5),b.fileprogress(a,B,u,b),b.progress({type:a.type,total:c,loaded:d.loaded=e,lengthComputable:!0},B,u,b))},complete:function(a){f(P,function(b){d[b]=u[b]});d.loaded=e+=e-n+~~(c*q+0.5);b.filecomplete(a,u,B,b);I.call(k)}}));q=g.size/c;d.abort=function(){u.abort()};u.send(a)}):b.complete(200==d.status?!1:d.statusText||"error",d,b)}).call(this);return d},
_getFilesDataArray:function(b){var d=[],a={};if(E.test(b&&b.tagName)){var c=h.getFiles(b);a[b.name||"file"]=null!==b.getAttribute("multiple")?c:c[0]}else e(b)&&E.test(b[0]&&b[0].tagName)?f(b,function(b){a[b.name||"file"]=h.getFiles(b)}):a=b;f(a,function v(b,a){e(b)?f(b,function(b,d){v(b,a+"["+d+"]")}):b&&b.name&&d.push({name:a,file:b,size:b.size})});return d},_getFormData:function(b,d,a){var c=d.file,e=d.name,n=c.name,q=c.type,g=(d=h.support.transform&&b.imageTransform)&&"number"==typeof(d.maxWidth||
d.minWidth||d.width),u=new h.Form,k=h.queue(function(){a(u)});d&&(/image/.test(c.type)||J.test(c.nodeType))?(k.inc(),g&&(d=[d]),h.Image.transform(c,d,function(d,a){g&&!d?(!t&&!h.flashEngine&&(a[0]=h.toBinaryString(a[0]),u.multipart=!0),u.append(e,a[0],n,q)):(d||(f(a,function(b,d){!t&&!h.flashEngine&&(b=h.toBinaryString(b),u.multipart=!0);u.append(e+"["+d+"]",b,n,q)}),e+="[original]"),(d||b.imageOriginal)&&u.append(e,c,n,q));k.next()})):u.append(e,c,n);f(b.data,function Q(b,d){"object"==typeof b?f(b,
function(b,a){Q(b,d+"["+a+"]")}):u.append(d,b)});k.check()},reset:function(b){var d,a;r?(a=r(b).clone(!0).insertBefore(b).val("")[0],r(b).remove()):(d=b.parentNode,a=d.insertBefore(b.cloneNode(!0),b),a.value="",d.removeChild(b),f(C[h.uid(b)],function(d,c){f(d,function(d){p(b,c,d);j(a,c,d)})}));return a},load:function(b,d){var a=h.getXHR();a?(a.open("GET",b,!0),a.overrideMimeType&&a.overrideMimeType("text/plain; charset=x-user-defined"),j(a,"progress",function(b){b.lengthComputable&&d({type:b.type,
loaded:b.loaded,total:b.total},a)}),a.onreadystatechange=function(){if(4==a.readyState)if(a.onreadystatechange=null,200==a.status){b=b.split("/");var c={name:b[b.length-1],size:a.getResponseHeader("Content-Length"),type:a.getResponseHeader("Content-Type")};c.dataURL="data:"+c.type+";base64,"+h.encode64(a.responseBody||a.responseText);d({type:"load",result:c})}else d({type:"error"})},a.send(null)):d({type:"error"});return a},encode64:function(b){var d="",a=0;for("string"!==typeof b&&(b=String(b));a<
b.length;){var c=b.charCodeAt(a++)&255,e=b.charCodeAt(a++)&255,n=b.charCodeAt(a++)&255,q=c>>2,c=(c&3)<<4|e>>4;isNaN(e)?e=n=64:(e=(e&15)<<2|n>>6,n=isNaN(n)?64:n&63);d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(q)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(n)}return d}};f({image:"png,jpg,jpeg,bmp,gif,ico,tif,tiff,tga,pcx,cbz,cbr",
audio:"m4a,flac,aac,rm,mpa,wav,wma,ogg,mp3,mp2,m3u,mod,amf,dmf,dsm,far,gdm,imf,it,m15,med,okt,s3m,stm,sfx,ult,uni,xm,sid,ac3,dts,cue,aif,aiff,wpl,ape,mac,mpc,mpp,shn,wv,nsf,spc,gym,adplug,adx,dsp,adp,ymf,ast,afc,hps,xsp",video:"m4v,3gp,nsv,ts,ty,strm,rm,rmvb,m3u,ifo,mov,qt,divx,xvid,bivx,vob,nrg,img,iso,pva,wmv,asf,asx,ogm,m2v,avi,bin,dat,dvr-ms,mpg,mpeg,mp4,mkv,avc,vp3,svq3,nuv,viv,dv,fli,flv,wpl"},function(b,d){h.addMime(d,b)});h.addInfoReader(/^image/,function(b,d){h.readAsImage(b,function(b){var a=
b.target;d("load"==b.type?!1:"error",{width:a.width,height:a.height})})});h.event.dnd=function(b,d,a){var c,e;a||(a=d,d=h.F);m?(j(b,"dragenter dragleave dragover",function(b){for(var a=((b.originalEvent||b||"").dataTransfer||{}).types,n=a&&a.length;n--;)~a[n].indexOf("File")&&(b.preventDefault(),e!==b.type&&(e=b.type,"dragleave"!=e&&d.call(b.currentTarget,!0,b),clearTimeout(c),c=setTimeout(function(){d.call(b.currentTarget,"dragleave"!=e,b)},50)))}),j(b,"drop",function(b){b.preventDefault();e=0;d.call(b.currentTarget,
!1,b);h.getDropFiles(b,function(d){a.call(b.currentTarget,d,b)})})):h.log("Drag'n'Drop -- not supported")};r&&!r.fn.dnd&&(r.fn.dnd=function(b,d){return this.each(function(){h.event.dnd(this,b,d)})});a.FileAPI=h.extend(h,a.FileAPI)})(window);
(function(a,i,f){function j(a,c){if(!(this instanceof j))return new j(a);this.data=a;this.better=!c;this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0}}var p=Math.min,g=Math.round,c=!1;try{c=-1<i.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")}catch(l){}j.prototype={constructor:j,set:function(c){a.extend(this.matrix,c);return this},crop:function(a,c,g,x){g===f&&(g=a,x=c,a=c=0);return this.set({sx:a,sy:c,sw:g,sh:x||g})},resize:function(a,c,g){"string"==typeof c&&
(g=c,c=a);return this.set({dw:a,dh:c,resize:g})},preview:function(a,c){return this.set({dw:a,dh:c||a,resize:"preview"})},rotate:function(a){return this.set({deg:a})},_load:function(c,e){var g=this;a.readAsImage(c,function(a){e.call(g,"load"!=a.type,a.result)})},_apply:function(a,c){var g=i.createElement("canvas"),f=this.getMatrix(a),j=g.getContext("2d"),m=f.deg,p=f.dw,r=f.dh,l=a.width,w=a.height,k,t=a;if(this.better)for(;2<Math.min(l/p,w/r);)l=~~(l/2+0.5),w=~~(w/2+0.5),k=i.createElement("canvas"),
k.width=l,k.height=w,t!==a?(k.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,l,w),t=k):(t=k,t.getContext("2d").drawImage(a,f.sx,f.sy,f.sw,f.sh,0,0,l,w),f.sx=f.sy=f.sw=f.sh=0);g.width=!(m%180)?p:r;g.height=m%180?p:r;j.rotate(m*Math.PI/180);j.drawImage(t,f.sx,f.sy,f.sw||t.width,f.sh||t.height,180==m||270==m?-p:0,90==m||180==m?-r:0,p,r);c.call(this,!1,g)},getMatrix:function(c){var e=a.extend({},this.matrix),f=e.sw=e.sw||c.width,c=e.sh=e.sh||c.height,j=e.dw=e.dw||e.sw,l=e.dh=e.dh||e.sh,m=f/c,i=
j/l,r=e.resize;if("preview"==r){if(j!=f||l!=c)if(i>=m?(m=f,r=m/i):(r=c,m=r*i),m!=f||r!=c)e.sx=~~((f-m)/2),e.sy=~~((c-r)/2),f=m,c=r}else r&&("min"==r?(j=g(m<i?p(f,j):l*m),l=g(m<i?j/m:p(c,l))):(j=g(m>=i?p(f,j):l*m),l=g(m>=i?j/m:p(c,l))));e.sw=f;e.sh=c;e.dw=j;e.dh=l;return e},get:function(c){a.support.transform?this._load(this.data,function(a,g){a?c(a):this._apply(g,c)}):c("not_support")},toData:function(a){this.get(a)}};j.transform=function(c,e,g){a.getInfo(c,function(f,l){var p={},i=a.queue(function(a){g(a,
p)});f?i.fail():a.each(e,function(a,e){if(!i.isFail()){var g=j(l.nodeType?l:c);if("function"==typeof a)a(l,g);else if(a.width)g[a.preview?"preview":"resize"](a.width,a.height,a.type);else a.maxWidth&&(l.width>a.maxWidth||l.height>a.maxHeight)&&g.resize(a.maxWidth,a.maxHeight,"max"),g.rotate(~~a.rotate);i.inc();g.toData(function(a,c){a?i.fail():(p[e]=c,i.next())})}})})};a.support.canvas=a.support.transform=c;a.Image=j})(FileAPI,document);
(function(a,i,f){var j=i.encodeURIComponent,p=i.FormData,i=function(){this.items=[]};i.prototype={append:function(a,c,f,j){this.items.push({name:a,blob:c&&c.blob||c,file:f||c.name,type:j||c.type})},each:function(a){for(var c=0,f=this.items.length;c<f;c++)a.call(this,this.items[c])},toData:function(g){a.support.html5?this.multipart?(a.log("FileAPI.Form.toMultipartData"),this.toMultipartData(g)):(a.log("FileAPI.Form.toFormData"),this.toFormData(g)):(a.log("tFileAPI.Form.toHtmlData"),this.toHtmlData(g))},
_to:function(g,c,f,j){var e=a.queue(function(){c(g)});this.each(function(a){f(a,g,e,j)});e.check()},toHtmlData:function(g){this._to(f.createDocumentFragment(),g,function(c,g){var j=c.blob,e;c.file?(a.reset(j),g.appendChild(j)):(e=f.createElement("input"),e.type="hidden",e.value=j,g.appendChild(e))})},toFormData:function(a){this._to(new p,a,function(a,g,f){a.file&&g.append("_"+a.name,a.file);a.blob.toBlob?(f.inc(),a.blob.toBlob(function(e){g.append(a.name,e,a.file);f.next()},"image/png")):a.file?g.append(a.name,
a.blob,a.file):g.append(a.name,a.blob)})},toMultipartData:function(g){this._to([],g,function(a,g,f,e){g.push("--_"+e+('\r\nContent-Disposition: form-data; name="'+a.name+'"'+(a.file?'; filename="'+j(a.file)+'"':"")+(a.file?"\r\nContent-Type: "+(a.type||"application/octet-stream"):"")+"\r\n\r\n"+(a.file?a.blob:j(a.blob))+"\r\n"))},a.expando)}};a.Form=i})(FileAPI,window,document);
(function(a){var i=function(){},f=function(f){this.uid=a.uid();this.xhr={abort:i,getResponseHeader:i,getAllResponseHeaders:i};this.options=f};f.prototype={status:0,statusText:"",getResponseHeader:function(a){return this.xhr.getResponseHeader(a)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(a,f){var g=this,c=g.options;g.abort=i;g.status=a;f&&(g.statusText=f);c.complete(200==a?!1:g.statusText||"unknown",g);g.xhr&&g.xhr.node&&setTimeout(function(){try{g.xhr.node.parentNode.removeChild(g.xhr.node)}catch(a){}g.xhr.node=
null;delete window[g.uid]},1)},abort:function(){this.end(0,"abort");this.xhr&&this.xhr.abort()},send:function(a){var f=this,g=this.options;a.toData(function(a){g.upload(g,f);f._send.call(f,g,a)})},_send:function(f,i){var g=this,c,l=g.uid;a.log("XHR._send:",i);if(i.nodeName){f.upload(f,g);c=document.createElement("div");c.innerHTML='<form target="'+l+'" action="'+f.url+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+
l+'" src="javascript:false;"></iframe><input value="'+l+'" name="callback" type="hidden"/></form>';g.xhr.abort=function(){var a=c.getElementsByName("iframe")[0];if(a)try{a.stop?a.stop():a.contentWindow.stop?a.contentWindow.stop():a.contentWindow.document.execCommand("Stop")}catch(f){}c=null};var q=c.getElementsByTagName("form")[0];q.appendChild(i);document.body.appendChild(c);this.xhr.node=c;window[l]=function(a,f,i){g.readyState=4;g.responseText=i;g.end(a,f);c=null};g.readyState=2;q.submit();q=null}else c=
g.xhr=a.getXHR(),c.open("POST",f.url,!0),c.withCredential="true",(!f.headers||!f.headers["X-Requested-With"])&&c.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.each(f.headers,function(a,f){c.setRequestHeader(f,a)}),c.upload&&c.upload.addEventListener("progress",a.throttle(function(a){f.progress(a,g,f)},100),!1),c.onreadystatechange=function(){g.status=c.status;g.statusText=c.statusText;g.readyState=c.readyState;if(4==c.readyState){for(var a in{"":1,XML:1,Text:1,Body:1})g["response"+a]=c["response"+
a];c.onreadystatechange=null;g.end(c.status);c=null}},a.isArray(i)?(c.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+a.expando),i=i.join("")+"--_"+a.expando+"--",c.sendAsBinary?c.sendAsBinary(i):(l=Array.prototype.map.call(i,function(a){return a.charCodeAt(0)&255}),c.send((new Uint8Array(l)).buffer))):c.send(i)}};a.XHR=f})(FileAPI);
(function(a,i,f){var j=a.support,p=i.navigator,g=p.mimeTypes,c=!1;if(p.plugins&&"object"==typeof p.plugins["Shockwave Flash"])c=p.plugins["Shockwave Flash"].description&&!(g&&g["application/x-shockwave-flash"]&&!g["application/x-shockwave-flash"].enabledPlugin);else try{c=!(!i.ActiveXObject||!new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(l){}j.flash=c;if(!a.support.cors&&a.support.flash){var q=function(a){return'<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="movie" value="#src#" /><param name="flashvars" value="#flashvars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="menu" value="false" /><param name="wmode" value="#wmode#" /><embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#"  width="100%" height="100%" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>'.replace(/#(\w+)#/ig,
function(c,f){return a[f]})},e=function(a,c){if(a&&a.style){var f,e;for(f in c){e=c[f];"number"==typeof e&&(e+="px");try{a.style[f]=e}catch(g){}}}},D=function(d,c){a.each(c,function(a,c){var f=d[c];d[c]=function(){this.parent=f;return a.apply(this,arguments)}})},x=function(d){var c=d.wid=a.uid();k._fn[c]=d;return"FileAPI.Flash._fn."+c},z=function(a){delete k._fn[a.wid]},m=function(a){if(!w.test(a)){if(/^\.\//.test(a)||"/"!=a.charAt(0))a=location.pathname+"/"+a.substr(RegExp.$1?2:0);"//"!=a.substr(0,
2)&&(a=location.hostname+"/"+a);w.test(a)||(a=location.protocol+"//"+a)}return a},y=a.uid(),r=0,F={},w=/^https?:/i,k={_fn:{},init:function(){var d=f.body&&f.body.firstChild;if(d){do if(1==d.nodeType){a.log("FlashAPI.Flash.inited");var c=f.createElement("div");e(c,{top:1,right:1,width:5,height:5,position:"absolute"});d.parentNode.insertBefore(c,d);k.pingUrl=k.pingUrl||location.protocol+"//"+location.host;k.publish(c,y);return}while(d=d.nextSibling)}10>r&&setTimeout(k.init,50*++r)},publish:function(d,
c){d.innerHTML=q({id:c,src:m(a.staticPath+"FileAPI.flash.swf?r="+a.build),wmode:"transparent",flashvars:"callback=FileAPI.Flash.event&flashId="+c+"&storeKey="+navigator.userAgent.match(/\d/ig).join("")+"_"+a.build+(k.isReady||!k.pingUrl?"":"&ping="+k.pingUrl)})},ready:function(){k.ready=a.F;k.isReady=!0;k.patch();a.event.on(f,"mouseover",k.mouseover);a.event.on(f,"click",function(a){k.mouseover(a)&&(a.preventDefault?a.preventDefault():a.returnValue=!0)})},getWrapper:function(a){do if(/js-fileapi-wrapper/.test(a.className))return a;
while((a=a.parentNode)&&a!==f.body)},mouseover:function(d){d=a.event.fix(d).target;if(/input/i.test(d.nodeName)&&"file"==d.type){var c=d.getAttribute(y);if("i"==c||"r"==c)return!1;if("p"!=c){d.setAttribute(y,"i");var c=f.createElement("div"),g=k.getWrapper(d);if(!g){a.log("flash.mouseover.error: js-fileapi-wrapper not found");return}e(c,{top:0,left:0,width:d.offsetWidth+100,height:d.offsetHeight+100,zIndex:"1000000",position:"absolute"});g.appendChild(c);k.publish(c,a.uid());d.setAttribute(y,"p")}return!0}},
event:function(d){var c=d.type;if("ready"==c){try{k.getInput(d.flashId).setAttribute(y,"r")}catch(f){}k.ready();setTimeout(function(){k.mouseenter(d)},50);return!0}"ping"===c?a.log("(flash -> js).ping:",[d.status,d.savedStatus],d.error):"log"===c?a.log("(flash -> js).log:",d.target):c in k&&setTimeout(function(){a.log("Flash.event."+d.type+":",d);k[c](d)},1)},mouseenter:function(a){var c=k.getInput(a.flashId);c&&(k.cmd(a,"multiple",null!==c.getAttribute("multiple")),k.cmd(a,"accept",(c.getAttribute("accept")||
"*").replace(/\./g,"")))},get:function(a){return f[a]||i[a]||f.embeds[a]},getInput:function(a){try{var c=k.getWrapper(k.get(a));if(c)return c.getElementsByTagName("input")[0]}catch(f){}},select:function(d){var c=k.getInput(d.flashId),e=a.uid(c),d=d.target.files;a.each(d,function(d){a.checkFileObj(d)});F[e]=d;f.createEvent?(e=f.createEvent("Event"),e.initEvent("change",!0,!1),c.dispatchEvent(e)):f.createEventObject&&(e=f.createEventObject(),c.fireEvent("onchange",e))},cmd:function(d,c,e,f){try{return a.log("(js -> flash)."+
c+":",e),k.get(d.flashId||d).cmd(c,e)}catch(g){a.log("(js -> flash).onError:",g),f||setTimeout(function(){k.cmd(d,c,e,!0)},50)}},patch:function(){a.flashEngine=a.support.transform=!0;D(a,{getFiles:function(d,c,e){if(e)return a.filterFiles(a.getFiles(d),c,e),null;var f=a.isArray(d)?d:F[a.uid(d.target||d.srcElement||d)];if(!f)return this.parent.apply(this,arguments);c&&(c=a.getFilesFilter(c),f=a.filter(f,function(a){return c.test(a.name)}));return f},getInfo:function(a,c){a&&!a.flashId?this.parent.apply(this,
arguments):a.info?c(!1,a.info):k.cmd(a,"getFileInfo",{id:a.id,callback:x(function J(e,f){z(J);c(e,a.info=f)})})}});a.support.transform=!0;D(FileAPI.Image.prototype,{_load:function(d,c){a.log("FileAPI.Image._load:",d);if(d&&!d.flashId)this.parent.apply(this,arguments);else{var e=this;a.getInfo(d,function(a){c.call(e,a,d)})}},_apply:function(d,c){a.log("FileAPI.Image._apply:",d);if(d&&!d.flashId)this.parent.apply(this,arguments);else{var g=this.getMatrix(d.info);k.cmd(d,"imageTransform",{id:d.id,matrix:g,
callback:x(function E(i,j){z(E);if(i)c(i);else if(!a.support.dataURI||3E4<j.length){var m={width:!(g.deg%180)?g.dw:g.dh,height:g.deg%180?g.dw:g.dh},l=c,p,r=a.uid(),h=f.createElement("ins");for(p in m)h.setAttribute("data-img-"+p,m[p]);e(h,m);h.innerHTML=q({id:r,src:a.staticPath+"FileAPI.flash.image.swf?r="+a.build,wmode:"opaque",flashvars:"callback="+x(function B(a){try{k.get(r).setImage(j),h=null,z(B)}catch(b){if(!a||"ready"==a.type)clearTimeout(p),p=setTimeout(B,50)}return!0})});l(!1,h)}else{var b=
new Image;b.src="data:"+d.type+";base64,"+j;a.event.one(b,"error abort load",function(a){c("load"!=a.type&&a.type,b);b=null})}})})}},toData:function(a){var c=this.data;c&&!c.flashId?this.parent.apply(this,arguments):a.call(this,!c.info,{id:c.id,flashId:c.flashId,name:c.name,type:c.type,matrix:this.getMatrix(c.info)})}});D(a.Form.prototype,{toData:function(c){for(var e=this.items,f=e.length;f--;)if(e[f].file&&e[f].blob&&!e[f].blob.flashId)return this.parent.apply(this,arguments);a.log("flash.Form.toData");
c(e)}});D(a.XHR.prototype,{_send:function(c,e){if(e.nodeName||e.append&&a.support.html5||a.isArray(e)&&"string"===typeof e[0])return this.parent.apply(this,arguments);var f={},g={},i=this,j,l;a.each(e,function(a){a.file?(g[a.name]=a=a.blob,l=a.id,j=a.flashId):f[a.name]=a.blob});a.log("flash.XHR._send:",j,l,g);this.xhr={headers:{},abort:function(){k.cmd(j,"abort",l)},getResponseHeader:function(a){return this.headers[a]},getAllResponseHeaders:function(){return this.headers}};k.cmd(j,"upload",{url:m(c.url),
data:f,files:g,headers:c.headers,callback:x(function G(e){var f=e.type,g=e.result;a.log("flash.upload."+f+":",e);if("progress"==f)e.loaded=Math.min(e.loaded,e.total),e.lengthComputable=!0,c.progress(e);else if("complete"==f)z(G),"string"==typeof g&&(i.responseText=g.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")),i.end(e.status||200);else if("abort"==f||"error"==f)i.end(0,e.message),z(G)})})}})}};a.Flash=k;var t=new Image;a.event.one(t,"error load",function(){a.support.dataURI=
!(1!=t.width||1!=t.height);t=null;k.init()});t.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}})(FileAPI,window,document);"undefined"!==typeof ajs&&ajs.loaded&&ajs.loaded("{fileapi}FileAPI.min");"function"===typeof define&&define.amd&&define("FileAPI",[],function(){return window.FileAPI||{}});