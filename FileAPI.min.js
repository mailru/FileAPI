/**!
 * FileAPI â€” a set of tools for working with files
 *
 * @author  RubaXa  <trash@rubaxa.org>
 * @build	lib/canvas-to-blob lib/FileAPI.core lib/FileAPI.Image lib/FileAPI.Form lib/FileAPI.XHR lib/FileAPI.Flash
 */
(function(a){var j=a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype,c;if(c=a.Blob)try{c=Boolean(new Blob)}catch(m){c=!1}var p=c;if(c=p)if(c=a.Uint8Array)try{c=100===(new Blob([new Uint8Array(100)])).size}catch(g){c=!1}var e=c,q=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder,f=(p||q)&&a.atob&&a.ArrayBuffer&&a.Uint8Array&&function(a){var f,g,c,n;f=0<=a.split(",")[0].indexOf("base64")?atob(a.split(",")[1]):decodeURIComponent(a.split(",")[1]);g=new ArrayBuffer(f.length);c=new Uint8Array(g);
for(n=0;n<f.length;n+=1)c[n]=f.charCodeAt(n);a=a.split(",")[0].split(":")[1].split(";")[0];if(p)return new Blob([e?c:g],{type:a});c=new q;c.append(g);return c.getBlob(a)};a.HTMLCanvasElement&&!j.toBlob&&(j.mozGetAsFile?j.toBlob=function(a,f){a(this.mozGetAsFile("blob",f))}:j.toDataURL&&f&&(j.toBlob=function(a,e){a(f(this.toDataURL(e)))}));"function"===typeof define&&define.amd?define(function(){return f}):a.dataURLtoBlob=f})(this);
(function(a,j){function c(b,l,a){if(b){var d=h.uid(b);A[d]||(A[d]={});h.each(l.split(/\s+/),function(l){r?r.event.add(b,l,a):(A[d][l]||(A[d][l]=[]),A[d][l].push(a),b.addEventListener?b.addEventListener(l,a,!1):b.attachEvent?b.attachEvent("on"+l,a):b["on"+l]=a)})}}function m(b,l,a){if(b){var d=h.uid(b),f=A[d]||{};h.each(l.split(/\s+/),function(l){if(r)r.event.remove(b,l,a);else{for(var d=f[l]||[],i=d.length;i--;)if(d[i]===a){d.splice(i,1);break}b.addEventListener?b.removeEventListener(l,a,!1):b.detachEvent?
b.detachEvent("on"+l,a):b["on"+l]=null}})}}function p(b,l,a){c(b,l,function J(d){m(b,l,J);a(d)})}function g(b,l,a,d,f){b={type:a.type||a,target:b,result:d};h.extend(b,f);l(b)}function e(b,l,a){if(w){var d=new w;c(d,F,function D(a){var H=a.type;"progress"==H?g(b,l,a,a.target.result,{loaded:a.loaded,total:a.total}):"loadend"==H?(m(d,F,D),d=null):g(b,l,a,a.target.result)});try{d["readAs"+a](b)}catch(h){g(b,l,"error",j,{error:h.toString()})}}else g(b,l,"error",j,{error:"FileReader is not supported"})}
function q(b,l){if(b)if(b.isFile)b.file(function(b){l(!1,[b])},function(){l("entry_file")});else if(b.isDirectory){var a=[];b.createReader().readEntries(function(b){h.afor(b,function(b,d){q(d,function(d,i){d||(a=a.concat(i));b?b():l(!1,a)})})},function(){l("directory_reader")})}else{var d=q,f;b.getAsEntry?f=b.getAsEntry():b.webkitGetAsEntry&&(f=b.webkitGetAsEntry());d(f,l)}else l("empty_entry")}function f(b){return"object"==typeof b&&b&&"length"in b}var v=1,z=a.createObjectURL&&a||a.URL&&URL.revokeObjectURL&&
URL||a.webkitURL&&webkitURL,y=a.File,w=a.FileReader,n=a.FormData,r=a.jQuery,s=!(!y||!(w&&a.Uint8Array||n)),E=a.document,x=a.dataURLtoBlob,k={},t=/img/i,d=/canvas/i,u=/img|canvas/,C=/input/i,G=/^data:[^,]+,/,n=Math.pow,A={},I=[],F="abort progress error load loadend",h={build:2,debug:!1,staticPath:"./",KB:1024,MB:n(1024,2),GB:n(1024,3),TB:n(1024,4),expando:"fileapi"+ +new Date,uid:function(b){return b?b[h.expando]=b[h.expando]||h.uid():h.expando+ ++v},log:function(){h.debug&&(a.console&&console.log)&&
(console.log.apply?console.log.apply(console,arguments):console.log([].join.call(arguments," ")))},getXHR:function(){var b;if(a.XMLHttpRequest)b=new XMLHttpRequest;else if(a.ActiveXObject)try{b=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(l){}return b},isArray:f,support:{html5:s,dataURI:!0},event:{on:c,off:m,one:p,fix:function(b){b.target||(b.target=a.event&&a.event.srcElement||E);3===b.target.nodeType&&(b.target=event.target.parentNode);return b}},throttle:function(b,l){var d,i,h;return function D(){i=
arguments;h=!0;d||(h?(b.apply(a,i),h=!1,d=setTimeout(D,l)):d=null)}},F:function(b){return b},parseJSON:function(b){return a.JSON&&JSON.parse?JSON.parse(b):(new Function("return ("+b.replace(/([\r\n])/g,"\\$1")+");"))()},trim:function(b){b=String(b);return b.trim?b.trim():b.replace(/^\s+|\s+$/g,"")},queue:function(b){var a=0,d=0,i=!1,h=!1,f={inc:function(){d++},next:function(){a++;setTimeout(f.check,0)},check:function(){a>=d&&!i&&f.end()},isFail:function(){return i},fail:function(){!i&&b(i=!0)},end:function(){h||
(h=!0,b())}};return f},each:function(b,a,d){if(b)if(b.forEach)b.forEach(a,d);else if(f(b))for(var i=0,h=b.length;i<h;i++)i in b&&a.call(d,b[i],i,b);else for(i in b)b.hasOwnProperty(i)&&a.call(d,b[i],i,b)},afor:function(b,a){var d=0,i=b.length;f(b)&&i--?function B(){a(i!=d&&B,b[d],d++)}():a(!1)},extend:function(b){h.each(arguments,function(a){h.each(a,function(a,d){b[d]=a})});return b},isFile:function(b){return s&&b&&b instanceof y},isCanvas:function(b){return b&&d.test(b.nodeName)},getFilesFilter:function(b){return(b=
"string"==typeof b?b:b.getAttribute&&b.getAttribute("accept")||"")?RegExp("("+b.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(b,a){h.isFile(b)?e(b,a,"DataURL"):h.isCanvas(b)?g(b,a,"load",h.toDataURL(b)):g(b,a,"error")},readAsBinaryString:function(b,a){h.isFile(b)?e(b,a,"BinaryString"):g(b,a,"error")},toDataURL:function(b){if("string"==typeof b)return b;if(b.toDataURL)return b.toDataURL("image/png")},toBinaryString:function(b){return a.atob(h.toDataURL(b).replace(G,""))},
readAsImage:function(b,a,d){if(h.isFile(b))if(z){var i=z.createObjectURL(b);i===j?g(b,a,"error"):h.readAsImage(i,a,d)}else h.readAsDataURL(b,function(i){"load"==i.type?h.readAsImage(i.result,a,d):(d||"error"==i.type)&&g(b,a,i,null,{loaded:i.loaded,total:i.total})});else h.isCanvas(b)?g(b,a,"load",b):t.test(b.nodeName)?b.complete?g(b,a,"load",b):p(b,"error abort load",function B(d){"load"==d.type&&z&&z.revokeObjectURL(b.src);m(b,"error abort load",B);g(b,a,d,b)}):b.iframe?g(b,a,{type:"error"}):(i=
new Image,i.src=b.dataURL||b,h.readAsImage(i,a,d))},checkFileObj:function(b){var a={};"object"==typeof b?a=b:a.name=(b+"").split(/(\\|\/)/g).pop();a.type===j&&(a.type=a.name.split(".").pop());h.each(k,function(b,d){b.test(a.type)&&(a.type=d+"/"+a.type)});return a},getDropFiles:function(b,a){var d=[],i=(b.originalEvent||b||"").dataTransfer||{},e=f(i.items),u=h.queue(function(){a(d)});h.each((e?i.items:i.files)||[],function(b){u.inc();if(e)q(b,function(b,a){!b&&d.push.apply(d,a);u.next()});else{var a=
function(a){a&&d.push(b);u.next()};if(!b.type&&0==b.size%4096&&102400>=b.size)if(w)try{var l=new w;p(l,F,function(b){b="error"!=b.type;a(b);b&&l.abort()});l.readAsBinaryString(b)}catch(i){a(!1)}else a(null);else a(!0)}});u.check()},getFiles:function(b,a,d){var i=[];if(d)return h.filterFiles(h.getFiles(b),a,d),null;b.jquery&&(b.each(function(){i=i.concat(h.getFiles(this))}),b=i,i=[]);"string"==typeof a&&(a=h.getFilesFilter(a));b.originalEvent&&(b=b.originalEvent);b.dataTransfer?b=b.dataTransfer:b.target&&
(b=b.target);b.files?i=b.files:!s&&C.test(b&&b.tagName)?h.trim(b.value)&&(i=[h.checkFileObj(b.value)],i[0].blob=b,i[0].iframe=!0):f(b)&&(i=b);!a&&C.test(b&&b.tagName)&&(a=h.getFilesFilter(b));return h.filter(i,function(b){return!a||a.test(b.name)})},getInfo:function(b,a){var d={},i=I.concat();h.isFile(b)?function B(){var f=i.shift();f?f.test(b.type)?f(b,function(b,i){b?a(b):(h.extend(d,i),B())}):B():a(!1,d)}():a("not_support",d)},addInfoReader:function(b,a){a.test=function(a){return b.test(a)};I.push(a)},
addMime:function(b,a){k[b]=RegExp("("+a.replace(/,/g,"|")+")$","i")},filter:function(b,a){for(var d=[],i=0,h=b.length,f;i<h;i++)i in b&&(f=b[i],a.call(f,f,i,b)&&d.push(f));return d},filterFiles:function(b,a,d){if(b&&(s||b[0].id)){var i=b.concat(),f,e=[],u=[];(function L(){i.length?(f=i.shift(),h.getInfo(f,function(b,d){(a(f,b?!1:d)?e:u).push(f);L()})):d(e,u)})()}else d(b,[])},upload:function(b){var b=h.extend({beforeupload:h.F,upload:h.F,fileupload:h.F,fileprogress:h.F,filecomplete:h.F,progress:h.F,
complete:h.F},b),a=new h.XHR(b),d=this._getFilesDataArray(b.files),i=0,f=0,e=0;h.each(d,function(b){i+=b.size});b.total=i;b.loaded=f;b.beforeupload(a,b);(function K(){var u=d.shift(),g=this;"abort"!=a.statusText&&u?this._getFormData(b,u,function(d){f||b.upload(a,b);var v=new h.XHR(h.extend({},b,{upload:function(){b.fileupload(v,b)},progress:function(a){a.lengthComputable&&(e=f+=~~(i*u.part*(a.loaded/a.total)-e+0.5),b.fileprogress(a,v),b.progress({type:a.type,total:i,loaded:b.loaded=f,lengthComputable:!0}))},
complete:function(d){h.extend(a,v);b.loaded=f+=f-e+~~(i*u.part+0.5);b.filecomplete(d,v);K.call(g)}}));u.part=u.size/i;v.send(d);a.abort=function(){v.abort()}}):b.complete(200==a.status?!1:a.statusText||"error",a)}).call(this);return a},_getFilesDataArray:function(b){var a=[],d={};if(C.test(b&&b.tagName)){var i=h.getFiles(b);d[b.name||"file"]=null!==b.getAttribute("multiple")?i:i[0]}else f(b)&&C.test(b[0]&&b[0].tagName)?h.each(b,function(b){d[b.name||"file"]=h.getFiles(b)}):d=b;h.each(d,function B(b,
d){f(b)?h.each(b,function(b,a){B(b,d+"["+a+"]")}):b&&b.name&&a.push({name:d,file:b,size:b.size})});return a},_getFormData:function(b,a,d){var f=a.file,e=a.name,v=f.name,g=f.type,C=(a=h.support.transform&&b.imageTransform)&&"number"==typeof(a.maxWidth||a.minWidth||a.width),c=new h.Form,k=h.queue(function(){d(c)});a&&(/image/.test(f.type)||u.test(f.nodeType))?(k.inc(),C&&(a=[a]),h.Image.transform(f,a,function(a,d){C&&!a?(!x&&!h.flashEngine&&(d[0]=h.toBinaryString(d[0]),c.multipart=!0),c.append(e,d[0],
v,g)):(a||(h.each(d,function(b,a){!x&&!h.flashEngine&&(b=h.toBinaryString(b),c.multipart=!0);c.append(e+"["+a+"]",b,v,g)}),e+="[original]"),(a||b.imageOriginal)&&c.append(e,f,v,g));k.next()})):c.append(e,f,v);h.each(b.data,function M(b,a){"object"==typeof b?h.each(b,function(b,d){M(b,a+"["+d+"]")}):c.append(a,b)});k.check()},reset:function(b){var a,d;r?(d=r(b).clone(!0).insertBefore(b).val("")[0],r(b).remove()):(a=b.parentNode,d=a.insertBefore(b.cloneNode(!0),b),d.value="",a.removeChild(b),h.each(A[h.uid(b)],
function(a,f){h.each(a,function(a){m(b,f,a);c(d,f,a)})}));return d},load:function(b,a){var d=h.getXHR();d?(d.open("GET",b,!0),d.overrideMimeType&&d.overrideMimeType("text/plain; charset=x-user-defined"),c(d,"progress",function(b){b.lengthComputable&&a({type:b.type,loaded:b.loaded,total:b.total},d)}),d.onreadystatechange=function(){if(4==d.readyState)if(d.onreadystatechange=null,200==d.status){b=b.split("/");var f={name:b[b.length-1],size:d.getResponseHeader("Content-Length"),type:d.getResponseHeader("Content-Type")};
f.dataURL="data:"+f.type+";base64,"+h.encode64(d.responseBody||d.responseText);a({type:"load",result:f})}else a({type:"error"})},d.send(null)):a({type:"error"});return d},encode64:function(b){var a="",d=0;for("string"!==typeof b&&(b=String(b));d<b.length;){var f=b.charCodeAt(d++)&255,h=b.charCodeAt(d++)&255,e=b.charCodeAt(d++)&255,u=f>>2,f=(f&3)<<4|h>>4;isNaN(h)?h=e=64:(h=(h&15)<<2|e>>6,e=isNaN(e)?64:e&63);a+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(u)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)}return a}};h.each({image:"png,jpg,jpeg,bmp,gif,ico,tif,tiff,tga,pcx,cbz,cbr",audio:"m4a,flac,aac,rm,mpa,wav,wma,ogg,mp3,mp2,m3u,mod,amf,dmf,dsm,far,gdm,imf,it,m15,med,okt,s3m,stm,sfx,ult,uni,xm,sid,ac3,dts,cue,aif,aiff,wpl,ape,mac,mpc,mpp,shn,wv,nsf,spc,gym,adplug,adx,dsp,adp,ymf,ast,afc,hps,xsp",video:"m4v,3gp,nsv,ts,ty,strm,rm,rmvb,m3u,ifo,mov,qt,divx,xvid,bivx,vob,nrg,img,iso,pva,wmv,asf,asx,ogm,m2v,avi,bin,dat,dvr-ms,mpg,mpeg,mp4,mkv,avc,vp3,svq3,nuv,viv,dv,fli,flv,wpl"},
function(b,a){h.addMime(a,b)});h.addInfoReader(/^image/,function(b,a){h.readAsImage(b,function(b){var d=b.target;a("load"==b.type?!1:"error",{width:d.width,height:d.height})})});h.event.dnd=function(b,a,d){var f,e;w?(c(b,"dragenter dragleave dragover",function(b){for(var d=((b.originalEvent||b||"").dataTransfer||{}).types,h=d&&d.length;h--;)~d[h].indexOf("File")&&(b.preventDefault(),e!==b.type&&(e=b.type,"dragleave"!=e&&a.call(b.currentTarget,!0,b),clearTimeout(f),f=setTimeout(function(){a.call(b.currentTarget,
"dragleave"!=e,b)},50)))}),c(b,"drop",function(b){b.preventDefault();a.call(b.currentTarget,!1,b);h.getDropFiles(b,function(a){d.call(b.currentTarget,a,b)})})):h.log("Drag'n'Drop -- not supported")};r&&!r.fn.dnd&&(r.fn.dnd=function(b,a){return this.each(function(){h.event.dnd(this,b,a)})});a.FileAPI=h.extend(h,a.FileAPI)})(window);
(function(a,j,c){function m(a,e){if(!(this instanceof m))return new m(a);this.data=a;this.better=!e;this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0}}var p=Math.min,g=Math.round,e=!1;try{e=-1<j.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")}catch(q){}m.prototype={constructor:m,set:function(f){a.extend(this.matrix,f);return this},crop:function(a,e,g,y){g===c&&(g=a,y=e,a=e=0);return this.set({sx:a,sy:e,sw:g,sh:y||g})},resize:function(a,e,g){"string"==typeof e&&
(g=e,e=a);return this.set({dw:a,dh:e,resize:g})},preview:function(a,e){return this.set({dw:a,dh:e||a,resize:"preview"})},rotate:function(a){return this.set({deg:a})},_load:function(f,e){var g=this;a.readAsImage(f,function(a){e.call(g,"load"!=a.type,a.result)})},_apply:function(a,e){var g=j.createElement("canvas"),c=this.getMatrix(a),m=g.getContext("2d"),n=c.deg,p=c.dw,s=c.dh,q=a.width,x=a.height,k,t=a;if(this.better)for(;2<Math.min(q/p,x/s);)q=~~(q/2+0.5),x=~~(x/2+0.5),k=j.createElement("canvas"),
k.width=q,k.height=x,t!==a?(k.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,q,x),t=k):(t=k,t.getContext("2d").drawImage(a,c.sx,c.sy,c.sw,c.sh,0,0,q,x),c.sx=c.sy=c.sw=c.sh=0);g.width=!(n%180)?p:s;g.height=n%180?p:s;m.rotate(n*Math.PI/180);m.drawImage(t,c.sx,c.sy,c.sw||t.width,c.sh||t.height,180==n||270==n?-p:0,90==n||180==n?-s:0,p,s);e.call(this,!1,g)},getMatrix:function(e){var c=a.extend({},this.matrix),m=c.sw=c.sw||e.width,e=c.sh=c.sh||e.height,q=c.dw=c.dw||c.sw,j=c.dh=c.dh||c.sh,n=m/e,r=
q/j,s=c.resize;if("preview"==s){if(q!=m||j!=e)if(r>=n?(n=m,s=n/r):(s=e,n=s*r),n!=m||s!=e)c.sx=~~((m-n)/2),c.sy=~~((e-s)/2),m=n,e=s}else s&&("min"==s?(q=g(n<r?p(m,q):j*n),j=g(n<r?q/n:p(e,j))):(q=g(n>=r?p(m,q):j*n),j=g(n>=r?q/n:p(e,j))));c.sw=m;c.sh=e;c.dw=q;c.dh=j;return c},get:function(e){a.support.transform?this._load(this.data,function(a,g){a?e(a):this._apply(g,e)}):e("not_support")},toData:function(a){this.get(a)}};m.transform=function(e,g,c){a.getInfo(e,function(q,p){var n={},j=a.queue(function(a){c(a,
n)});q?j.fail():a.each(g,function(a,g){if(!j.isFail()){var c=m(p.nodeType?p:e);if("function"==typeof a)a(p,c);else if(a.width)c[a.preview?"preview":"resize"](a.width,a.height,a.type);else a.maxWidth&&(p.width>a.maxWidth||p.height>a.maxHeight)&&c.resize(a.maxWidth,a.maxHeight,"max"),c.rotate(~~a.rotate);j.inc();c.toData(function(a,e){a?j.fail():(n[g]=e,j.next())})}})})};a.support.canvas=a.support.transform=e;a.Image=m})(FileAPI,document);
(function(a,j,c){var m=j.encodeURIComponent,p=j.FormData,j=function(){this.items=[]};j.prototype={append:function(a,e,c,f){this.items.push({name:a,blob:e&&e.blob||e,file:c||e.name,type:f||e.type})},each:function(a){for(var e=0,c=this.items.length;e<c;e++)a.call(this,this.items[e])},toData:function(c){a.support.html5?this.multipart?(a.log("FileAPI.Form.toMultipartData"),this.toMultipartData(c)):(a.log("FileAPI.Form.toFormData"),this.toFormData(c)):(a.log("tFileAPI.Form.toHtmlData"),this.toHtmlData(c))},
_to:function(c,e,m,f){var p=a.queue(function(){e(c)});this.each(function(a){m(a,c,p,f)});p.check()},toHtmlData:function(g){this._to(c.createDocumentFragment(),g,function(e,g){var f=e.blob,m;e.file?(a.reset(f),g.appendChild(f)):(m=c.createElement("input"),m.type="hidden",m.value=f,g.appendChild(m))})},toFormData:function(a){this._to(new p,a,function(a,c,f){a.file&&c.append("_"+a.name,a.file);a.blob.toBlob?(f.inc(),a.blob.toBlob(function(g){c.append(a.name,g,a.file);f.next()},"image/png")):a.file?c.append(a.name,
a.blob,a.file):c.append(a.name,a.blob)})},toMultipartData:function(c){this._to([],c,function(a,c,f,g){c.push("--_"+g+('\r\nContent-Disposition: form-data; name="'+a.name+'"'+(a.file?'; filename="'+m(a.file)+'"':"")+(a.file?"\r\nContent-Type: "+(a.type||"application/octet-stream"):"")+"\r\n\r\n"+(a.file?a.blob:m(a.blob))+"\r\n"))},a.expando)}};a.Form=j})(FileAPI,this,document);
(function(a){var j=function(){},c=function(c){this.uid=a.uid();this.xhr={abort:j,getResponseHeader:j,getAllResponseHeaders:j};this.options=c};c.prototype={status:0,statusText:"",getResponseHeader:function(a){return this.xhr.getResponseHeader(a)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(a,c){var g=this,e=g.options;g.abort=j;g.status=a;c&&(g.statusText=c);e.complete(200==a?!1:g.statusText||"unknown",g);g.xhr&&g.xhr.node&&setTimeout(function(){try{g.xhr.node.parentNode.removeChild(g.xhr.node)}catch(a){}g.xhr.node=
null;delete window[g.uid]},1)},abort:function(){this.end(0,"abort");this.xhr&&this.xhr.abort()},send:function(a){var c=this,g=this.options;a.toData(function(a){g.upload(g,c);c._send.call(c,g,a)})},_send:function(c,j){var g=this,e,q=g.uid;a.log("XHR._send:",j);if(j.nodeName){c.upload(c,g);e=document.createElement("div");e.innerHTML='<form target="'+q+'" action="'+c.url+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+
q+'" src="javascript:false;"></iframe><input value="'+q+'" name="callback" type="hidden"/></form>';g.xhr.abort=function(){var a=e.getElementsByName("iframe")[0];if(a)try{a.stop?a.stop():a.contentWindow.stop?a.contentWindow.stop():a.contentWindow.document.execCommand("Stop")}catch(c){}e=null};var f=e.getElementsByTagName("form")[0];f.appendChild(j);document.body.appendChild(e);this.xhr.node=e;window[q]=function(a,c,f){g.readyState=4;g.responseText=f;g.end(a,c);e=null};g.readyState=2;f.submit();f=null}else{e=
g.xhr=a.getXHR();e.open("POST",c.url,!0);e.withCredential="true";(!c.headers||!c.headers["X-Requested-With"])&&e.setRequestHeader("X-Requested-With","XMLHttpRequest");a.each(c.headers,function(a,c){e.setRequestHeader(c,a)});if(e.upload)a.event.on(e.upload,"progress",a.throttle(function(a){c.progress(a,c,g)},100));e.onreadystatechange=function(){g.status=e.status;g.statusText=e.statusText;g.readyState=e.readyState;if(4==e.readyState){for(var a in{"":1,XML:1,Text:1,Body:1})g["response"+a]=e["response"+
a];e.onreadystatechange=null;g.end(e.status);e=null}};a.isArray(j)?(e.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+a.expando),j=j.join("")+"--_"+a.expando+"--",e.sendAsBinary?e.sendAsBinary(j):(q=Array.prototype.map.call(j,function(a){return a.charCodeAt(0)&255}),e.send((new Uint8Array(q)).buffer))):e.send(j)}}};a.XHR=c})(FileAPI);
(function(a,j,c){var m=a.support,p=j.navigator,g=p.mimeTypes,e=!1;if(p.plugins&&"object"==typeof p.plugins["Shockwave Flash"])e=p.plugins["Shockwave Flash"].description&&!(g&&g["application/x-shockwave-flash"]&&!g["application/x-shockwave-flash"].enabledPlugin);else try{e=!(!j.ActiveXObject||!new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(q){}m.flash=e;if(!a.support.html5&&a.support.flash){var f=function(a){return'<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="movie" value="#src#" /><param name="flashvars" value="#flashvars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="menu" value="false" /><param name="wmode" value="#wmode#" /><embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#"  width="100%" height="100%" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>'.replace(/#(\w+)#/ig,
function(c,e){return a[e]})},v=function(a,c){if(a&&a.style){var e,f;for(e in c){f=c[e];"number"==typeof f&&(f+="px");try{a.style[e]=f}catch(g){}}}},z=function(d,c){a.each(c,function(a,c){var e=d[c];d[c]=function(){this.parent=e;return a.apply(this,arguments)}})},y=function(d){var c=d.wid=a.uid();k._fn[c]=d;return"FileAPI.Flash._fn."+c},w=function(a){delete k._fn[a.wid]},n=function(a){if(!x.test(a)){if(/^\.\//.test(a)||"/"!=a.charAt(0))a=location.pathname+"/"+a.substr(RegExp.$1?2:0);"//"!=a.substr(0,
2)&&(a=location.hostname+"/"+a);x.test(a)||(a=location.protocol+"//"+a)}return a},r=a.uid(),s=0,E={},x=/^https?:/i,k={_fn:{},init:function(){var d=c.body&&c.body.firstChild;if(d){do if(1==d.nodeType){a.log("FlashAPI.Flash.inited");var e=c.createElement("div");v(e,{top:1,right:1,width:5,height:5,position:"absolute"});d.parentNode.insertBefore(e,d);k.pingUrl=k.pingUrl||location.protocol+"//"+location.host;k.publish(e,r);return}while(d=d.nextSibling)}10>s&&setTimeout(k.init,50*++s)},publish:function(d,
c){d.innerHTML=f({id:c,src:n(a.staticPath+"FileAPI.flash.swf?r="+a.build),wmode:"transparent",flashvars:"callback=FileAPI.Flash.event&flashId="+c+"&storeKey="+navigator.userAgent.match(/\d/ig).join("")+"_"+a.build+(k.isReady||!k.pingUrl?"":"&ping="+k.pingUrl)})},ready:function(){k.ready=a.F;k.isReady=!0;k.patch();a.event.on(c,"mouseover",k.mouseover);a.event.on(c,"click",function(a){k.mouseover(a)&&(a.preventDefault?a.preventDefault():a.returnValue=!0)})},getWrapper:function(a){do if(/js-fileapi-wrapper/.test(a.className))return a;
while((a=a.parentNode)&&a!==c.body)},mouseover:function(d){d=a.event.fix(d).target;if(/input/i.test(d.nodeName)&&"file"==d.type){var e=d.getAttribute(r);if("n"==e)return!1;if("y"!=e){d.setAttribute(r,"n");var e=c.createElement("div"),f=k.getWrapper(d);if(!f){a.log("flash.mouseover.error: js-fileapi-wrapper not found");return}v(e,{top:0,left:0,width:d.offsetWidth+100,height:d.offsetHeight+100,position:"absolute"});f.appendChild(e);k.publish(e,a.uid());d.setAttribute(r,"y")}return!0}},event:function(d){var c=
d.type;if("ready"==c)return a.log("Flash.event."+d.type+":",d),k.ready(),setTimeout(function(){k.mouseenter(d)},50),!0;"ping"===c?a.log("(flash -> js).ping:",[d.status,d.savedStatus],d.error):"log"===c?a.log("(flash -> js).log:",d.target):c in k&&setTimeout(function(){a.log("Flash.event."+d.type+":",d);k[c](d)},1)},mouseenter:function(a){var c=k.getInput(a.flashId);c&&(k.cmd(a,"multiple",null!==c.getAttribute("multiple")),k.cmd(a,"accept",(c.getAttribute("accept")||"*").replace(/\./g,"")))},get:function(a){return c[a]||
j[a]||c.embeds[a]},getInput:function(a){try{var c=k.getWrapper(k.get(a));if(c)return c.getElementsByTagName("input")[0]}catch(e){}},select:function(d){var e=k.getInput(d.flashId),f=a.uid(e),d=d.target.files;a.each(d,function(d){a.checkFileObj(d)});E[f]=d;c.createEvent?(f=c.createEvent("Event"),f.initEvent("change",!0,!1),e.dispatchEvent(f)):c.createEventObject&&(f=c.createEventObject(),e.fireEvent("onchange",f))},cmd:function(d,c,e,f){try{return a.log("(js -> flash)."+c+":",e),k.get(d.flashId||d).cmd(c,
e)}catch(g){a.log("(js -> flash).onError:",g),f||setTimeout(function(){k.cmd(d,c,e,!0)},50)}},patch:function(){a.flashEngine=a.support.transform=!0;z(a,{getFiles:function(d,c,e){if(e)return a.filterFiles(a.getFiles(d),c,e),null;var f=a.isArray(d)?d:E[a.uid(d.target||d.srcElement||d)];if(!f)return this.parent.apply(this,arguments);c&&(c=a.getFilesFilter(c),f=a.filter(f,function(a){return c.test(a.name)}));return f},getInfo:function(a,c){a&&!a.flashId?this.parent.apply(this,arguments):a.info?c(!1,a.info):
k.cmd(a,"getFileInfo",{id:a.id,callback:y(function G(e,f){w(G);c(e,a.info=f)})})}});a.support.transform=!0;z(FileAPI.Image.prototype,{_load:function(d,c){a.log("FileAPI.Image._load:",d);if(d&&!d.flashId)this.parent.apply(this,arguments);else{var e=this;a.getInfo(d,function(a){c.call(e,a,d)})}},_apply:function(d,e){a.log("FileAPI.Image._apply:",d);if(d&&!d.flashId)this.parent.apply(this,arguments);else{var g=this.getMatrix(d.info);k.cmd(d,"imageTransform",{id:d.id,matrix:g,callback:y(function A(j,
n){w(A);if(j)e(j);else if(!a.support.dataURI||3E4<n.length){var h={width:!(g.deg%180)?g.dw:g.dh,height:g.deg%180?g.dw:g.dh},b=e,l,m=a.uid(),i=c.createElement("ins");for(l in h)i.setAttribute("data-img-"+l,h[l]);v(i,h);i.innerHTML=f({id:m,src:a.staticPath+"FileAPI.flash.image.swf?r="+a.build,wmode:"opaque",flashvars:"callback="+y(function D(a){try{k.get(m).setImage(n),i=null,w(D)}catch(b){if(!a||"ready"==a.type)clearTimeout(l),l=setTimeout(D,50)}return!0})});b(!1,i)}else{var p=new Image;p.src="data:"+
d.type+";base64,"+n;a.event.one(p,"error abort load",function(a){e("load"!=a.type&&a.type,p);p=null})}})})}},toData:function(a){var c=this.data;c&&!c.flashId?this.parent.apply(this,arguments):a.call(this,!c.info,{id:c.id,flashId:c.flashId,name:c.name,type:c.type,matrix:this.getMatrix(c.info)})}});z(a.Form.prototype,{toData:function(d){for(var c=this.items,e=c.length;e--;)if(c[e].file&&c[e].blob&&!c[e].blob.flashId)return this.parent.apply(this,arguments);a.log("flash.Form.toData");d(c)}});z(a.XHR.prototype,
{_send:function(d,c){if(c.nodeName||c.append&&a.support.html5||a.isArray(c)&&"string"===typeof c[0])return this.parent.apply(this,arguments);var e={},f={},g=this,j,m;a.each(c,function(a){a.file?(f[a.name]=a=a.blob,m=a.id,j=a.flashId):e[a.name]=a.blob});a.log("flash.XHR._send:",j,m,f);this.xhr={headers:{},abort:function(){k.cmd(j,"abort",m)},getResponseHeader:function(a){return this.headers[a]},getAllResponseHeaders:function(){return this.headers}};k.cmd(j,"upload",{url:n(d.url),data:e,files:f,headers:d.headers,
callback:y(function b(c){var e=c.type,f=c.result;a.log("flash.upload."+e+":",c.status,c);if("progress"==e)c.lengthComputable=!0,d.progress(c);else if("complete"==e)w(b),"string"==typeof f&&(g.responseText=f.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")),g.end(c.status||200);else if("abort"==e||"error"==e)g.end(0,c.message),w(b)})})}})}};a.Flash=k;var t=new Image;a.event.one(t,"error load",function(){a.support.dataURI=!(1!=t.width||1!=t.height);t=null;k.init()});
t.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}})(FileAPI,this,document);"undefined"!==typeof ajs&&ajs.loaded&&ajs.loaded("{fileapi}FileAPI.min");"function"===typeof define&&define.amd&&define("FileAPI",[],function(){return window.FileAPI||{}});