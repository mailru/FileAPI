/**!
 * FileAPI â€” a set of tools for working with files
 *
 * @author  RubaXa  <trash@rubaxa.org>
 * @build	lib/canvas-to-blob lib/FileAPI.html lib/FileAPI.Image lib/FileAPI.Form lib/FileAPI.XHR lib/FileAPI.Flash
 */
(function(a){var j=a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype,i=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder,f=i&&a.atob&&a.ArrayBuffer&&a.Uint8Array&&function(a){var e,c,f,q;e=0<=a.split(",")[0].indexOf("base64")?atob(a.split(",")[1]):decodeURIComponent(a.split(",")[1]);c=new ArrayBuffer(e.length);f=new Uint8Array(c);for(q=0;q<e.length;q+=1)f[q]=e.charCodeAt(q);e=new i;e.append(c);a=a.split(",")[0].split(":")[1].split(";")[0];return e.getBlob(a)};a.HTMLCanvasElement&&!j.toBlob&&(j.mozGetAsFile?
j.toBlob=function(a,e){a(this.mozGetAsFile("blob",e))}:j.toDataURL&&f&&(j.toBlob=function(a,e){a(f(this.toDataURL(e)))}));"undefined"!==typeof define&&define.amd?define(function(){return f}):a.dataURLtoBlob=f})(this);
(function(a,j){function i(b,d,a){if(b){var h=g.uid(b);u[h]||(u[h]={});g.each(d.split(/\s+/),function(d){u[h][d]||(u[h][d]=[]);u[h][d].push(a);b.addEventListener?b.addEventListener(d,a,!1):b.attachEvent?b.attachEvent("on"+d,a):b["on"+d]=a})}}function f(b,d,a){if(b){var h=g.uid(b),c=u[h]||{};g.each(d.split(/\s+/),function(d){for(var D=c[d]||[],h=D.length;h--;)if(D[h]===a){D.splice(h,1);break}b.addEventListener?b.removeEventListener(d,a,!1):b.detachEvent?b.detachEvent("on"+d,a):b["on"+d]=null})}}function n(b,
d,a){i(b,d,function G(g){a(g);f(b,d,G)})}function e(b,d,a,h,c){b={type:a.type||a,target:b,result:h};g.extend(b,c);d(b)}function c(b,d,a){if(y){var h=new y;i(h,"abort progress error load loadend",function E(a){var g=a.type;"progress"==g?e(b,d,a,a.target.result,{loaded:a.loaded,total:a.total}):"loadend"==g?(f(h,"abort progress error load loadend",E),h=null):e(b,d,a,a.target.result)});try{h["readAs"+a](b)}catch(g){e(b,d,"error",j,{error:g.toString()})}}else e(b,d,"error",j,{error:"FileReader is not supported"})}
function p(b){return"object"==typeof b&&b&&"length"in b}var q=1,k=a.createObjectURL&&a||a.URL&&URL.revokeObjectURL&&URL||a.webkitURL&&webkitURL,z=a.File,y=a.FileReader,w=a.FormData,m=!(!z||!(y&&a.Uint8Array||w)),v=a.document,r=a.dataURLtoBlob,B={},x=/img/i,l=/canvas/i,t=/img|canvas/,d=/input/i,s=/^data:[^,]+,/,w=Math.pow,u={},C=[],g={build:3,debug:!1,staticPath:"./",KB:1024,MB:w(1024,2),GB:w(1024,3),TB:w(1024,4),expando:"fileapi"+ +new Date,uid:function(b){return b?b[g.expando]=b[g.expando]||g.uid():
g.expando+ ++q},log:function(){g.debug&&(a.console&&console.log)&&(console.log.apply?console.log.apply(console,arguments):console.log([].join.call(arguments," ")))},getXHR:function(){var b;if(a.XMLHttpRequest)b=new XMLHttpRequest;else if(a.ActiveXObject)try{b=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(d){}return b},isArray:p,support:{html5:m,dataURI:!0},event:{on:i,off:f,one:n,fix:function(b){b.target||(b.target=a.event&&a.event.srcElement||v);3===b.target.nodeType&&(b.target=event.target.parentNode);
return b}},throttle:function(b,d){var g,h,c;return function E(){h=arguments;c=!0;g||(c?(b.apply(a,h),c=!1,g=setTimeout(E,d)):g=null)}},F:function(b){return b},parseJSON:function(b){return a.JSON&&JSON.parse?JSON.parse(b):(new Function("return ("+b.replace(/([\r\n])/g,"\\$1")+");"))()},trim:function(b){b=String(b);return b.trim?b.trim():b.replace(/^\s+|\s+$/g,"")},queue:function(b){var d=0,a=0,h=!1,g=!1,c={inc:function(){a++},next:function(){d++;setTimeout(c.check,0)},check:function(){d>=a&&!h&&c.end()},
isFail:function(){return h},fail:function(){!h&&b(h=!0)},end:function(){g||(g=!0,b())}};return c},each:function(b,d,a){if(b)if(b.forEach)b.forEach(d,a);else if(p(b))for(var h=0,g=b.length;h<g;h++)h in b&&d.call(a,b[h],h,b);else for(h in b)b.hasOwnProperty(h)&&d.call(a,b[h],h,b)},extend:function(b){g.each(arguments,function(d){g.each(d,function(d,a){b[a]=d})});return b},isFile:function(b){return m&&b&&b instanceof z},isCanvas:function(b){return b&&l.test(b.nodeName)},getFilesFilter:function(b){return(b=
"string"==typeof b?b:b.getAttribute&&b.getAttribute("accept")||"")?RegExp("("+b.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(b,d){g.isFile(b)?c(b,d,"DataURL"):g.isCanvas(b)?e(b,d,"load",g.toDataURL(b)):e(b,d,"error")},readAsBinaryString:function(b,d){g.isFile(b)?c(b,d,"BinaryString"):e(b,d,"error")},toDataURL:function(b){if("string"==typeof b)return b;if(b.toDataURL)return b.toDataURL("image/png")},toBinaryString:function(b){return a.atob(g.toDataURL(b).replace(s,""))},
readAsImage:function(b,d,a){if(g.isFile(b))if(k){var h=k.createObjectURL(b);h===j?e(b,d,"error"):g.readAsImage(h,d,a)}else g.readAsDataURL(b,function(h){"load"==h.type?g.readAsImage(h.result,d,a):(a||"error"==h.type)&&e(b,d,h,null,{loaded:h.loaded,total:h.total})});else g.isCanvas(b)?e(b,d,"load",b):x.test(b.nodeName)?b.complete?e(b,d,"load",b):n(b,"error abort load",function A(a){"load"==a.type&&k&&k.revokeObjectURL(b.src);f(b,"error abort load",A);e(b,d,a,b)}):b.iframe?e(b,d,{type:"error"}):(h=
new Image,h.src=b.dataURL||b,g.readAsImage(h,d,a))},checkFileObj:function(b){var d={};"object"==typeof b?d=b:d.name=(b+"").split(/(\\|\/)/g).pop();d.type===j&&(d.type=d.name.split(".").pop());g.each(B,function(b,a){b.test(d.type)&&(d.type=a+"/"+d.type)});return d},getFiles:function(b,a,c){var h=[];if(c)return g.filterFiles(g.getFiles(b),a,c),null;b.jquery&&(b.each(function(){h=h.concat(g.getFiles(this))}),b=h,h=[]);"string"==typeof a&&(a=g.getFilesFilter(a));b.originalEvent&&(b=b.originalEvent);b.dataTransfer?
b=b.dataTransfer:b.target&&(b=b.target);b.files?h=b.files:!m&&d.test(b&&b.tagName)?g.trim(b.value)&&(h=[g.checkFileObj(b.value)],h[0].blob=b,h[0].iframe=!0):p(b)&&(h=b);!a&&d.test(b&&b.tagName)&&(a=g.getFilesFilter(b));return g.filter(h,function(b){return!a||a.test(b.name)})},getInfo:function(b,d){var a={},h=C.concat();g.isFile(b)?function A(){var c=h.shift();c?c.test(b.type)?c(b,function(b,h){b?d(b):(g.extend(a,h),A())}):A():d(!1,a)}():d("not_support",a)},addInfoReader:function(b,d){d.test=function(d){return b.test(d)};
C.push(d)},addMime:function(b,d){B[b]=RegExp("("+d.replace(/,/g,"|")+")$","i")},filter:function(b,d){for(var a=[],h=0,g=b.length,c;h<g;h++)h in b&&(c=b[h],d.call(c,c,h,b)&&a.push(c));return a},filterFiles:function(b,d,a){if(b&&(m||b[0].id)){var h=b.concat(),c,e=[],s=[];(function I(){h.length?(c=h.shift(),g.getInfo(c,function(b,a){(d(c,b?!1:a)?e:s).push(c);I()})):a(e,s)})()}else a(b,[])},upload:function(b){var b=g.extend({beforeupload:g.F,upload:g.F,fileupload:g.F,fileprogress:g.F,filecomplete:g.F,
progress:g.F,complete:g.F},b),d=new g.XHR(b),a=this._getFilesDataArray(b.files),h=0,c=0,e=0;g.each(a,function(b){h+=b.size});b.total=h;b.loaded=c;b.beforeupload(d,b);(function H(){var s=a.shift(),k=this;"abort"!=d.statusText&&s?this._getFormData(b,s,function(a){c||b.upload(d,b);var q=new g.XHR(g.extend({},b,{upload:function(){b.fileupload(q,b)},progress:function(d){d.lengthComputable&&(e=c+=~~(h*s.part*(d.loaded/d.total)-e+0.5),b.fileprogress(d,q),b.progress({type:d.type,total:h,loaded:b.loaded=c,
lengthComputable:!0}))},complete:function(a){g.extend(d,q);b.loaded=c+=c-e+~~(h*s.part+0.5);b.filecomplete(a,q);H.call(k)}}));s.part=s.size/h;q.send(a);d.abort=function(){q.abort()}}):b.complete(200==d.status?!1:d.statusText||"error",d)}).call(this);return d},_getFilesDataArray:function(b){var a=[],c={};if(d.test(b&&b.tagName)){var h=g.getFiles(b);c[b.name||"file"]=null!==b.getAttribute("multiple")?h:h[0]}else p(b)&&d.test(b[0]&&b[0].tagName)?g.each(b,function(b){c[b.name||"file"]=g.getFiles(b)}):
c=b;g.each(c,function A(b,d){p(b)?g.each(b,function(b,a){A(b,d+"["+a+"]")}):b&&b.name&&a.push({name:d,file:b,size:b.size})});return a},_getFormData:function(b,d,a){var c=d.file,s=d.name,e=c.name,q=c.type,k=(d=g.support.transform&&b.imageTransform)&&"number"==typeof(d.maxWidth||d.minWidth||d.width),u=new g.Form,l=g.queue(function(){a(u)});d&&(/image/.test(c.type)||t.test(c.nodeType))?(l.inc(),k&&(d=[d]),g.Image.transform(c,d,function(d,a){k&&!d?(!r&&!g.flashEngine&&(a[0]=g.toBinaryString(a[0]),u.multipart=
!0),u.append(s,a[0],e,q)):(d||(g.each(a,function(b,d){!r&&!g.flashEngine&&(b=g.toBinaryString(b),u.multipart=!0);u.append(s+"["+d+"]",b,e,q)}),s+="[original]"),(d||b.imageOriginal)&&u.append(s,c,e,q));l.next()})):u.append(s,c,e);g.each(b.data,function J(b,d){"object"==typeof b?g.each(b,function(b,a){J(b,d+"["+a+"]")}):u.append(d,b)});l.check()},reset:function(b){var d,c;a.jQuery?(c=jQuery(b).clone(!0).insertBefore(b).val("")[0],jQuery(b).remove()):(d=b.parentNode,c=d.insertBefore(b.cloneNode(!0),
b),c.value="",d.removeChild(b));g.each(u[g.uid(b)],function(d,a){g.each(d,function(d){f(b,a,d);i(c,a,d)})});return c},load:function(b,d){var a=g.getXHR();a?(a.open("GET",b,!0),a.overrideMimeType&&a.overrideMimeType("text/plain; charset=x-user-defined"),i(a,"progress",function(b){b.lengthComputable&&d({type:b.type,loaded:b.loaded,total:b.total},a)}),a.onreadystatechange=function(){if(4==a.readyState)if(a.onreadystatechange=null,200==a.status){b=b.split("/");var c={name:b[b.length-1],size:a.getResponseHeader("Content-Length"),
type:a.getResponseHeader("Content-Type")};c.dataURL="data:"+c.type+";base64,"+g.encode64(a.responseBody||a.responseText);d({type:"load",result:c})}else d({type:"error"})},a.send(null)):d({type:"error"});return a},encode64:function(b){var d="",a=0;for("string"!==typeof b&&(b=String(b));a<b.length;){var c=b.charCodeAt(a++)&255,g=b.charCodeAt(a++)&255,s=b.charCodeAt(a++)&255,e=c>>2,c=(c&3)<<4|g>>4;isNaN(g)?g=s=64:(g=(g&15)<<2|s>>6,s=isNaN(s)?64:s&63);d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(s)}return d}};g.each({image:"png,jpg,jpeg,bmp,gif,ico,tif,tiff,tga,pcx,cbz,cbr",audio:"m4a,flac,aac,rm,mpa,wav,wma,ogg,mp3,mp2,m3u,mod,amf,dmf,dsm,far,gdm,imf,it,m15,med,okt,s3m,stm,sfx,ult,uni,xm,sid,ac3,dts,cue,aif,aiff,wpl,ape,mac,mpc,mpp,shn,wv,nsf,spc,gym,adplug,adx,dsp,adp,ymf,ast,afc,hps,xsp",
video:"m4v,3gp,nsv,ts,ty,strm,rm,rmvb,m3u,ifo,mov,qt,divx,xvid,bivx,vob,nrg,img,iso,pva,wmv,asf,asx,ogm,m2v,avi,bin,dat,dvr-ms,mpg,mpeg,mp4,mkv,avc,vp3,svq3,nuv,viv,dv,fli,flv,wpl"},function(b,d){g.addMime(d,b)});g.addInfoReader(/^image/,function(b,d){g.readAsImage(b,function(b){var a=b.target;d("load"==b.type?!1:"error",{width:a.width,height:a.height})})});a.FileAPI=g.extend(g,a.FileAPI)})(this);
(function(a,j,i){function f(a,c){if(!(this instanceof f))return new f(a);this.data=a;this.better=!c;this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0}}var n=Math.min,e=Math.round,c=!1;try{c=-1<j.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")}catch(p){}f.prototype={constructor:f,set:function(c){a.extend(this.matrix,c);return this},crop:function(a,c,e,f){e===i&&(e=a,f=c,a=c=0);return this.set({sx:a,sy:c,sw:e,sh:f||e})},resize:function(a,c,e){"string"==typeof c&&
(e=c,c=a);return this.set({dw:a,dh:c,resize:e})},preview:function(a,c){return this.set({dw:a,dh:c||a,resize:"preview"})},rotate:function(a){return this.set({deg:a})},_load:function(c,e){var f=this;a.readAsImage(c,function(a){e.call(f,"load"!=a.type,a.result)})},_apply:function(a,c){var e=j.createElement("canvas"),f=this.getMatrix(a),i=e.getContext("2d"),m=f.deg,n=f.dw,r=f.dh,p=a.width,x=a.height,l,t=a;if(this.better)for(;2<Math.min(p/n,x/r);)p=~~(p/2+0.5),x=~~(x/2+0.5),l=j.createElement("canvas"),
l.width=p,l.height=x,t!==a?(l.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,p,x),t=l):(t=l,t.getContext("2d").drawImage(a,f.sx,f.sy,f.sw,f.sh,0,0,p,x),f.sx=f.sy=f.sw=f.sh=0);e.width=!(m%180)?n:r;e.height=m%180?n:r;i.rotate(m*Math.PI/180);i.drawImage(t,f.sx,f.sy,f.sw||t.width,f.sh||t.height,180==m||270==m?-n:0,90==m||180==m?-r:0,n,r);c.call(this,!1,e)},getMatrix:function(c){var k=a.extend({},this.matrix),f=k.sw=k.sw||c.width,c=k.sh=k.sh||c.height,p=k.dw=k.dw||k.sw,i=k.dh=k.dh||k.sh,m=f/c,j=
p/i,r=k.resize;if("preview"==r){if(p!=f||i!=c)if(j>=m?(m=f,r=m/j):(r=c,m=r*j),m!=f||r!=c)k.sx=~~((f-m)/2),k.sy=~~((c-r)/2),f=m,c=r}else r&&("min"==r?(p=e(m<j?n(f,p):i*m),i=e(m<j?p/m:n(c,i))):(p=e(m>=j?n(f,p):i*m),i=e(m>=j?p/m:n(c,i))));k.sw=f;k.sh=c;k.dw=p;k.dh=i;return k},get:function(c){a.support.transform?this._load(this.data,function(a,e){a?c(a):this._apply(e,c)}):c("not_support")},toData:function(a){this.get(a)}};f.transform=function(c,e,p){a.getInfo(c,function(i,j){var n={},v=a.queue(function(a){p(a,
n)});i?v.fail():a.each(e,function(a,e){if(!v.isFail()){var k=f(j.nodeType?j:c);if("function"==typeof a)a(j,k);else if(a.width)k[a.preview?"preview":"resize"](a.width,a.height,a.type);else a.maxWidth&&(j.width>a.maxWidth||j.height>a.maxHeight)&&k.resize(a.maxWidth,a.maxHeight,"max"),k.rotate(~~a.rotate);v.inc();k.toData(function(a,c){a?v.fail():(n[e]=c,v.next())})}})})};a.support.canvas=a.support.transform=c;a.Image=f})(FileAPI,document);
(function(a,j,i){var f=j.encodeURIComponent,n=j.FormData,j=function(){this.items=[]};j.prototype={append:function(a,c,f,i){this.items.push({name:a,blob:c&&c.blob||c,file:f||c.name,type:i||c.type})},each:function(a){for(var c=0,f=this.items.length;c<f;c++)a.call(this,this.items[c])},toData:function(e){a.support.html5?this.multipart?(a.log("FileAPI.Form.toMultipartData"),this.toMultipartData(e)):(a.log("FileAPI.Form.toFormData"),this.toFormData(e)):(a.log("tFileAPI.Form.toHtmlData"),this.toHtmlData(e))},
_to:function(e,c,f,i){var k=a.queue(function(){c(e)});this.each(function(a){f(a,e,k,i)});k.check()},toHtmlData:function(e){this._to(i.createDocumentFragment(),e,function(c,e){var f=c.blob,k;c.file?(a.reset(f),e.appendChild(f)):(k=i.createElement("input"),k.type="hidden",k.value=f,e.appendChild(k))})},toFormData:function(a){this._to(new n,a,function(a,e,f){a.file&&e.append("_"+a.name,a.file);a.blob.toBlob?(f.inc(),a.blob.toBlob(function(k){e.append(a.name,k,a.file);f.next()},"image/png")):a.file?e.append(a.name,
a.blob,a.file):e.append(a.name,a.blob)})},toMultipartData:function(e){this._to([],e,function(a,e,i,k){e.push("--_"+k+('\r\nContent-Disposition: form-data; name="'+a.name+'"'+(a.file?'; filename="'+f(a.file)+'"':"")+(a.file?"\r\nContent-Type: "+(a.type||"application/octet-stream"):"")+"\r\n\r\n"+(a.file?a.blob:f(a.blob))+"\r\n"))},a.expando)}};a.Form=j})(FileAPI,this,document);
(function(a){var j=function(){},i=function(f){this.uid=a.uid();this.xhr={abort:j,getResponseHeader:j,getAllResponseHeaders:j};this.options=f};i.prototype={status:0,statusText:"",getResponseHeader:function(a){return this.xhr.getResponseHeader(a)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(a,i){var e=this,c=e.options;e.abort=j;e.status=a;i&&(e.statusText=i);c.complete(200==a?!1:e.statusText||"unknown",e);e.xhr&&e.xhr.node&&setTimeout(function(){try{e.xhr.node.parentNode.removeChild(e.xhr.node)}catch(a){}e.xhr.node=
null;delete window[e.uid]},1)},abort:function(){this.end(0,"abort");this.xhr&&this.xhr.abort()},send:function(a){var i=this,e=this.options;a.toData(function(a){e.upload(e,i);i._send.call(i,e,a)})},_send:function(f,i){var e=this,c,j=e.uid;a.log("XHR._send:",i);if(i.nodeName){f.upload(f,e);c=document.createElement("div");c.innerHTML='<form target="'+j+'" action="'+f.url+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+
j+'" src="javascript:false;"></iframe><input value="'+j+'" name="callback" type="hidden"/></form>';e.xhr.abort=function(){var a=c.getElementsByName("iframe")[0];if(a)try{a.stop?a.stop():a.contentWindow.stop?a.contentWindow.stop():a.contentWindow.document.execCommand("Stop")}catch(e){}c=null};var q=c.getElementsByTagName("form")[0];q.appendChild(i);document.body.appendChild(c);this.xhr.node=c;window[j]=function(a,f,i){e.readyState=4;e.responseText=i;e.end(a,f);c=null};e.readyState=2;q.submit();q=null}else{c=
e.xhr=a.getXHR();c.open("POST",f.url,!0);c.withCredential="true";(!f.headers||!f.headers["X-Requested-With"])&&c.setRequestHeader("X-Requested-With","XMLHttpRequest");a.each(f.headers,function(a,e){c.setRequestHeader(e,a)});if(c.upload)a.event.on(c.upload,"progress",a.throttle(function(a){f.progress(a,f,e)},100));c.onreadystatechange=function(){e.status=c.status;e.statusText=c.statusText;e.readyState=c.readyState;if(4==c.readyState){for(var a in{"":1,XML:1,Text:1,Body:1})e["response"+a]=c["response"+
a];c.onreadystatechange=null;e.end(c.status);c=null}};a.isArray(i)?(c.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+a.expando),i=i.join("")+"--_"+a.expando+"--",c.sendAsBinary?c.sendAsBinary(i):(j=Array.prototype.map.call(i,function(a){return a.charCodeAt(0)&255}),c.send((new Uint8Array(j)).buffer))):c.send(i)}}};a.XHR=i})(FileAPI);
(function(a,j,i){var f=a.support,n=j.navigator,e=n.mimeTypes,c=!1;if(n.plugins&&"object"==typeof n.plugins["Shockwave Flash"])c=n.plugins["Shockwave Flash"].description&&!(e&&e["application/x-shockwave-flash"]&&!e["application/x-shockwave-flash"].enabledPlugin);else try{c=!(!j.ActiveXObject||!new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(p){}f.flash=c;if(!a.support.html5&&a.support.flash){var q=function(a){return'<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="movie" value="#src#" /><param name="flashvars" value="#flashvars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="menu" value="false" /><param name="wmode" value="#wmode#" /><embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#"  width="100%" height="100%" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>'.replace(/#(\w+)#/ig,
function(c,e){return a[e]})},k=function(a,c){if(a&&a.style){var e,f;for(e in c){f=c[e];"number"==typeof f&&(f+="px");try{a.style[e]=f}catch(g){}}}},z=function(d,c){a.each(c,function(a,c){var e=d[c];d[c]=function(){this.parent=e;return a.apply(this,arguments)}})},y=function(d){var c=d.wid=a.uid();l._fn[c]=d;return"FileAPI.Flash._fn."+c},w=function(a){delete l._fn[a.wid]},m=function(a){if(!x.test(a)){if(/^\.\//.test(a)||"/"!=a.charAt(0))a=location.pathname+"/"+a.substr(RegExp.$1?2:0);"//"!=a.substr(0,
2)&&(a=location.hostname+"/"+a);x.test(a)||(a=location.protocol+"//"+a)}return a},v=a.uid(),r=0,B={},x=/^https?:/i,l={_fn:{},init:function(){var d=i.body&&i.body.firstChild;if(d){do if(1==d.nodeType){a.log("FlashAPI.Flash.inited");var c=i.createElement("div");k(c,{top:1,right:1,width:5,height:5,position:"absolute"});d.parentNode.insertBefore(c,d);l.pingUrl=l.pingUrl||location.protocol+"//"+location.host;l.publish(c,v);return}while(d=d.nextSibling)}10>r&&setTimeout(l.init,50*++r)},publish:function(d,
c){d.innerHTML=q({id:c,src:m(a.staticPath+"FileAPI.flash.swf?r="+a.build),wmode:"transparent",flashvars:"callback=FileAPI.Flash.event&flashId="+c+"&storeKey="+navigator.userAgent.match(/\d/ig).join("")+"_"+a.build+(l.isReady||!l.pingUrl?"":"&ping="+l.pingUrl)})},ready:function(){l.ready=a.F;l.isReady=!0;l.patch();a.event.on(i,"mouseover",l.mouseover);a.event.on(i,"click",function(a){l.mouseover(a)&&(a.preventDefault?a.preventDefault():a.returnValue=!0)})},getWrapper:function(a){do if(/js-fileapi-wrapper/.test(a.className))return a;
while((a=a.parentNode)&&a!==i.body)},mouseover:function(d){d=a.event.fix(d).target;if(/input/i.test(d.nodeName)&&"file"==d.type){var c=d.getAttribute(v);if("n"==c)return!1;if("y"!=c){d.setAttribute(v,"n");var c=i.createElement("div"),e=l.getWrapper(d);if(!e){a.log("flash.mouseover.error: js-fileapi-wrapper not found");return}k(c,{top:0,left:0,width:d.offsetWidth+100,height:d.offsetHeight+100,position:"absolute"});e.appendChild(c);l.publish(c,a.uid());d.setAttribute(v,"y")}return!0}},event:function(d){var c=
d.type;if("ready"==c)return a.log("Flash.event."+d.type+":",d),l.ready(),setTimeout(function(){l.mouseenter(d)},50),!0;"ping"===c?a.log("(flash -> js).ping:",[d.status,d.savedStatus],d.error):"log"===c?a.log("(flash -> js).log:",d.target):c in l&&setTimeout(function(){a.log("Flash.event."+d.type+":",d);l[c](d)},1)},mouseenter:function(a){var c=l.getInput(a.flashId);c&&(l.cmd(a,"multiple",null!==c.getAttribute("multiple")),l.cmd(a,"accept",(c.getAttribute("accept")||"*").replace(/\./g,"")))},get:function(a){return i[a]||
j[a]||i.embeds[a]},getInput:function(a){try{var c=l.getWrapper(l.get(a));if(c)return c.getElementsByTagName("input")[0]}catch(e){}},select:function(d){var c=l.getInput(d.flashId),e=a.uid(c),d=d.target.files;a.each(d,function(d){a.checkFileObj(d)});B[e]=d;i.createEvent?(e=i.createEvent("Event"),e.initEvent("change",!0,!1),c.dispatchEvent(e)):i.createEventObject&&(e=i.createEventObject(),c.fireEvent("onchange",e))},cmd:function(d,c,e,f){try{return a.log("(js -> flash)."+c+":",e),l.get(d.flashId||d).cmd(c,
e)}catch(g){a.log("(js -> flash).onError:",g),f||setTimeout(function(){l.cmd(d,c,e,!0)},50)}},patch:function(){a.flashEngine=a.support.transform=!0;z(a,{getFiles:function(d,c,e){if(e)return a.filterFiles(a.getFiles(d),c,e),null;var f=a.isArray(d)?d:B[a.uid(d.target||d.srcElement||d)];if(!f)return this.parent.apply(this,arguments);c&&(c=a.getFilesFilter(c),f=a.filter(f,function(a){return c.test(a.name)}));return f},getInfo:function(a,c){a&&!a.flashId?this.parent.apply(this,arguments):a.info?c(!1,a.info):
l.cmd(a,"getFileInfo",{id:a.id,callback:y(function C(e,b){w(C);c(e,a.info=b)})})}});a.support.transform=!0;z(FileAPI.Image.prototype,{_load:function(d,c){a.log("FileAPI.Image._load:",d);if(d&&!d.flashId)this.parent.apply(this,arguments);else{var e=this;a.getInfo(d,function(a){c.call(e,a,d)})}},_apply:function(d,c){a.log("FileAPI.Image._apply:",d);if(d&&!d.flashId)this.parent.apply(this,arguments);else{var e=this.getMatrix(d.info);l.cmd(d,"imageTransform",{id:d.id,matrix:e,callback:y(function g(b,
f){w(g);if(b)c(b);else if(!a.support.dataURI||3E4<f.length){var j={width:!(e.deg%180)?e.dw:e.dh,height:e.deg%180?e.dw:e.dh},h=c,m,p=a.uid(),n=i.createElement("ins");for(m in j)n.setAttribute("data-img-"+m,j[m]);k(n,j);n.innerHTML=q({id:p,src:a.staticPath+"FileAPI.flash.image.swf?r="+a.build,wmode:"opaque",flashvars:"callback="+y(function F(a){try{l.get(p).setImage(f),n=null,w(F)}catch(b){if(!a||"ready"==a.type)clearTimeout(m),m=setTimeout(F,50)}return!0})});h(!1,n)}else{var r=new Image;r.src="data:"+
d.type+";base64,"+f;a.event.one(r,"error abort load",function(a){c("load"!=a.type&&a.type,r);r=null})}})})}},toData:function(a){var c=this.data;c&&!c.flashId?this.parent.apply(this,arguments):a.call(this,!c.info,{id:c.id,flashId:c.flashId,name:c.name,type:c.type,matrix:this.getMatrix(c.info)})}});z(a.Form.prototype,{toData:function(c){for(var e=this.items,f=e.length;f--;)if(e[f].file&&e[f].blob&&!e[f].blob.flashId)return this.parent.apply(this,arguments);a.log("flash.Form.toData");c(e)}});z(a.XHR.prototype,
{_send:function(c,e){if(e.nodeName||e.append&&a.support.html5||a.isArray(e)&&"string"===typeof e[0])return this.parent.apply(this,arguments);var f={},i={},g=this,b,j;a.each(e,function(a){a.file?(i[a.name]=a=a.blob,j=a.id,b=a.flashId):f[a.name]=a.blob});a.log("flash.XHR._send:",b,j,i);this.xhr={headers:{},abort:function(){l.cmd(b,"abort",j)},getResponseHeader:function(a){return this.headers[a]},getAllResponseHeaders:function(){return this.headers}};l.cmd(b,"upload",{url:m(c.url),data:f,files:i,headers:c.headers,
callback:y(function h(b){var e=b.type,f=b.result;a.log("flash.upload."+e+":",b.status,b);if("progress"==e)b.lengthComputable=!0,c.progress(b);else if("complete"==e)w(h),"string"==typeof f&&(g.responseText=f.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")),g.end(b.status||200);else if("abort"==e||"error"==e)g.end(0,b.message),w(h)})})}})}};a.Flash=l;var t=new Image;a.event.one(t,"error load",function(){a.support.dataURI=!(1!=t.width||1!=t.height);t=null;l.init()});
t.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}})(FileAPI,this,document);"undefined"!==typeof ajs&&ajs.loaded&&ajs.loaded("{fileapi}FileAPI.min");"function"===typeof define&&define.amd&&define("FileAPI",[],function(){return window.FileAPI||{}});