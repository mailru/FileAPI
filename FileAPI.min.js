/**!
 * FileAPI â€” a set of tools for working with files
 *
 * @author  RubaXa  <trash@rubaxa.org>
 * @build	lib/canvas-to-blob lib/FileAPI.core lib/FileAPI.Image lib/FileAPI.Form lib/FileAPI.XHR lib/FileAPI.Flash
 */
(function(a){var l=a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype,g;if(g=a.Blob)try{g=Boolean(new Blob)}catch(m){g=!1}var n=g;if(g=n)if(g=a.Uint8Array)try{g=100===(new Blob([new Uint8Array(100)])).size}catch(f){g=!1}var c=g,d=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder,h=(n||d)&&a.atob&&a.ArrayBuffer&&a.Uint8Array&&function(a){var k,f,g,h;k=0<=a.split(",")[0].indexOf("base64")?atob(a.split(",")[1]):decodeURIComponent(a.split(",")[1]);f=new ArrayBuffer(k.length);g=new Uint8Array(f);
for(h=0;h<k.length;h+=1)g[h]=k.charCodeAt(h);a=a.split(",")[0].split(":")[1].split(";")[0];if(n)return new Blob([c?g:f],{type:a});g=new d;g.append(f);return g.getBlob(a)};a.HTMLCanvasElement&&!l.toBlob&&(l.mozGetAsFile?l.toBlob=function(a,c){a(this.mozGetAsFile("blob",c))}:l.toDataURL&&h&&(l.toBlob=function(a,c){a(h(this.toDataURL(c)))}));"function"===typeof define&&define.amd?define(function(){return h}):a.dataURLtoBlob=h})(this);
(function(a,l){function g(b,e,a){if(b)if(k(b))for(var c=0,d=b.length;c<d;c++)c in b&&e.call(a,b[c],c,b);else for(c in b)b.hasOwnProperty(c)&&e.call(a,b[c],c,b)}function m(b,e,a){if(b){var c=j.uid(b);z[c]||(z[c]={});g(e.split(/\s+/),function(e){s?s.event.add(b,e,a):(z[c][e]||(z[c][e]=[]),z[c][e].push(a),b.addEventListener?b.addEventListener(e,a,!1):b.attachEvent?b.attachEvent("on"+e,a):b["on"+e]=a)})}}function n(b,e,a){if(b){var c=j.uid(b),d=z[c]||{};g(e.split(/\s+/),function(e){if(s)s.event.remove(b,
e,a);else{for(var J=d[e]||[],c=J.length;c--;)if(J[c]===a){J.splice(c,1);break}b.addEventListener?b.removeEventListener(e,a,!1):b.detachEvent?b.detachEvent("on"+e,a):b["on"+e]=null}})}}function f(b,e,a){m(b,e,function Q(c){n(b,e,Q);a(c)})}function c(b,e,a,c,d){b={type:a.type||a,target:b,result:c};j.extend(b,d);e(b)}function d(b,e,a,d){if(j.isFile(b)&&t&&t.prototype["readAs"+a]){var k=new t;m(k,K,function R(a){var d=a.type;"progress"==d?c(b,e,a,a.target.result,{loaded:a.loaded,total:a.total}):"loadend"==
d?(n(k,K,R),k=null):c(b,e,a,a.target.result)});try{if(d)k["readAs"+a](d,b);else k["readAs"+a](b)}catch(u){c(b,e,"error",l,{error:u.toString()})}}else c(b,e,"error",l,{error:"filreader_not_support_"+a})}function h(b){var e;b.getAsEntry?e=b.getAsEntry():b.webkitGetAsEntry&&(e=b.webkitGetAsEntry());return e}function x(b,e){if(b)if(b.isFile)b.file(function(b){e(!1,[b])},function(){e("entry_file")});else if(b.isDirectory){var a=[];b.createReader().readEntries(function(b){j.afor(b,function(b,c){x(c,function(c,
d){c||(a=a.concat(d));b?b():e(!1,a)})})},function(){e("directory_reader")})}else x(h(b),e);else e("empty_entry")}function k(b){return"object"==typeof b&&b&&"length"in b}function A(b){b.target||(b.target=a.event&&a.event.srcElement||u);3===b.target.nodeType&&(b.target=event.target.parentNode);return b}var v=1,D=function(){},r=navigator.userAgent,w=a.createObjectURL&&a||a.URL&&URL.revokeObjectURL&&URL||a.webkitURL&&webkitURL,q=a.File,t=a.FileReader,p=a.FormData,s=a.jQuery,e=!(!q||!(t&&a.Uint8Array||
p))&&!(/safari\//.test(r)&&/windows/i.test(r)),r=e&&"withCredentials"in new XMLHttpRequest,p=e&&!!Blob&&!(!Blob.prototype.webkitSlice&&!Blob.prototype.mozSlice&&!Blob.prototype.slice),u=a.document,y=a.dataURLtoBlob,T=/img/i,E=/canvas/i,U=/img|canvas/,L=/input/i,V=/^data:[^,]+,/,C=Math.pow,G=Math.round,H=Number,I=function(b){return G(b*this)},F=new H(1024),N=new H(C(F,2)),O=new H(C(F,3)),C=new H(C(F,4)),z={},P=[],K="abort progress error load loadend",W="status statusText readyState response responseXML responseText responseBody".split(" "),
j={version:"1.2.4",cors:!1,debug:!1,pingUrl:!1,staticPath:"./",flashUrl:0,flashImageUrl:0,accept:{"image/*":"art bm bmp dwg dxf cbr cbz fif fpx gif ico iefs jfif jpe jpeg jpg jps jut mcf nap nif pbm pcx pgm pict pm png pnm qif qtif ras rast rf rp svf tga tif tiff xbm xbm xpm xwd","audio/*":"m4a flac aac rm mpa wav wma ogg mp3 mp2 m3u mod amf dmf dsm far gdm imf it m15 med okt s3m stm sfx ult uni xm sid ac3 dts cue aif aiff wpl ape mac mpc mpp shn wv nsf spc gym adplug adx dsp adp ymf ast afc hps xs",
"video/*":"m4v 3gp nsv ts ty strm rm rmvb m3u ifo mov qt divx xvid bivx vob nrg img iso pva wmv asf asx ogm m2v avi bin dat dvr-ms mpg mpeg mp4 mkv avc vp3 svq3 nuv viv dv fli flv wpl"},chunkSize:0,chunkUploadRetry:0,chunkNetworkDownRetryTimeout:2E3,KB:(F.from=I,F),MB:(N.from=I,N),GB:(O.from=I,O),TB:(C.from=I,C),expando:"fileapi"+(new Date).getTime(),uid:function(b){return b?b[j.expando]=b[j.expando]||j.uid():(++v,j.expando+v)},log:function(){j.debug&&(a.console&&console.log)&&(console.log.apply?
console.log.apply(console,arguments):console.log([].join.call(arguments," ")))},getXHR:function(){var b;if(a.XMLHttpRequest)b=new XMLHttpRequest;else if(a.ActiveXObject)try{b=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(e){}return b},isArray:k,support:{dnd:r&&"ondrop"in u.createElement("div"),cors:r,html5:e,chunked:p,dataURI:!0},event:{on:m,off:n,one:f,fix:A},throttle:function(b,e){var c,d;return function(){d=arguments;c||(b.apply(a,d),c=setTimeout(function(){c=0;b.apply(a,d)},e))}},F:function(){},
parseJSON:function(b){return a.JSON&&JSON.parse?JSON.parse(b):(new Function("return ("+b.replace(/([\r\n])/g,"\\$1")+");"))()},trim:function(b){b=String(b);return b.trim?b.trim():b.replace(/^\s+|\s+$/g,"")},defer:function(){var b=[],e,a,c={resolve:function(d,k){c.resolve=D;a=d||!1;for(e=k;k=b.shift();)k(a,e)},then:function(c){a!==l?c(a,e):b.push(c)}};return c},queue:function(b){var e=0,a=0,c=!1,d=!1,k={inc:function(){a++},next:function(){e++;setTimeout(k.check,0)},check:function(){e>=a&&!c&&k.end()},
isFail:function(){return c},fail:function(){!c&&b(c=!0)},end:function(){d||(d=!0,b())}};return k},each:g,afor:function(b,e){var a=0,c=b.length;k(b)&&c--?function B(){e(c!=a&&B,b[a],a++)}():e(!1)},extend:function(b){g(arguments,function(e){g(e,function(e,a){b[a]=e})});return b},isFile:function(b){return e&&b&&b instanceof q},isCanvas:function(b){return b&&E.test(b.nodeName)},getFilesFilter:function(b){return(b="string"==typeof b?b:b.getAttribute&&b.getAttribute("accept")||"")?RegExp("("+b.replace(/\./g,
"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(b,e){j.isCanvas(b)?c(b,e,"load",j.toDataURL(b)):d(b,e,"DataURL")},readAsBinaryString:function(b,e){t&&t.prototype.readAsBinaryString?d(b,e,"BinaryString"):d(b,function(b){if("load"==b.type)try{b.result=j.toBinaryString(b.result)}catch(a){b.type="error",b.message=a.toString()}e(b)},"DataURL")},readAsArrayBuffer:function(b,e){d(b,e,"ArrayBuffer")},readAsText:function(b,e,a){a||(a=e,e="utf-8");d(b,a,"Text",e)},toDataURL:function(b){if("string"==
typeof b)return b;if(b.toDataURL)return b.toDataURL("image/png")},toBinaryString:function(b){return a.atob(j.toDataURL(b).replace(V,""))},readAsImage:function(b,e,a){if(j.isFile(b))if(w){var d=w.createObjectURL(b);d===l?c(b,e,"error"):j.readAsImage(d,e,a)}else j.readAsDataURL(b,function(d){"load"==d.type?j.readAsImage(d.result,e,a):(a||"error"==d.type)&&c(b,e,d,null,{loaded:d.loaded,total:d.total})});else j.isCanvas(b)?c(b,e,"load",b):T.test(b.nodeName)?b.complete?c(b,e,"load",b):f(b,"error abort load",
function B(a){"load"==a.type&&w&&w.revokeObjectURL(b.src);n(b,"error abort load",B);c(b,e,a,b)}):b.iframe?c(b,e,{type:"error"}):(d=new Image,d.src=b.dataURL||b,j.readAsImage(d,e,a))},checkFileObj:function(b){var e={},a=j.accept;"object"==typeof b?e=b:e.name=(b+"").split(/\\|\//g).pop();null==e.type&&(e.type=e.name.split(".").pop());g(a,function(b,a){b=RegExp(b.replace(/\s/g,"|"),"i");b.test(e.type)&&(e.type=a.split("/")[0]+"/"+e.type)});return e},getDropFiles:function(b,e){var a=[],c=(b.originalEvent||
b||"").dataTransfer||{},d=k(c.items)&&c.items[0]&&h(c.items[0]),u=j.queue(function(){e(a)});g((d?c.items:c.files)||[],function(b){u.inc();if(d)x(b,function(b,e){!b&&a.push.apply(a,e);u.next()});else{var e=function(e){e&&a.push(b);u.next()};if(!b.type&&0==b.size%4096&&102400>=b.size)if(t)try{var c=new t;f(c,K,function(b){b="error"!=b.type;e(b);b&&c.abort()});c.readAsDataURL(b)}catch(k){e(!1)}else e(null);else e(!0)}});u.check()},getFiles:function(b,a,c){var d=[];if(c)return j.filterFiles(j.getFiles(b),
a,c),null;b.jquery&&(b.each(function(){d=d.concat(j.getFiles(this))}),b=d,d=[]);"string"==typeof a&&(a=j.getFilesFilter(a));b.originalEvent?b=A(b.originalEvent):b.srcElement&&(b=A(b));b.dataTransfer?b=b.dataTransfer:b.target&&(b=b.target);b.files?d=b.files:!e&&L.test(b&&b.tagName)?j.trim(b.value)&&(d=[j.checkFileObj(b.value)],d[0].blob=b,d[0].iframe=!0):k(b)&&(d=b);return j.filter(d,function(b){return!a||a.test(b.name)})},getInfo:function(b,e){var a={},c=P.concat();j.isFile(b)?function B(){var d=
c.shift();d?d.test(b.type)?d(b,function(b,c){b?e(b):(j.extend(a,c),B())}):B():e(!1,a)}():e("not_support",a)},addInfoReader:function(b,e){e.test=function(e){return b.test(e)};P.push(e)},filter:function(b,e){for(var a=[],c=0,d=b.length,k;c<d;c++)c in b&&(k=b[c],e.call(k,k,c,b)&&a.push(k));return a},filterFiles:function(b,e,a){if(b.length){var c=b.concat(),d,k=[],u=[];(function S(){c.length?(d=c.shift(),j.getInfo(d,function(b,a){(e(d,b?!1:a)?k:u).push(d);S()})):a(k,u)})()}else a([],b)},upload:function(b){b=
j.extend({prepare:j.F,beforeupload:j.F,upload:j.F,fileupload:j.F,fileprogress:j.F,filecomplete:j.F,progress:j.F,complete:j.F,pause:j.F,chunkSize:j.chunkSize,chunkUpoloadRetry:j.chunkUploadRetry},b);b.imageAutoOrientation&&!b.imageTransform&&(b.imageTransform={rotate:"auto"});var e=new j.XHR(b),a=this._getFilesDataArray(b.files),c=0,d=0,k=0,u=1,x=this,f,y=!1;g(a,function(b){c+=b.size});e.files=[];g(a,function(b){e.files.push(b.file)});e.total=c;e.loaded=0;b.beforeupload(e,b);(f=function M(){var f=
a.shift(),h=f&&f.file,n=!1,v={};g(b,function(b,e){b&&"object"===typeof b&&(b=j.extend({},b));v[e]=b});("abort"!=e.statusText||e.current)&&f?(y=!1,e.currentFile=h,b.prepare(h,v),this._getFormData(v,f,function(a){d||b.upload(e,b);var y=new j.XHR(j.extend({},v,{upload:function(){b.fileupload(h,y,v)},progress:function(a){n||(k=d+=c*u*(a.loaded/a.total)-k+0.5|0,f.total=a.total,f.loaded=a.loaded,b.fileprogress(a,h,y,v),b.progress({type:a.type,total:c,loaded:e.loaded=d,lengthComputable:!0},h,y,v))},complete:function(a){g(W,
function(b){e[b]=y[b]});n=!0;f.loaded=f.total;e.loaded=d+=d-k+(c*u+0.5)|0;b.filecomplete(a,y,h,v);M.call(x)}}));u=f.size/c;e.abort=function(b){this.current=b;y.abort()};y.send(a)})):(b.complete(200==e.status||201==e.status?!1:e.statusText||"error",e,b),y=!0)}).call(this);e.append=function(b){b=j._getFilesDataArray(b);g(b,function(b){c+=b.size;e.files.push(b.file);a.push(b)});y&&f.call(x)};e.remove=function(b){var e=-1;g(a,function(c){e++;if(c.file==b)return a.splice(e,1)})};return e},_getFilesDataArray:function(b){var e=
[],a={};if(L.test(b&&b.tagName)){var c=j.getFiles(b);a[b.name||"file"]=null!==b.getAttribute("multiple")?c:c[0]}else k(b)&&L.test(b[0]&&b[0].tagName)?g(b,function(b){a[b.name||"file"]=j.getFiles(b)}):a=b;g(a,function B(b,a){k(b)?g(b,function(b){B(b,a)}):b&&b.name&&e.push({name:a,file:b,size:b.size,total:b.size,loaded:0})});return e},_getFormData:function(b,e,a){var c=e.file,d=e.name,k=c.name,u=c.type;e=j.support.transform&&b.imageTransform;var f=new j.Form,x=j.queue(function(){a(f)}),h=e&&(0<parseInt(e.maxWidth||
e.minWidth||e.width,10)||e.rotate);j.Image&&e&&(/image/.test(c.type)||U.test(c.nodeType))?(x.inc(),h&&(e=[e]),j.Image.transform(c,e,b.imageAutoOrientation,function(e,a){h&&!e?(!y&&!j.flashEngine&&(a[0]=j.toBinaryString(a[0]),f.multipart=!0),f.append(d,a[0],k,u)):(e||(g(a,function(b,e){!y&&!j.flashEngine&&(b=j.toBinaryString(b),f.multipart=!0);f.append(d+"["+e+"]",b,k,u)}),d+="[original]"),(e||b.imageOriginal)&&f.append(d,c,k,u));x.next()})):f.append(d,c,k);g(b.data,function M(b,e){"object"==typeof b?
g(b,function(b,a){M(b,e+"["+a+"]")}):f.append(e,b)});x.check()},reset:function(b){var e,a;s?(a=s(b).clone(!0).insertBefore(b).val("")[0],s(b).remove()):(e=b.parentNode,a=e.insertBefore(b.cloneNode(!0),b),a.value="",e.removeChild(b),g(z[j.uid(b)],function(e,c){g(e,function(e){n(b,c,e);m(a,c,e)})}));return a},load:function(b,e){var a=j.getXHR();a?(a.open("GET",b,!0),a.overrideMimeType&&a.overrideMimeType("text/plain; charset=x-user-defined"),m(a,"progress",function(b){b.lengthComputable&&e({type:b.type,
loaded:b.loaded,total:b.total},a)}),a.onreadystatechange=function(){if(4==a.readyState)if(a.onreadystatechange=null,200==a.status){b=b.split("/");var c={name:b[b.length-1],size:a.getResponseHeader("Content-Length"),type:a.getResponseHeader("Content-Type")};c.dataURL="data:"+c.type+";base64,"+j.encode64(a.responseBody||a.responseText);e({type:"load",result:c})}else e({type:"error"})},a.send(null)):e({type:"error"});return a},encode64:function(b){var e="",a=0;for("string"!==typeof b&&(b=String(b));a<
b.length;){var c=b.charCodeAt(a++)&255,d=b.charCodeAt(a++)&255,k=b.charCodeAt(a++)&255,f=c>>2,c=(c&3)<<4|d>>4;isNaN(d)?d=k=64:(d=(d&15)<<2|k>>6,k=isNaN(k)?64:k&63);e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k)}return e}};j.addInfoReader(/^image/,
function(b,e){if(!b.__dimensions){var a=b.__dimensions=j.defer();j.readAsImage(b,function(b){var e=b.target;a.resolve("load"==b.type?!1:"error",{width:e.width,height:e.height})})}b.__dimensions.then(e)});j.event.dnd=function(b,e,a){var c,d;a||(a=e,e=j.F);t?(m(b,"dragenter dragleave dragover",function(b){for(var a=((b.originalEvent||b||"").dataTransfer||{}).types,k=a&&a.length;k--;)~a[k].indexOf("File")&&(b.preventDefault(),d!==b.type&&(d=b.type,"dragleave"!=d&&e.call(b.currentTarget,!0,b),clearTimeout(c),
c=setTimeout(function(){e.call(b.currentTarget,"dragleave"!=d,b)},50)))}),m(b,"drop",function(b){b.preventDefault();d=0;e.call(b.currentTarget,!1,b);j.getDropFiles(b,function(e){a.call(b.currentTarget,e,b)})})):j.log("Drag'n'Drop -- not supported")};s&&!s.fn.dnd&&(s.fn.dnd=function(b,e){return this.each(function(){j.event.dnd(this,b,e)})});a.FileAPI=j.extend(j,a.FileAPI);j.flashUrl||(j.flashUrl=j.staticPath+"FileAPI.flash.swf");j.flashImageUrl||(j.flashImageUrl=j.staticPath+"FileAPI.flash.image.swf")})(window);
(function(a,l,g){function m(a,c){if(!(this instanceof m))return new m(a);this.file=a;this.better=!c;this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0}}var n=Math.min,f=Math.round,c=!1,d={8:270,3:180,6:90};try{c=-1<l.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")}catch(h){}m.prototype={constructor:m,set:function(c){a.extend(this.matrix,c);return this},crop:function(a,c,d,f){d===g&&(d=a,f=c,a=c=0);return this.set({sx:a,sy:c,sw:d,sh:f||d})},resize:function(a,
c,d){"string"==typeof c&&(d=c,c=a);return this.set({dw:a,dh:c,resize:d})},preview:function(a,c){return this.set({dw:a,dh:c||a,resize:"preview"})},rotate:function(a){return this.set({deg:a})},_load:function(c,d){var f=this;a.readAsImage(c,function(a){d.call(f,"load"!=a.type,a.result)})},_apply:function(a,c){var d=l.createElement("canvas"),f=this.getMatrix(a),g=d.getContext("2d"),h=f.deg,n=f.dw,q=f.dh,t=a.width,p=a.height,s,e=a;if(this.better)for(;2<Math.min(t/n,p/q);)t=~~(t/2+0.5),p=~~(p/2+0.5),s=
l.createElement("canvas"),s.width=t,s.height=p,e!==a?(s.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t,p),e=s):(e=s,e.getContext("2d").drawImage(a,f.sx,f.sy,f.sw,f.sh,0,0,t,p),f.sx=f.sy=f.sw=f.sh=0);d.width=!(h%180)?n:q;d.height=h%180?n:q;g.rotate(h*Math.PI/180);g.drawImage(e,f.sx,f.sy,f.sw||e.width,f.sh||e.height,180==h||270==h?-n:0,90==h||180==h?-q:0,n,q);c.call(this,!1,d)},getMatrix:function(c){var d=a.extend({},this.matrix),h=d.sw=d.sw||c.width;c=d.sh=d.sh||c.height;var g=d.dw=d.dw||
d.sw,l=d.dh=d.dh||d.sh,r=h/c,m=g/l,q=d.resize;if("preview"==q){if(g!=h||l!=c)if(m>=r?(r=h,q=r/m):(q=c,r=q*m),r!=h||q!=c)d.sx=~~((h-r)/2),d.sy=~~((c-q)/2),h=r,c=q}else q&&("min"==q?(g=f(r<m?n(h,g):l*r),l=f(r<m?g/r:n(c,l))):(g=f(r>=m?n(h,g):l*r),l=f(r>=m?g/r:n(c,l))));d.sw=h;d.sh=c;d.dw=g;d.dh=l;return d},_trans:function(a){this._load(this.file,function(c,d){c?a(c):this._apply(d,a)})},get:function(c){if(a.support.transform){var f=this;"auto"==f.matrix.deg?a.getInfo(this.file,function(a,h){f.matrix.deg=
d[h&&h.exif&&h.exif.Orientation]||0;f._trans(c)}):f._trans(c)}else c("not_support")},toData:function(a){this.get(a)}};m.transform=function(c,d,f,h){a.getInfo(c,function(n,l){var w={},q=a.queue(function(a){h(a,w)});n?q.fail():a.each(d,function(a,d){if(!q.isFail()){var k=m(l.nodeType?l:c);if("function"==typeof a)a(l,k);else if(a.width)k[a.preview?"preview":"resize"](a.width,a.height,a.type);else a.maxWidth&&(l.width>a.maxWidth||l.height>a.maxHeight)&&k.resize(a.maxWidth,a.maxHeight,"max");a.rotate===
g&&f&&(a.rotate="auto");k.rotate(a.rotate);q.inc();k.toData(function(a,c){a?q.fail():(w[d]=c,q.next())})}})})};a.support.canvas=a.support.transform=c;a.Image=m})(FileAPI,document);
(function(a,l,g){var m=l.encodeURIComponent,n=l.FormData;l=function(){this.items=[]};l.prototype={append:function(a,c,d,h){this.items.push({name:a,blob:c&&c.blob||c,file:d||c.name,type:h||c.type})},each:function(a){for(var c=0,d=this.items.length;c<d;c++)a.call(this,this.items[c])},toData:function(f,c){c._chunked=a.support.chunked&&0<c.chunkSize&&1==a.filter(this.items,function(a){return a.file}).length;a.support.html5?this.multipart?(a.log("FileAPI.Form.toMultipartData"),this.toMultipartData(f)):
c._chunked?(a.log("FileAPI.Form.toPlainData"),this.toPlainData(f)):(a.log("FileAPI.Form.toFormData"),this.toFormData(f)):(a.log("FileAPI.Form.toHtmlData"),this.toHtmlData(f))},_to:function(f,c,d,h){var g=a.queue(function(){c(f)});this.each(function(a){d(a,f,g,h)});g.check()},toHtmlData:function(f){this._to(g.createDocumentFragment(),f,function(c,d){var f=c.blob,n;c.file?(a.reset(f),f.name=c.name,d.appendChild(f)):(n=g.createElement("input"),n.name=c.name,n.type="hidden",n.value=f,d.appendChild(n))})},
toPlainData:function(a){this._to({},a,function(a,d,f){a.file&&(d.type=a.file);a.blob.toBlob?(f.inc(),a.blob.toBlob(function(g){d.name=a.name;d.file=g;d.size=g.length;d.type=a.type;f.next()},"image/png")):a.file?(d.name=a.blob.name,d.file=a.blob,d.size=a.blob.size,d.type=a.type):(d.params||(d.params=[]),d.params.push(encodeURIComponent(a.name)+"="+encodeURIComponent(a.blob)));d.start=-1;d.end=-1;d.retry=0})},toFormData:function(a){this._to(new n,a,function(a,d,f){a.file&&d.append("_"+a.name,a.file);
a.blob&&a.blob.toBlob?(f.inc(),a.blob.toBlob(function(g){d.append(a.name,g,a.file);f.next()},"image/png")):a.file?d.append(a.name,a.blob,a.file):d.append(a.name,a.blob)})},toMultipartData:function(f){this._to([],f,function(a,d,f,g){d.push("--_"+g+('\r\nContent-Disposition: form-data; name="'+a.name+'"'+(a.file?'; filename="'+m(a.file)+'"':"")+(a.file?"\r\nContent-Type: "+(a.type||"application/octet-stream"):"")+"\r\n\r\n"+(a.file?a.blob:m(a.blob))+"\r\n"))},a.expando)}};a.Form=l})(FileAPI,window,
document);
(function(a,l){var g=function(){},m=function(a){this.uid=l.uid();this.xhr={abort:g,getResponseHeader:g,getAllResponseHeaders:g};this.options=a};m.prototype={status:0,statusText:"",getResponseHeader:function(a){return this.xhr.getResponseHeader(a)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(n,f){var c=this,d=c.options;c.end=c.abort=g;c.status=n;f&&(c.statusText=f);l.log("xhr.end:",n,f);d.complete(200==n||201==n?!1:c.statusText||"unknown",c);c.xhr&&c.xhr.node&&
setTimeout(function(){var d=c.xhr.node;try{d.parentNode.removeChild(d)}catch(f){}try{delete a[c.uid]}catch(k){}a[c.uid]=c.xhr.node=null},9)},abort:function(){this.end(0,"abort");this.xhr&&(this.xhr.aborted=!0,this.xhr.abort())},send:function(a){var f=this,c=this.options;a.toData(function(a){c.upload(c,f);f._send.call(f,c,a)},c)},_send:function(g,f){var c=this,d,h=c.uid,m=g.url;l.log("XHR._send:",f);m+=(~m.indexOf("?")?"&":"?")+l.uid();f.nodeName?(g.upload(g,c),d=document.createElement("div"),d.innerHTML=
'<form target="'+h+'" action="'+m+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+h+'" src="javascript:false;"></iframe><input value="'+h+'" name="callback" type="hidden"/></form>',c.xhr.abort=function(){var a=d.getElementsByName("iframe")[0];if(a)try{a.stop?a.stop():a.contentWindow.stop?a.contentWindow.stop():a.contentWindow.document.execCommand("Stop")}catch(c){}d=null},m=d.getElementsByTagName("form")[0],
m.appendChild(f),l.log(m.parentNode.innerHTML),document.body.appendChild(d),c.xhr.node=d,a[h]=function(a,f,g){c.readyState=4;c.responseText=g;c.end(a,f);d=null},c.readyState=2,m.submit(),m=null):(d=c.xhr=l.getXHR(),f.params&&(m+=(0>m.indexOf("?")?"?":"&")+f.params.join("&")),d.open("POST",m,!0),d.withCredential="true",(!g.headers||!g.headers["X-Requested-With"])&&d.setRequestHeader("X-Requested-With","XMLHttpRequest"),l.each(g.headers,function(a,c){d.setRequestHeader(c,a)}),g._chunked?(d.upload&&
d.upload.addEventListener("progress",function(a){f.retry||g.progress({type:a.type,total:f.size,loaded:f.start+a.loaded,totalSize:f.size},c,g)},!1),d.onreadystatechange=function(){c.status=d.status;c.statusText=d.statusText;c.readyState=d.readyState;if(4==d.readyState){for(var a in{"":1,XML:1,Text:1,Body:1})c["response"+a]=d["response"+a];d.onreadystatechange=null;if(!d.status||0<d.status-201)if(l.log("Error: "+d.status),(!d.status&&!d.aborted||500==d.status||416==d.status)&&++f.retry<=g.chunkUploadRetry){a=
d.status?0:l.chunkNetworkDownRetryTimeout;g.pause(f.file,g);var h=d.getResponseHeader("X-Last-Known-Byte");l.log("X-Last-Known-Byte: "+h);f.end=h?parseInt(h):f.start-1;setTimeout(function(){c._send(g,f)},a)}else c.end(d.status);else f.retry=0,f.end==f.size-1?c.end(d.status):setTimeout(function(){c._send(g,f)},0);d=null}},f.start=f.end+1,f.end=Math.min(f.start+g.chunkSize,f.size)-1,(h="slice")in f.file||(h="mozSlice")in f.file||(h="webkitSlice"),d.setRequestHeader("Content-Range","bytes "+f.start+
"-"+f.end+"/"+f.size),d.setRequestHeader("Content-Disposition","attachment; filename="+encodeURIComponent(f.name)),d.setRequestHeader("Content-Type",f.type||"application/octet-stream"),h=f.file[h](f.start,f.end+1),d.send(h),h=null):(d.upload&&d.upload.addEventListener("progress",l.throttle(function(a){g.progress(a,c,g)},100),!1),d.onreadystatechange=function(){c.status=d.status;c.statusText=d.statusText;c.readyState=d.readyState;if(4==d.readyState){for(var a in{"":1,XML:1,Text:1,Body:1})c["response"+
a]=d["response"+a];d.onreadystatechange=null;c.end(d.status);d=null}},l.isArray(f)?(d.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+l.expando),f=f.join("")+"--_"+l.expando+"--",d.sendAsBinary?d.sendAsBinary(f):(h=Array.prototype.map.call(f,function(a){return a.charCodeAt(0)&255}),d.send((new Uint8Array(h)).buffer))):d.send(f)))}};l.XHR=m})(window,FileAPI);
(function(a,l,g){var m=a.support,n=l.navigator,f=n.mimeTypes,c=!1;if(n.plugins&&"object"==typeof n.plugins["Shockwave Flash"])c=n.plugins["Shockwave Flash"].description&&!(f&&f["application/x-shockwave-flash"]&&!f["application/x-shockwave-flash"].enabledPlugin);else try{c=!(!l.ActiveXObject||!new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(d){a.log("ShockwaveFlash.ShockwaveFlash -- does not supported.")}m.flash=c;if(a.support.flash&&(!a.support.html5||a.cors&&!a.support.cors)){var h=function(a){return('<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+
(a.width||"100%")+'" height="'+(a.height||"100%")+'"><param name="movie" value="#src#" /><param name="flashvars" value="#flashvars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="menu" value="false" /><param name="wmode" value="#wmode#" /><embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#" width="'+(a.width||"100%")+'" height="'+
(a.height||"100%")+'" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>').replace(/#(\w+)#/ig,function(c,d){return a[d]})},x=function(a,c){if(a&&a.style){var d,f;for(d in c){f=c[d];"number"==typeof f&&(f+="px");try{a.style[d]=f}catch(g){}}}},k=function(e,c){a.each(c,function(a,c){var d=e[c];e[c]=function(){this.parent=d;return a.apply(this,arguments)}})},A=function(e){var c=e.wid=a.uid();p._fn[c]=e;return"FileAPI.Flash._fn."+c},v=function(a){try{p._fn[a.wid]=
null,delete p._fn[a.wid]}catch(c){}},D=function(a,c){if(!t.test(a)){if(/^\.\//.test(a)||"/"!=a.charAt(0)){var d=location.pathname,d=d.substr(0,d.lastIndexOf("/"));a=(d+"/"+a).replace("/./","/")}"//"!=a.substr(0,2)&&(a="//"+location.host+a);t.test(a)||(a=location.protocol+a)}c&&(a+=(/\?/.test(a)?"&":"?")+c);return a},r=a.uid(),w=0,q={},t=/^https?:/i,p={_fn:{},init:function(){var e=g.body&&g.body.firstChild;if(e){do if(1==e.nodeType){a.log("FlashAPI.Flash.init...");var c=g.createElement("div");x(c,
{top:1,right:1,width:5,height:5,position:"absolute"});e.parentNode.insertBefore(c,e);p.publish(c,r);return}while(e=e.nextSibling)}10>w&&setTimeout(p.init,50*++w)},publish:function(e,c){e.innerHTML=h({id:c,src:D(a.flashUrl,"r="+a.version),wmode:"transparent",flashvars:"callback=FileAPI.Flash.event&flashId="+c+"&storeKey="+navigator.userAgent.match(/\d/ig).join("")+"_"+a.version+(p.isReady||(a.pingUrl?"&ping="+a.pingUrl:""))})},ready:function(){p.ready=a.F;p.isReady=!0;p.patch();a.event.on(g,"mouseover",
p.mouseover);a.event.on(g,"click",function(a){p.mouseover(a)&&(a.preventDefault?a.preventDefault():a.returnValue=!0)})},getWrapper:function(a){do if(/js-fileapi-wrapper/.test(a.className))return a;while((a=a.parentNode)&&a!==g.body)},mouseover:function(e){e=a.event.fix(e).target;if(/input/i.test(e.nodeName)&&"file"==e.type){var c=e.getAttribute(r);if("i"==c||"r"==c)return!1;if("p"!=c){e.setAttribute(r,"i");var c=g.createElement("div"),d=p.getWrapper(e);if(!d){a.log("flash.mouseover.error: js-fileapi-wrapper not found");
return}x(c,{top:0,left:0,width:e.offsetWidth+100,height:e.offsetHeight+100,zIndex:"1000000",position:"absolute"});d.appendChild(c);p.publish(c,a.uid());e.setAttribute(r,"p")}return!0}},event:function(e){var c=e.type;if("ready"==c){try{p.getInput(e.flashId).setAttribute(r,"r")}catch(d){}p.ready();setTimeout(function(){p.mouseenter(e)},50);return!0}"ping"===c?a.log("(flash -> js).ping:",[e.status,e.savedStatus],e.error):"log"===c?a.log("(flash -> js).log:",e.target):c in p&&setTimeout(function(){a.log("Flash.event."+
e.type+":",e);p[c](e)},1)},mouseenter:function(e){var c=p.getInput(e.flashId);if(c){p.cmd(e,"multiple",null!=c.getAttribute("multiple"));var d=[],f={};a.each((c.getAttribute("accept")||"").split(/,\s*/),function(e){a.accept[e]&&a.each(a.accept[e].split(" "),function(a){f[a]=1})});a.each(f,function(a,e){d.push(e)});p.cmd(e,"accept",d.length?"."+d.join(",."):"*")}},get:function(a){return g[a]||l[a]||g.embeds[a]},getInput:function(e){try{var c=p.getWrapper(p.get(e));if(c)return c.getElementsByTagName("input")[0]}catch(d){a.log('Can not find "input" by flashId:',
e,d)}},select:function(e){var c=p.getInput(e.flashId),d=a.uid(c);e=e.target.files;a.each(e,function(e){a.checkFileObj(e)});q[d]=e;g.createEvent?(d=g.createEvent("Event"),d.initEvent("change",!0,!1),c.dispatchEvent(d)):g.createEventObject&&(d=g.createEventObject(),c.fireEvent("onchange",d))},cmd:function(e,c,d,f){try{return a.log("(js -> flash)."+c+":",d),p.get(e.flashId||e).cmd(c,d)}catch(g){a.log("(js -> flash).onError:",g),f||setTimeout(function(){p.cmd(e,c,d,!0)},50)}},patch:function(){a.flashEngine=
a.support.transform=!0;k(a,{getFiles:function(e,c,d){if(d)return a.filterFiles(a.getFiles(e),c,d),null;var f=a.isArray(e)?e:q[a.uid(e.target||e.srcElement||e)];if(!f)return this.parent.apply(this,arguments);c&&(c=a.getFilesFilter(c),f=a.filter(f,function(a){return c.test(a.name)}));return f},getInfo:function(a,c){if(a&&!a.flashId)this.parent.apply(this,arguments);else{if(!a.__info){var d=a.__info=FileAPI.defer();p.cmd(a,"getFileInfo",{id:a.id,callback:A(function E(c,f){v(E);d.resolve(c,a.info=f)})})}a.__info.then(c)}}});
a.support.transform=!0;FileAPI.Image&&k(FileAPI.Image.prototype,{get:function(a,c){this.set({scaleMode:c||"noScale"});this.parent(a)},_load:function(c,d){a.log("FileAPI.Image._load:",c);if(c&&!c.flashId)this.parent.apply(this,arguments);else{var f=this;a.getInfo(c,function(a){d.call(f,a,c)})}},_apply:function(c,d){a.log("FileAPI.Image._apply:",c);if(c&&!c.flashId)this.parent.apply(this,arguments);else{var f=this.getMatrix(c.info);p.cmd(c,"imageTransform",{id:c.id,matrix:f,callback:A(function E(k,
l){a.log("FileAPI.Image._apply.callback:",k);v(E);if(k)d(k);else if(!a.support.dataURI||3E4<l.length){var m={width:!(f.deg%180)?f.dw:f.dh,height:f.deg%180?f.dw:f.dh,scale:f.scaleMode},n=d,r=function(){try{p.get(s).setImage(l)}catch(c){a.log('flash.setImage -- can not set "base64":',c)}},q,s=a.uid(),t=g.createElement("div");for(q in m)t.setAttribute("data-img-"+q,m[q]);x(t,m);t.innerHTML=h(a.extend({id:s,src:D(a.flashImageUrl,"r="+a.uid()),wmode:"opaque",flashvars:"scale="+m.scale+"&callback="+A(function z(){v(z);
setTimeout(r,99);return!0})},m));n(!1,t);t=null}else{var w=new Image;a.event.one(w,"error abort load",function(a){d("load"!=a.type&&a.type,w);w=null});w.src="data:"+c.type+";base64,"+l}})})}},toData:function(a){var c=this.file;c&&!c.flashId?this.parent.apply(this,arguments):a.call(this,!c.info,{id:c.id,flashId:c.flashId,name:c.name,type:c.type,matrix:this.getMatrix(c.info)})}});k(a.Form.prototype,{toData:function(c){for(var d=this.items,f=d.length;f--;)if(d[f].file&&d[f].blob&&!d[f].blob.flashId)return this.parent.apply(this,
arguments);a.log("flash.Form.toData");c(d)}});k(a.XHR.prototype,{_send:function(c,d){if(d.nodeName||d.append&&a.support.html5||a.isArray(d)&&"string"===typeof d[0])return this.parent.apply(this,arguments);var f={},g={},h=this,k,l;a.each(d,function(a){a.file?(g[a.name]=a={id:a.blob.id,name:a.blob.name,matrix:a.blob.matrix,flashId:a.blob.flashId},l=a.id,k=a.flashId):f[a.name]=a.blob});a.log("flash.XHR._send:",k,l,g);h.xhr={headers:{},abort:function(){p.cmd(k,"abort",{id:l})},getResponseHeader:function(a){return this.headers[a]},
getAllResponseHeaders:function(){return this.headers}};var m=a.queue(function(){p.cmd(k,"upload",{url:D(c.url),data:f,files:g,headers:c.headers,callback:A(function G(d){var f=d.type,g=d.result;a.log("flash.upload."+f+":",d);if("progress"==f)d.loaded=Math.min(d.loaded,d.total),d.lengthComputable=!0,c.progress(d);else if("complete"==f)v(G),"string"==typeof g&&(h.responseText=g.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")),h.end(d.status||200);else if("abort"==f||
"error"==f)h.end(d.status||0,d.message),v(G)})})});a.each(g,function(c){m.inc();a.getInfo(c,m.next)});m.check()}})}};a.Flash=p;var s=new Image;a.event.one(s,"error load",function(){a.support.dataURI=!(1!=s.width||1!=s.height);s=null;p.init()});s.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}})(FileAPI,window,document);"undefined"!==typeof ajs&&ajs.loaded&&ajs.loaded("{fileapi}FileAPI.min");
"function"===typeof define&&define.amd&&define("FileAPI",[],function(){return window.FileAPI||{}});