/**!
 * FileAPI â€” a set of tools for working with files
 *
 * @author  RubaXa  <trash@rubaxa.org>
 * @build	lib/canvas-to-blob lib/FileAPI.core lib/FileAPI.Image lib/FileAPI.Form lib/FileAPI.XHR lib/FileAPI.Flash
 */
(function(a){var l=a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype,g;if(g=a.Blob)try{g=Boolean(new Blob)}catch(n){g=!1}var m=g;if(g=m)if(g=a.Uint8Array)try{g=100===(new Blob([new Uint8Array(100)])).size}catch(f){g=!1}var c=g,e=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder,j=(m||e)&&a.atob&&a.ArrayBuffer&&a.Uint8Array&&function(a){var j,g,f,p;j=0<=a.split(",")[0].indexOf("base64")?atob(a.split(",")[1]):decodeURIComponent(a.split(",")[1]);g=new ArrayBuffer(j.length);f=new Uint8Array(g);
for(p=0;p<j.length;p+=1)f[p]=j.charCodeAt(p);a=a.split(",")[0].split(":")[1].split(";")[0];if(m)return new Blob([c?f:g],{type:a});f=new e;f.append(g);return f.getBlob(a)};a.HTMLCanvasElement&&!l.toBlob&&(l.mozGetAsFile?l.toBlob=function(a,c){a(this.mozGetAsFile("blob",c))}:l.toDataURL&&j&&(l.toBlob=function(a,c){a(j(this.toDataURL(c)))}));"function"===typeof define&&define.amd?define(function(){return j}):a.dataURLtoBlob=j})(this);
(function(a,l){function g(b,r,a){if(b)if(w(b))for(var d=0,c=b.length;d<c;d++)d in b&&r.call(a,b[d],d,b);else for(d in b)b.hasOwnProperty(d)&&r.call(a,b[d],d,b)}function n(b,r,d){if(b){var a=i.uid(b);B[a]||(B[a]={});g(r.split(/\s+/),function(r){t?t.event.add(b,r,d):(B[a][r]||(B[a][r]=[]),B[a][r].push(d),b.addEventListener?b.addEventListener(r,d,!1):b.attachEvent?b.attachEvent("on"+r,d):b["on"+r]=d)})}}function m(b,r,d){if(b){var a=i.uid(b),c=B[a]||{};g(r.split(/\s+/),function(r){if(t)t.event.remove(b,
r,d);else{for(var a=c[r]||[],x=a.length;x--;)if(a[x]===d){a.splice(x,1);break}b.addEventListener?b.removeEventListener(r,d,!1):b.detachEvent?b.detachEvent("on"+r,d):b["on"+r]=null}})}}function f(b,r,d){n(b,r,function L(a){m(b,r,L);d(a)})}function c(b,r,d,a,c){b={type:d.type||d,target:b,result:a};i.extend(b,c);r(b)}function e(b,r,d,a){if(i.isFile(b)&&s&&s.prototype["readAs"+d]){var h=new s;n(h,F,function N(d){var a=d.type;"progress"==a?c(b,r,d,d.target.result,{loaded:d.loaded,total:d.total}):"loadend"==
a?(m(h,F,N),h=null):c(b,r,d,d.target.result)});try{if(a)h["readAs"+d](a,b);else h["readAs"+d](b)}catch(j){c(b,r,"error",l,{error:j.toString()})}}else c(b,r,"error",l,{error:"filreader_not_support_"+d})}function j(b){var d;b.getAsEntry?d=b.getAsEntry():b.webkitGetAsEntry&&(d=b.webkitGetAsEntry());return d}function u(b,d){if(b)if(b.isFile)b.file(function(b){d(!1,[b])},function(){d("entry_file")});else if(b.isDirectory){var a=[];b.createReader().readEntries(function(b){i.afor(b,function(b,c){u(c,function(c,
x){c||(a=a.concat(x));b?b():d(!1,a)})})},function(){d("directory_reader")})}else u(j(b),d);else d("empty_entry")}function w(b){return"object"==typeof b&&b&&"length"in b}function z(b){b.target||(b.target=a.event&&a.event.srcElement||v);3===b.target.nodeType&&(b.target=event.target.parentNode);return b}var A=1,p=a.createObjectURL&&a||a.URL&&URL.revokeObjectURL&&URL||a.webkitURL&&webkitURL,q=a.File,s=a.FileReader,C=a.FormData,t=a.jQuery,k=!(!q||!(s&&a.Uint8Array||C)),C=k&&"withCredentials"in new XMLHttpRequest,
v=a.document,d=a.dataURLtoBlob,h={},O=/img/i,H=/canvas/i,I=/img|canvas/,E=/input/i,P=/^data:[^,]+,/,J=Math.pow,B={},D=[],F="abort progress error load loadend",Q="status statusText readyState response responseXML responseText responseBody".split(" "),i={build:3,cors:!1,debug:!1,staticPath:"./",KB:1024,MB:J(1024,2),GB:J(1024,3),TB:J(1024,4),expando:"fileapi"+ +new Date,uid:function(b){return b?b[i.expando]=b[i.expando]||i.uid():i.expando+ ++A},log:function(){i.debug&&(a.console&&console.log)&&(console.log.apply?
console.log.apply(console,arguments):console.log([].join.call(arguments," ")))},getXHR:function(){var b;if(a.XMLHttpRequest)b=new XMLHttpRequest;else if(a.ActiveXObject)try{b=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(d){}return b},isArray:w,support:{dnd:C&&"ondrop"in v.createElement("div"),cors:C,html5:k,dataURI:!0},event:{on:n,off:m,one:f,fix:z},throttle:function(b,d){var c,x,h;return function M(){x=arguments;h=!0;c||(h?(b.apply(a,x),h=!1,c=setTimeout(M,d)):c=null)}},F:function(){},parseJSON:function(b){return a.JSON&&
JSON.parse?JSON.parse(b):(new Function("return ("+b.replace(/([\r\n])/g,"\\$1")+");"))()},trim:function(b){b=String(b);return b.trim?b.trim():b.replace(/^\s+|\s+$/g,"")},queue:function(b){var d=0,a=0,c=!1,h=!1,j={inc:function(){a++},next:function(){d++;setTimeout(j.check,0)},check:function(){d>=a&&!c&&j.end()},isFail:function(){return c},fail:function(){!c&&b(c=!0)},end:function(){h||(h=!0,b())}};return j},each:g,afor:function(b,d){var a=0,c=b.length;w(b)&&c--?function y(){d(c!=a&&y,b[a],a++)}():
d(!1)},extend:function(b){g(arguments,function(d){g(d,function(d,a){b[a]=d})});return b},isFile:function(b){return k&&b&&b instanceof q},isCanvas:function(b){return b&&H.test(b.nodeName)},getFilesFilter:function(b){return(b="string"==typeof b?b:b.getAttribute&&b.getAttribute("accept")||"")?RegExp("("+b.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(b,d){i.isCanvas(b)?c(b,d,"load",i.toDataURL(b)):e(b,d,"DataURL")},readAsBinaryString:function(b,d){s&&s.prototype.readAsBinaryString?
e(b,d,"BinaryString"):e(b,function(b){if("load"==b.type)try{b.result=i.toBinaryString(b.result)}catch(a){b.type="error",b.message=a.toString()}d(b)},"DataURL")},readAsArrayBuffer:function(b,d){e(b,d,"ArrayBuffer")},readAsText:function(b,d,a){a||(a=d,d="utf-8");e(b,a,"Text",d)},toDataURL:function(b){if("string"==typeof b)return b;if(b.toDataURL)return b.toDataURL("image/png")},toBinaryString:function(b){return a.atob(i.toDataURL(b).replace(P,""))},readAsImage:function(b,d,a){if(i.isFile(b))if(p){var h=
p.createObjectURL(b);h===l?c(b,d,"error"):i.readAsImage(h,d,a)}else i.readAsDataURL(b,function(h){"load"==h.type?i.readAsImage(h.result,d,a):(a||"error"==h.type)&&c(b,d,h,null,{loaded:h.loaded,total:h.total})});else i.isCanvas(b)?c(b,d,"load",b):O.test(b.nodeName)?b.complete?c(b,d,"load",b):f(b,"error abort load",function y(a){"load"==a.type&&p&&p.revokeObjectURL(b.src);m(b,"error abort load",y);c(b,d,a,b)}):b.iframe?c(b,d,{type:"error"}):(h=new Image,h.src=b.dataURL||b,i.readAsImage(h,d,a))},checkFileObj:function(b){var d=
{};"object"==typeof b?d=b:d.name=(b+"").split(/(\\|\/)/g).pop();d.type===l&&(d.type=d.name.split(".").pop());g(h,function(b,a){b.test(d.type)&&(d.type=a+"/"+d.type)});return d},getDropFiles:function(b,d){var a=[],c=(b.originalEvent||b||"").dataTransfer||{},h=w(c.items)&&c.items[0]&&j(c.items[0]),e=i.queue(function(){d(a)});g((h?c.items:c.files)||[],function(b){e.inc();if(h)u(b,function(b,d){!b&&a.push.apply(a,d);e.next()});else{var d=function(d){d&&a.push(b);e.next()};if(!b.type&&0==b.size%4096&&
102400>=b.size)if(s)try{var c=new s;f(c,F,function(b){b="error"!=b.type;d(b);b&&c.abort()});c.readAsDataURL(b)}catch(r){d(!1)}else d(null);else d(!0)}});e.check()},getFiles:function(b,d,a){var c=[];if(a)return i.filterFiles(i.getFiles(b),d,a),null;b.jquery&&(b.each(function(){c=c.concat(i.getFiles(this))}),b=c,c=[]);"string"==typeof d&&(d=i.getFilesFilter(d));b.originalEvent&&(b=z(b.originalEvent));b.dataTransfer?b=b.dataTransfer:b.target&&(b=b.target);b.files?c=b.files:!k&&E.test(b&&b.tagName)?i.trim(b.value)&&
(c=[i.checkFileObj(b.value)],c[0].blob=b,c[0].iframe=!0):w(b)&&(c=b);!d&&E.test(b&&b.tagName)&&(d=i.getFilesFilter(b));return i.filter(c,function(b){return!d||d.test(b.name)})},getInfo:function(b,d){var a={},c=D.concat();i.isFile(b)?function y(){var h=c.shift();h?h.test(b.type)?h(b,function(b,c){b?d(b):(i.extend(a,c),y())}):y():d(!1,a)}():d("not_support",a)},addInfoReader:function(b,d){d.test=function(d){return b.test(d)};D.push(d)},addMime:function(b,d){h[b]=RegExp("("+d.replace(/,/g,"|")+")$","i")},
filter:function(b,d){for(var a=[],c=0,h=b.length,j;c<h;c++)c in b&&(j=b[c],d.call(j,j,c,b)&&a.push(j));return a},filterFiles:function(b,d,a){if(b.length){var c=b.concat(),h,j=[],u=[];(function G(){c.length?(h=c.shift(),i.getInfo(h,function(b,a){(d(h,b?!1:a)?j:u).push(h);G()})):a(j,u)})()}else a([],b)},upload:function(b){var b=i.extend({beforeupload:i.F,upload:i.F,fileupload:i.F,fileprogress:i.F,filecomplete:i.F,progress:i.F,complete:i.F},b),d=new i.XHR(b),a=this._getFilesDataArray(b.files),c=0,h=
0,j=0,u=1;g(a,function(b){c+=b.size});d.total=c;d.loaded=0;b.beforeupload(d,b);(function G(){var e=a.shift(),w=this;d.currentFile=e;"abort"!=d.statusText&&e?this._getFormData(b,e,function(a){h||b.upload(d,b);var f=e.file,k=new i.XHR(i.extend({},b,{upload:function(){b.fileupload(f,k,b)},progress:function(a){a.lengthComputable&&(j=h+=~~(c*u*(a.loaded/a.total)-j+0.5),b.fileprogress(a,f,k,b),b.progress({type:a.type,total:c,loaded:d.loaded=h,lengthComputable:!0},f,k,b))},complete:function(a){g(Q,function(b){d[b]=
k[b]});d.loaded=h+=h-j+~~(c*u+0.5);b.filecomplete(a,k,f,b);G.call(w)}}));u=e.size/c;d.abort=function(){k.abort()};k.send(a)}):b.complete(200==d.status?!1:d.statusText||"error",d,b)}).call(this);return d},_getFilesDataArray:function(b){var d=[],a={};if(E.test(b&&b.tagName)){var c=i.getFiles(b);a[b.name||"file"]=null!==b.getAttribute("multiple")?c:c[0]}else w(b)&&E.test(b[0]&&b[0].tagName)?g(b,function(b){a[b.name||"file"]=i.getFiles(b)}):a=b;g(a,function y(b,a){w(b)?g(b,function(b,d){y(b,a+"["+d+"]")}):
b&&b.name&&d.push({name:a,file:b,size:b.size})});return d},_getFormData:function(b,a,c){var h=a.file,j=a.name,u=h.name,e=h.type,w=(a=i.support.transform&&b.imageTransform)&&"number"==typeof(a.maxWidth||a.minWidth||a.width),f=new i.Form,k=i.queue(function(){c(f)});a&&(/image/.test(h.type)||I.test(h.nodeType))?(k.inc(),w&&(a=[a]),i.Image.transform(h,a,function(a,c){w&&!a?(!d&&!i.flashEngine&&(c[0]=i.toBinaryString(c[0]),f.multipart=!0),f.append(j,c[0],u,e)):(a||(g(c,function(b,a){!d&&!i.flashEngine&&
(b=i.toBinaryString(b),f.multipart=!0);f.append(j+"["+a+"]",b,u,e)}),j+="[original]"),(a||b.imageOriginal)&&f.append(j,h,u,e));k.next()})):f.append(j,h,u);g(b.data,function R(b,d){"object"==typeof b?g(b,function(b,a){R(b,d+"["+a+"]")}):f.append(d,b)});k.check()},reset:function(b){var d,a;t?(a=t(b).clone(!0).insertBefore(b).val("")[0],t(b).remove()):(d=b.parentNode,a=d.insertBefore(b.cloneNode(!0),b),a.value="",d.removeChild(b),g(B[i.uid(b)],function(d,c){g(d,function(d){m(b,c,d);n(a,c,d)})}));return a},
load:function(b,d){var a=i.getXHR();a?(a.open("GET",b,!0),a.overrideMimeType&&a.overrideMimeType("text/plain; charset=x-user-defined"),n(a,"progress",function(b){b.lengthComputable&&d({type:b.type,loaded:b.loaded,total:b.total},a)}),a.onreadystatechange=function(){if(4==a.readyState)if(a.onreadystatechange=null,200==a.status){b=b.split("/");var c={name:b[b.length-1],size:a.getResponseHeader("Content-Length"),type:a.getResponseHeader("Content-Type")};c.dataURL="data:"+c.type+";base64,"+i.encode64(a.responseBody||
a.responseText);d({type:"load",result:c})}else d({type:"error"})},a.send(null)):d({type:"error"});return a},encode64:function(b){var d="",a=0;for("string"!==typeof b&&(b=String(b));a<b.length;){var c=b.charCodeAt(a++)&255,h=b.charCodeAt(a++)&255,j=b.charCodeAt(a++)&255,u=c>>2,c=(c&3)<<4|h>>4;isNaN(h)?h=j=64:(h=(h&15)<<2|j>>6,j=isNaN(j)?64:j&63);d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(u)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(j)}return d}};g({image:"png,jpg,jpeg,bmp,gif,ico,tif,tiff,tga,pcx,cbz,cbr",audio:"m4a,flac,aac,rm,mpa,wav,wma,ogg,mp3,mp2,m3u,mod,amf,dmf,dsm,far,gdm,imf,it,m15,med,okt,s3m,stm,sfx,ult,uni,xm,sid,ac3,dts,cue,aif,aiff,wpl,ape,mac,mpc,mpp,shn,wv,nsf,spc,gym,adplug,adx,dsp,adp,ymf,ast,afc,hps,xsp",video:"m4v,3gp,nsv,ts,ty,strm,rm,rmvb,m3u,ifo,mov,qt,divx,xvid,bivx,vob,nrg,img,iso,pva,wmv,asf,asx,ogm,m2v,avi,bin,dat,dvr-ms,mpg,mpeg,mp4,mkv,avc,vp3,svq3,nuv,viv,dv,fli,flv,wpl"},
function(b,d){i.addMime(d,b)});i.addInfoReader(/^image/,function(b,d){i.readAsImage(b,function(b){var a=b.target;d("load"==b.type?!1:"error",{width:a.width,height:a.height})})});i.event.dnd=function(b,d,a){var c,h;a||(a=d,d=i.F);s?(n(b,"dragenter dragleave dragover",function(b){for(var a=((b.originalEvent||b||"").dataTransfer||{}).types,j=a&&a.length;j--;)~a[j].indexOf("File")&&(b.preventDefault(),h!==b.type&&(h=b.type,"dragleave"!=h&&d.call(b.currentTarget,!0,b),clearTimeout(c),c=setTimeout(function(){d.call(b.currentTarget,
"dragleave"!=h,b)},50)))}),n(b,"drop",function(b){b.preventDefault();h=0;d.call(b.currentTarget,!1,b);i.getDropFiles(b,function(d){a.call(b.currentTarget,d,b)})})):i.log("Drag'n'Drop -- not supported")};t&&!t.fn.dnd&&(t.fn.dnd=function(b,d){return this.each(function(){i.event.dnd(this,b,d)})});a.FileAPI=i.extend(i,a.FileAPI)})(window);
(function(a,l,g){function n(a,c){if(!(this instanceof n))return new n(a);this.data=a;this.better=!c;this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0}}var m=Math.min,f=Math.round,c=!1;try{c=-1<l.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")}catch(e){}n.prototype={constructor:n,set:function(c){a.extend(this.matrix,c);return this},crop:function(a,c,e,f){e===g&&(e=a,f=c,a=c=0);return this.set({sx:a,sy:c,sw:e,sh:f||e})},resize:function(a,c,e){"string"==typeof c&&
(e=c,c=a);return this.set({dw:a,dh:c,resize:e})},preview:function(a,c){return this.set({dw:a,dh:c||a,resize:"preview"})},rotate:function(a){return this.set({deg:a})},_load:function(c,e){var f=this;a.readAsImage(c,function(a){e.call(f,"load"!=a.type,a.result)})},_apply:function(a,c){var e=l.createElement("canvas"),f=this.getMatrix(a),g=e.getContext("2d"),m=f.deg,q=f.dw,s=f.dh,n=a.width,t=a.height,k,v=a;if(this.better)for(;2<Math.min(n/q,t/s);)n=~~(n/2+0.5),t=~~(t/2+0.5),k=l.createElement("canvas"),
k.width=n,k.height=t,v!==a?(k.getContext("2d").drawImage(v,0,0,v.width,v.height,0,0,n,t),v=k):(v=k,v.getContext("2d").drawImage(a,f.sx,f.sy,f.sw,f.sh,0,0,n,t),f.sx=f.sy=f.sw=f.sh=0);e.width=!(m%180)?q:s;e.height=m%180?q:s;g.rotate(m*Math.PI/180);g.drawImage(v,f.sx,f.sy,f.sw||v.width,f.sh||v.height,180==m||270==m?-q:0,90==m||180==m?-s:0,q,s);c.call(this,!1,e)},getMatrix:function(c){var e=a.extend({},this.matrix),g=e.sw=e.sw||c.width,c=e.sh=e.sh||c.height,l=e.dw=e.dw||e.sw,n=e.dh=e.dh||e.sh,p=g/c,q=
l/n,s=e.resize;if("preview"==s){if(l!=g||n!=c)if(q>=p?(p=g,s=p/q):(s=c,p=s*q),p!=g||s!=c)e.sx=~~((g-p)/2),e.sy=~~((c-s)/2),g=p,c=s}else s&&("min"==s?(l=f(p<q?m(g,l):n*p),n=f(p<q?l/p:m(c,n))):(l=f(p>=q?m(g,l):n*p),n=f(p>=q?l/p:m(c,n))));e.sw=g;e.sh=c;e.dw=l;e.dh=n;return e},get:function(c){a.support.transform?this._load(this.data,function(a,e){a?c(a):this._apply(e,c)}):c("not_support")},toData:function(a){this.get(a)}};n.transform=function(c,e,f){a.getInfo(c,function(g,m){var l={},q=a.queue(function(a){f(a,
l)});g?q.fail():a.each(e,function(a,e){if(!q.isFail()){var f=n(m.nodeType?m:c);if("function"==typeof a)a(m,f);else if(a.width)f[a.preview?"preview":"resize"](a.width,a.height,a.type);else a.maxWidth&&(m.width>a.maxWidth||m.height>a.maxHeight)&&f.resize(a.maxWidth,a.maxHeight,"max"),f.rotate(~~a.rotate);q.inc();f.toData(function(a,c){a?q.fail():(l[e]=c,q.next())})}})})};a.support.canvas=a.support.transform=c;a.Image=n})(FileAPI,document);
(function(a,l,g){var n=l.encodeURIComponent,m=l.FormData,l=function(){this.items=[]};l.prototype={append:function(a,c,e,g){this.items.push({name:a,blob:c&&c.blob||c,file:e||c.name,type:g||c.type})},each:function(a){for(var c=0,e=this.items.length;c<e;c++)a.call(this,this.items[c])},toData:function(f){a.support.html5?this.multipart?(a.log("FileAPI.Form.toMultipartData"),this.toMultipartData(f)):(a.log("FileAPI.Form.toFormData"),this.toFormData(f)):(a.log("tFileAPI.Form.toHtmlData"),this.toHtmlData(f))},
_to:function(f,c,e,g){var m=a.queue(function(){c(f)});this.each(function(a){e(a,f,m,g)});m.check()},toHtmlData:function(f){this._to(g.createDocumentFragment(),f,function(c,e){var f=c.blob,m;c.file?(a.reset(f),f.name=c.name,e.appendChild(f)):(m=g.createElement("input"),m.name=c.name,m.type="hidden",m.value=f,e.appendChild(m))})},toFormData:function(a){this._to(new m,a,function(a,e,f){a.file&&e.append("_"+a.name,a.file);a.blob.toBlob?(f.inc(),a.blob.toBlob(function(g){e.append(a.name,g,a.file);f.next()},
"image/png")):a.file?e.append(a.name,a.blob,a.file):e.append(a.name,a.blob)})},toMultipartData:function(f){this._to([],f,function(a,e,f,g){e.push("--_"+g+('\r\nContent-Disposition: form-data; name="'+a.name+'"'+(a.file?'; filename="'+n(a.file)+'"':"")+(a.file?"\r\nContent-Type: "+(a.type||"application/octet-stream"):"")+"\r\n\r\n"+(a.file?a.blob:n(a.blob))+"\r\n"))},a.expando)}};a.Form=l})(FileAPI,window,document);
(function(a,l){var g=function(){},n=function(a){this.uid=l.uid();this.xhr={abort:g,getResponseHeader:g,getAllResponseHeaders:g};this.options=a};n.prototype={status:0,statusText:"",getResponseHeader:function(a){return this.xhr.getResponseHeader(a)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(m,f){var c=this,e=c.options;c.abort=g;c.status=m;f&&(c.statusText=f);l.log("xhr.end:",m,f);e.complete(200==m?!1:c.statusText||"unknown",c);c.xhr&&c.xhr.node&&setTimeout(function(){var e=
c.xhr.node;try{e.parentNode.removeChild(e)}catch(f){}try{delete a[c.uid]}catch(g){}a[c.uid]=c.xhr.node=null},9)},abort:function(){this.end(0,"abort");this.xhr&&this.xhr.abort()},send:function(a){var f=this,c=this.options;a.toData(function(a){c.upload(c,f);f._send.call(f,c,a)})},_send:function(g,f){var c=this,e,j=c.uid;l.log("XHR._send:",f);if(f.nodeName){g.upload(g,c);e=document.createElement("div");e.innerHTML='<form target="'+j+'" action="'+g.url+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+
j+'" src="javascript:false;"></iframe><input value="'+j+'" name="callback" type="hidden"/></form>';c.xhr.abort=function(){var a=e.getElementsByName("iframe")[0];if(a)try{a.stop?a.stop():a.contentWindow.stop?a.contentWindow.stop():a.contentWindow.document.execCommand("Stop")}catch(c){}e=null};var n=e.getElementsByTagName("form")[0];n.appendChild(f);l.log(n.parentNode.innerHTML);document.body.appendChild(e);c.xhr.node=e;a[j]=function(a,f,g){c.readyState=4;c.responseText=g;c.end(a,f);e=null};c.readyState=
2;n.submit();n=null}else e=c.xhr=l.getXHR(),e.open("POST",g.url,!0),e.withCredential="true",(!g.headers||!g.headers["X-Requested-With"])&&e.setRequestHeader("X-Requested-With","XMLHttpRequest"),l.each(g.headers,function(a,c){e.setRequestHeader(c,a)}),e.upload&&e.upload.addEventListener("progress",l.throttle(function(a){g.progress(a,c,g)},100),!1),e.onreadystatechange=function(){c.status=e.status;c.statusText=e.statusText;c.readyState=e.readyState;if(4==e.readyState){for(var a in{"":1,XML:1,Text:1,
Body:1})c["response"+a]=e["response"+a];e.onreadystatechange=null;c.end(e.status);e=null}},l.isArray(f)?(e.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+l.expando),f=f.join("")+"--_"+l.expando+"--",e.sendAsBinary?e.sendAsBinary(f):(j=Array.prototype.map.call(f,function(a){return a.charCodeAt(0)&255}),e.send((new Uint8Array(j)).buffer))):e.send(f)}};l.XHR=n})(window,FileAPI);
(function(a,l,g){var n=a.support,m=l.navigator,f=m.mimeTypes,c=!1;if(m.plugins&&"object"==typeof m.plugins["Shockwave Flash"])c=m.plugins["Shockwave Flash"].description&&!(f&&f["application/x-shockwave-flash"]&&!f["application/x-shockwave-flash"].enabledPlugin);else try{c=!(!l.ActiveXObject||!new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(e){}n.flash=c;if(a.support.flash&&(!a.support.html5||a.cors&&!a.support.cors)){var j=function(a){return'<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="movie" value="#src#" /><param name="flashvars" value="#flashvars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="menu" value="false" /><param name="wmode" value="#wmode#" /><embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#"  width="100%" height="100%" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>'.replace(/#(\w+)#/ig,
function(c,e){return a[e]})},u=function(a,c){if(a&&a.style){var e,f;for(e in c){f=c[e];"number"==typeof f&&(f+="px");try{a.style[e]=f}catch(g){}}}},w=function(d,c){a.each(c,function(a,c){var h=d[c];d[c]=function(){this.parent=h;return a.apply(this,arguments)}})},z=function(d){var c=d.wid=a.uid();k._fn[c]=d;return"FileAPI.Flash._fn."+c},A=function(a){try{k._fn[a.wid]=null,delete k._fn[a.wid]}catch(c){}},p=function(a){if(!t.test(a)){if(/^\.\//.test(a)||"/"!=a.charAt(0))var c=location.pathname,c=c.substr(0,
c.lastIndexOf("/")),a=c+"/"+a.substr("./"==RegExp.$1?2:0);"//"!=a.substr(0,2)&&(a=location.hostname+"/"+a);t.test(a)||(a=location.protocol+"//"+a)}return a},q=a.uid(),s=0,C={},t=/^https?:/i,k={_fn:{},init:function(){var d=g.body&&g.body.firstChild;if(d){do if(1==d.nodeType){a.log("FlashAPI.Flash.inited");var c=g.createElement("div");u(c,{top:1,right:1,width:5,height:5,position:"absolute"});d.parentNode.insertBefore(c,d);k.pingUrl=k.pingUrl||location.protocol+"//"+location.host;k.publish(c,q);return}while(d=
d.nextSibling)}10>s&&setTimeout(k.init,50*++s)},publish:function(d,c){d.innerHTML=j({id:c,src:p(a.staticPath+"FileAPI.flash.swf?r="+a.build),wmode:"transparent",flashvars:"callback=FileAPI.Flash.event&flashId="+c+"&storeKey="+navigator.userAgent.match(/\d/ig).join("")+"_"+a.build+(k.isReady||!k.pingUrl?"":"&ping="+k.pingUrl)})},ready:function(){k.ready=a.F;k.isReady=!0;k.patch();a.event.on(g,"mouseover",k.mouseover);a.event.on(g,"click",function(a){k.mouseover(a)&&(a.preventDefault?a.preventDefault():
a.returnValue=!0)})},getWrapper:function(a){do if(/js-fileapi-wrapper/.test(a.className))return a;while((a=a.parentNode)&&a!==g.body)},mouseover:function(d){d=a.event.fix(d).target;if(/input/i.test(d.nodeName)&&"file"==d.type){var c=d.getAttribute(q);if("i"==c||"r"==c)return!1;if("p"!=c){d.setAttribute(q,"i");var c=g.createElement("div"),e=k.getWrapper(d);if(!e){a.log("flash.mouseover.error: js-fileapi-wrapper not found");return}u(c,{top:0,left:0,width:d.offsetWidth+100,height:d.offsetHeight+100,
zIndex:"1000000",position:"absolute"});e.appendChild(c);k.publish(c,a.uid());d.setAttribute(q,"p")}return!0}},event:function(d){var c=d.type;if("ready"==c){try{k.getInput(d.flashId).setAttribute(q,"r")}catch(e){}k.ready();setTimeout(function(){k.mouseenter(d)},50);return!0}"ping"===c?a.log("(flash -> js).ping:",[d.status,d.savedStatus],d.error):"log"===c?a.log("(flash -> js).log:",d.target):c in k&&setTimeout(function(){a.log("Flash.event."+d.type+":",d);k[c](d)},1)},mouseenter:function(a){var c=
k.getInput(a.flashId);c&&(k.cmd(a,"multiple",null!==c.getAttribute("multiple")),k.cmd(a,"accept",(c.getAttribute("accept")||"*").replace(/\./g,"")))},get:function(a){return g[a]||l[a]||g.embeds[a]},getInput:function(a){try{var c=k.getWrapper(k.get(a));if(c)return c.getElementsByTagName("input")[0]}catch(e){}},select:function(d){var c=k.getInput(d.flashId),e=a.uid(c),d=d.target.files;a.each(d,function(d){a.checkFileObj(d)});C[e]=d;g.createEvent?(e=g.createEvent("Event"),e.initEvent("change",!0,!1),
c.dispatchEvent(e)):g.createEventObject&&(e=g.createEventObject(),c.fireEvent("onchange",e))},cmd:function(d,c,e,f){try{return a.log("(js -> flash)."+c+":",e),k.get(d.flashId||d).cmd(c,e)}catch(g){a.log("(js -> flash).onError:",g),f||setTimeout(function(){k.cmd(d,c,e,!0)},50)}},patch:function(){a.flashEngine=a.support.transform=!0;w(a,{getFiles:function(d,c,e){if(e)return a.filterFiles(a.getFiles(d),c,e),null;var f=a.isArray(d)?d:C[a.uid(d.target||d.srcElement||d)];if(!f)return this.parent.apply(this,
arguments);c&&(c=a.getFilesFilter(c),f=a.filter(f,function(a){return c.test(a.name)}));return f},getInfo:function(a,c){a&&!a.flashId?this.parent.apply(this,arguments):a.info?c(!1,a.info):k.cmd(a,"getFileInfo",{id:a.id,callback:z(function H(e,f){A(H);c(e,a.info=f)})})}});a.support.transform=!0;w(FileAPI.Image.prototype,{_load:function(c,e){a.log("FileAPI.Image._load:",c);if(c&&!c.flashId)this.parent.apply(this,arguments);else{var f=this;a.getInfo(c,function(a){e.call(f,a,c)})}},_apply:function(c,e){a.log("FileAPI.Image._apply:",
c);if(c&&!c.flashId)this.parent.apply(this,arguments);else{var f=this.getMatrix(c.info);k.cmd(c,"imageTransform",{id:c.id,matrix:f,callback:z(function I(l,m){a.log("FileAPI.Image._apply.callback:",l);A(I);if(l)e(l);else if(!a.support.dataURI||3E4<m.length){var n={width:!(f.deg%180)?f.dw:f.dh,height:f.deg%180?f.dw:f.dh},p=e,s=function(){try{k.get(t).setImage(m)}catch(a){}},q,t=a.uid(),i=g.createElement("div");for(q in n)i.setAttribute("data-img-"+q,n[q]);u(i,n);a.log("flash.image.publish");i.innerHTML=
j({id:t,src:a.staticPath+"FileAPI.flash.image.swf?r="+a.uid(),wmode:"opaque",flashvars:"scale=noScale&callback="+z(function K(){A(K);setTimeout(s,99);return!0})});p(!1,i);i=null}else{var b=new Image;a.event.one(b,"error abort load",function(a){e("load"!=a.type&&a.type,b);b=null});b.src="data:"+c.type+";base64,"+m}})})}},toData:function(a){var c=this.data;c&&!c.flashId?this.parent.apply(this,arguments):a.call(this,!c.info,{id:c.id,flashId:c.flashId,name:c.name,type:c.type,matrix:this.getMatrix(c.info)})}});
w(a.Form.prototype,{toData:function(c){for(var e=this.items,f=e.length;f--;)if(e[f].file&&e[f].blob&&!e[f].blob.flashId)return this.parent.apply(this,arguments);a.log("flash.Form.toData");c(e)}});w(a.XHR.prototype,{_send:function(c,e){if(e.nodeName||e.append&&a.support.html5||a.isArray(e)&&"string"===typeof e[0])return this.parent.apply(this,arguments);var f={},g={},j=this,l,m;a.each(e,function(a){a.file?(g[a.name]=a=a.blob,m=a.id,l=a.flashId):f[a.name]=a.blob});a.log("flash.XHR._send:",l,m,g);j.xhr=
{headers:{},abort:function(){k.cmd(l,"abort",m)},getResponseHeader:function(a){return this.headers[a]},getAllResponseHeaders:function(){return this.headers}};var n=a.queue(function(){k.cmd(l,"upload",{url:p(c.url),data:f,files:g,headers:c.headers,callback:z(function D(e){var f=e.type,g=e.result;a.log("flash.upload."+f+":",e);if("progress"==f)e.loaded=Math.min(e.loaded,e.total),e.lengthComputable=!0,c.progress(e);else if("complete"==f)A(D),"string"==typeof g&&(j.responseText=g.replace(/%22/g,'"').replace(/%5c/g,
"\\").replace(/%26/g,"&").replace(/%25/g,"%")),j.end(e.status||200);else if("abort"==f||"error"==f)j.end(0,e.message),A(D)})})});a.each(g,function(c){n.inc();a.getInfo(c,n.next)});n.check()}})}};a.Flash=k;var v=new Image;a.event.one(v,"error load",function(){a.support.dataURI=!(1!=v.width||1!=v.height);v=null;k.init()});v.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}})(FileAPI,window,document);"undefined"!==typeof ajs&&ajs.loaded&&ajs.loaded("{fileapi}FileAPI.min");
"function"===typeof define&&define.amd&&define("FileAPI",[],function(){return window.FileAPI||{}});