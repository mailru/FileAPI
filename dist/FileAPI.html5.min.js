/*! fileapi 2.1.0 - BSD | git://github.com/mailru/FileAPI.git */
!function(a){"use strict";var b=a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype,c=a.Blob&&function(){try{return Boolean(new Blob)}catch(a){return!1}}(),d=c&&a.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(a){return!1}}(),e=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder,f=(c||e)&&a.atob&&a.ArrayBuffer&&a.Uint8Array&&function(a){var b,f,g,h,i,j;for(b=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):decodeURIComponent(a.split(",")[1]),f=new ArrayBuffer(b.length),g=new Uint8Array(f),h=0;h<b.length;h+=1)g[h]=b.charCodeAt(h);return i=a.split(",")[0].split(":")[1].split(";")[0],c?new Blob([d?g:f],{type:i}):(j=new e,j.append(f),j.getBlob(i))};a.HTMLCanvasElement&&!b.toBlob&&(b.mozGetAsFile?b.toBlob=function(a,c,d){d&&b.toDataURL&&f?a(f(this.toDataURL(c,d))):a(this.mozGetAsFile("blob",c))}:b.toDataURL&&f&&(b.toBlob=function(a,b,c){a(f(this.toDataURL(b,c)))})),a.dataURLtoBlob=f}(window),function(a,b){"use strict";function c(a,b,c,d,e){var f={type:c.type||c,target:a,result:d};X(f,e),b(f)}function d(a){return y&&!!y.prototype["readAs"+a]}function e(a,e,f,g){if(bb.isFile(a)&&d(f)){var h=new y;Y(h,R,function j(b){var d=b.type;"progress"==d?c(a,e,b,b.target.result,{loaded:b.loaded,total:b.total}):"loadend"==d?(Z(h,R,j),h=null):c(a,e,b,b.target.result)});try{g?h["readAs"+f](a,g):h["readAs"+f](a)}catch(i){c(a,e,"error",b,{error:i.toString()})}}else c(a,e,"error",b,{error:"filreader_not_support_"+f})}function f(a){return a&&(x&&a instanceof x||a.image&&a.file||a.flashId)}function g(a){return{name:(a+"").split(/\\|\//g).pop(),type:bb.getMimeType(a)}}function h(a,b){if(!a.type&&a.size%4096===0&&a.size<=102400)if(y)try{var c=new y;$(c,R,function(a){var d="error"!=a.type;b(d),d&&c.abort()}),c.readAsDataURL(a)}catch(d){b(!1)}else b(null);else b(!0)}function i(a){var b;return a.getAsEntry?b=a.getAsEntry():a.webkitGetAsEntry&&(b=a.webkitGetAsEntry()),b}function j(a,b){if(a)if(a.isFile)a.file(function(c){c.fullPath=a.fullPath,b(!1,[c])},function(a){b("FileError.code: "+a.code)});else if(a.isDirectory){var c=a.createReader(),d=[];c.readEntries(function(a){bb.afor(a,function(a,c){j(c,function(c,e){c?bb.log(c):d=d.concat(e),a?a():b(!1,d)})})},function(a){b("directory_reader: "+a)})}else j(i(a),b);else b("invalid entry")}function k(a,b){var c=[],d={};if(n(a)){var e=bb.getFiles(a);d[a.name||b]=null!==a.getAttribute("multiple")?e:e[0]}else V(a)?n(a[0])?W(a,function(a){d[a.name||b]=bb.getFiles(a)}):f(a[0])&&(d[b]=a):f(a)?d[b]=a:d=a;return W(d,function g(a,b){V(a)?W(a,function(a){g(a,b)}):f(a)&&c.push({name:b,file:a,size:a.size,total:a.size,loaded:0})}),c}function l(a,b,c){var d=new bb.Form,e=bb.queue(function(){c(d)}),f=bb.support.transform&&a.imageTransform,g=f&&p(f),h=bb.postNameConcat;W(a.data,function i(a,b){"object"==typeof a?W(a,function(a,c){i(a,h(b,c))}):d.append(b,a)}),W(b,function(b,c){var i=b.file,j=h(b.name,a.serial||a.chunkSize?null:c),k=i.name,l=i.type;!function m(b){b.image?(e.inc(),b.toData(function(a,b){k=k||(new Date).getTime()+".png",m(b),e.next()})):bb.Image&&f&&(/^image/.test(b.type)||I.test(b.nodeName))?(e.inc(),g&&(f=[f]),bb.Image.transform(b,f,a.imageAutoOrientation,function(c,i){if(g&&!c)F||bb.flashEngine||(d.multipart=!0),d.append(j,i[0],k,f[0].type||l);else{var m=0;c||W(i,function(a,b){F||bb.flashEngine||(d.multipart=!0),f[b].postName||(m=1),d.append(f[b].postName||h(j,b),a,k,f[b].type||l)}),(c||a.imageOriginal)&&d.append(h(j,m?"original":null),b,k,l)}e.next()})):k!==bb.expando&&d.append(j,b,k)}(i)}),e.check()}function m(a){var b={};return W(a,function(a,c){a&&"object"==typeof a&&null==a.nodeType&&(a=X({},a)),b[c]=a}),b}function n(a){return J.test(a&&a.tagName)}function o(a){return(a.originalEvent||a||"").dataTransfer||{}}function p(a){var b;for(b in a)if(a.hasOwnProperty(b)&&!(a[b]instanceof Object||"overlay"===b||"filter"===b))return!0;return!1}var q=1,r=function(){},s=a.document,t=s.doctype||{},u=a.navigator.userAgent,v=a.createObjectURL&&a||a.URL&&URL.revokeObjectURL&&URL||a.webkitURL&&webkitURL,w=a.Blob,x=a.File,y=a.FileReader,z=a.FormData,A=a.jQuery,B=a.XMLHttpRequest,C=!(!(x&&y&&(a.Uint8Array||z||B.prototype.sendAsBinary))||/safari\//i.test(u)&&!/chrome\//i.test(u)&&/windows/i.test(u)),D=C&&"withCredentials"in new B,E=C&&!!w&&!!(w.prototype.webkitSlice||w.prototype.mozSlice||w.prototype.slice),F=a.dataURLtoBlob,G=/img/i,H=/canvas/i,I=/img|canvas/i,J=/input/i,K=/^data:[^,]+,/,L=a.Math,M=a.setTimeout,N=a.clearTimeout,O=function(b){return b=new a.Number(L.pow(1024,b)),b.from=function(a){return L.round(a*this)},b},P={},Q=[],R="abort progress error load loadend",S="status statusText readyState response responseXML responseText responseBody".split(" "),T="currentTarget",U="preventDefault",V=function(a){return a&&"length"in a},W=function(a,b,c){if(a)if(V(a))for(var d=0,e=a.length;e>d;d++)d in a&&b.call(c,a[d],d,a);else for(var f in a)a.hasOwnProperty(f)&&b.call(c,a[f],f,a)},X=function(a){for(var b=arguments,c=1,d=function(b,c){a[c]=b};c<b.length;c++)W(b[c],d);return a},Y=function(a,b,c){if(a){var d=bb.uid(a);P[d]||(P[d]={}),W(b.split(/\s+/),function(b){A?A.event.add(a,b,c):(P[d][b]||(P[d][b]=[]),P[d][b].push(c),a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c)})}},Z=function(a,b,c){if(a){var d=bb.uid(a),e=P[d]||{};W(b.split(/\s+/),function(b){if(A)A.event.remove(a,b,c);else{for(var d=e[b]||[],f=d.length;f--;)if(d[f]===c){d.splice(f,1);break}a.addEventListener?a.removeEventListener(b,c,!1):a.detachEvent?a.detachEvent("on"+b,c):a["on"+b]=null}})}},$=function(a,b,c){Y(a,b,function d(e){Z(a,b,d),c(e)})},_=function(b){return b.target||(b.target=a.event&&a.event.srcElement||s),3===b.target.nodeType&&(b.target=b.target.parentNode),b},ab=function(a){var b=s.createElement("input");return b.setAttribute("type","file"),a in b},bb={version:"2.1.0",cors:!1,html5:!0,media:!1,formData:!0,debug:!1,pingUrl:!1,multiFlash:!1,flashAbortTimeout:0,withCredentials:!0,staticPath:"./dist/",flashUrl:0,flashImageUrl:0,postNameConcat:function(a,b){return a+(null!=b?"["+b+"]":"")},ext2mime:{jpg:"image/jpeg",tif:"image/tiff",txt:"text/plain"},accept:{"image/*":"art bm bmp dwg dxf cbr cbz fif fpx gif ico iefs jfif jpe jpeg jpg jps jut mcf nap nif pbm pcx pgm pict pm png pnm qif qtif ras rast rf rp svf tga tif tiff xbm xbm xpm xwd","audio/*":"m4a flac aac rm mpa wav wma ogg mp3 mp2 m3u mod amf dmf dsm far gdm imf it m15 med okt s3m stm sfx ult uni xm sid ac3 dts cue aif aiff wpl ape mac mpc mpp shn wv nsf spc gym adplug adx dsp adp ymf ast afc hps xs","video/*":"m4v 3gp nsv ts ty strm rm rmvb m3u ifo mov qt divx xvid bivx vob nrg img iso pva wmv asf asx ogm m2v avi bin dat dvr-ms mpg mpeg mp4 mkv avc vp3 svq3 nuv viv dv fli flv wpl"},chunkSize:0,chunkUploadRetry:0,chunkNetworkDownRetryTimeout:2e3,KB:O(1),MB:O(2),GB:O(3),TB:O(4),expando:"fileapi"+(new Date).getTime(),uid:function(a){return a?a[bb.expando]=a[bb.expando]||bb.uid():(++q,bb.expando+q)},log:function(){bb.debug&&a.console&&console.log&&(console.log.apply?console.log.apply(console,arguments):console.log([].join.call(arguments," ")))},newImage:function(a,b){var c=s.createElement("img");return b&&bb.event.one(c,"error load",function(a){b("error"==a.type,c),c=null}),c.src=a,c},getXHR:function(){var b;if(B)b=new B;else if(a.ActiveXObject)try{b=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(c){b=new ActiveXObject("Microsoft.XMLHTTP")}return b},isArray:V,support:{dnd:D&&"ondrop"in s.createElement("div"),cors:D,html5:C,chunked:E,dataURI:!0,accept:ab("accept"),multiple:ab("multiple")},event:{on:Y,off:Z,one:$,fix:_},throttle:function(b,c){var d,e;return function(){e=arguments,d||(b.apply(a,e),d=M(function(){d=0,b.apply(a,e)},c))}},F:function(){},parseJSON:function(b){var c;return c=a.JSON&&JSON.parse?JSON.parse(b):new Function("return ("+b.replace(/([\r\n])/g,"\\$1")+");")()},trim:function(a){return a=String(a),a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},defer:function(){var a=[],b=[],c=[],d=function(c,d){return(c?a:b).push(d),this},e=function(f,g){var h=f?a:b,i=0,j=h.length;for(d=function(a,b){a===f&&b.apply(this,g)},e=r,a=b=c=null;j>i;i++)h[i]&&h[i].apply(this,g)},f={done:function(a){return d(1,a),this},fail:function(a){return d(0,a),this},resolve:function(){return e(1,arguments),this},reject:function(){return e(0,arguments),this},notify:function(){for(var a=0,b=c.length;b>a;a++)c[a].apply(this,arguments)},progress:function(a){return c.push(a),this},then:function(a,b){return this.done(a).fail(b)},always:function(a){return this.then(a,a)},promise:function(){return this}};return f},queue:function(a){var b=0,c=0,d=!1,e=!1,f={inc:function(){c++},next:function(){b++,M(f.check,0)},check:function(){b>=c&&!d&&f.end()},isFail:function(){return d},fail:function(){!d&&a(d=!0)},end:function(){e||(e=!0,a())}};return f},each:W,afor:function(a,b){var c=0,d=a.length;V(a)&&d--?!function e(){b(d!=c&&e,a[c],c++)}():b(!1)},extend:X,isFile:function(a){return C&&a&&a instanceof x},isCanvas:function(a){return a&&H.test(a.nodeName)},getFilesFilter:function(a){return a="string"==typeof a?a:a.getAttribute&&a.getAttribute("accept")||"",a?new RegExp("("+a.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(a,b){bb.isCanvas(a)?c(a,b,"load",bb.toDataURL(a)):e(a,b,"DataURL")},readAsBinaryString:function(a,b){d("BinaryString")?e(a,b,"BinaryString"):bb.readAsDataURL(a,function(a){if("load"==a.type)try{a.result=bb.toBinaryString(a.result)}catch(c){a.type="error",a.message=c.toString()}b(a)})},readAsArrayBuffer:function(a,b){e(a,b,"ArrayBuffer")},readAsText:function(a,b,c){c||(c=b,b="utf-8"),e(a,c,"Text",b)},toDataURL:function(a,b){return"string"==typeof a?a:a.toDataURL?a.toDataURL(b||"image/png"):void 0},toBinaryString:function(b){return a.atob(bb.toDataURL(b).replace(K,""))},readAsImage:function(a,d,e){if(bb.isFile(a))if(v){var f=v.createObjectURL(a);f===b?c(a,d,"error"):bb.readAsImage(f,d,e)}else bb.readAsDataURL(a,function(b){"load"==b.type?bb.readAsImage(b.result,d,e):(e||"error"==b.type)&&c(a,d,b,null,{loaded:b.loaded,total:b.total})});else if(bb.isCanvas(a))c(a,d,"load",a);else if(G.test(a.nodeName))if(a.complete)c(a,d,"load",a);else{var g="error abort load";$(a,g,function i(b){"load"==b.type&&v&&v.revokeObjectURL(a.src),Z(a,g,i),c(a,d,b,a)})}else if(a.iframe)c(a,d,{type:"error"});else{var h=bb.newImage(a.dataURL||a);bb.readAsImage(h,d,e)}},getMimeType:function(a){var b,c,d=a&&(a.type||String(a.name||a).split(".").pop()),e=bb.accept;if(!/^[^/]+\/[^/]+$/.test(d))for(c in e)if(b=new RegExp(e[c].replace(/\s/g,"|"),"i"),b.test(d)||bb.ext2mime[d]){d=bb.ext2mime[d]||c.split("/")[0]+"/"+d;break}return d},getDropFiles:function(a,b){var c=[],d=o(a),e=V(d.items)&&d.items[0]&&i(d.items[0]),f=bb.queue(function(){b(c)});W((e?d.items:d.files)||[],function(a){f.inc();try{e?j(a,function(a,b){a?bb.log("[err] getDropFiles:",a):c.push.apply(c,b),f.next()}):h(a,function(b){b&&c.push(a),f.next()})}catch(b){f.next(),bb.log("[err] getDropFiles: ",b)}}),f.check()},getFiles:function(a,b,c){var d=[];return c?(bb.filterFiles(bb.getFiles(a),b,c),null):(a.jquery&&(a.each(function(){d=d.concat(bb.getFiles(this))}),a=d,d=[]),"string"==typeof b&&(b=bb.getFilesFilter(b)),a.originalEvent?a=_(a.originalEvent):a.srcElement&&(a=_(a)),a.dataTransfer?a=a.dataTransfer:a.target&&(a=a.target),a.files?(d=a.files,C||(d[0].blob=a,d[0].iframe=!0)):!C&&n(a)?bb.trim(a.value)&&(d=[g(a.value)],d[0].blob=a,d[0].iframe=!0):V(a)&&(d=a),bb.filter(d,function(a){return!b||b.test(a.name)}))},getTotalSize:function(a){for(var b=0,c=a&&a.length;c--;)b+=a[c].size;return b},getInfo:function(a,b){var c={},d=Q.concat();bb.isFile(a)?!function e(){var f=d.shift();f?f.test(bb.getMimeType(a))?f(a,function(a,d){a?b(a):(X(c,d),e())}):e():b(!1,c)}():b("not_support_info",c)},addInfoReader:function(a,b){b.test=function(b){return a.test(b)},Q.push(b)},filter:function(a,b){for(var c,d=[],e=0,f=a.length;f>e;e++)e in a&&(c=a[e],b.call(c,c,e,a)&&d.push(c));return d},filterFiles:function(a,b,c){if(a.length){var d,e=a.concat(),f=[],g=[];!function h(){e.length?(d=e.shift(),bb.getInfo(d,function(a,c){(b(d,a?!1:c)?f:g).push(d),h()})):c(f,g)}()}else c([],a)},upload:function(a,b,c){c=b||"string"==typeof a?X({},c,{url:a,files:[].concat(b)}):a,c=X({prepare:bb.F,beforeupload:bb.F,upload:bb.F,fileupload:bb.F,fileprogress:bb.F,filecomplete:bb.F,progress:bb.F,complete:bb.F,pause:bb.F,serial:!0,postName:"files",chunkSize:bb.chunkSize,chunkUpoloadRetry:bb.chunkUploadRetry,imageOriginal:!0},c),c.serial||(c.chunkSize&&(c.chunkSize=0,bb.log("[warn] FileAPI.upload: `chunkSize > 0` is not supported, if serial == false")),bb.flashEngine&&bb.log("[warn] FileAPI.upload: `serial == false` is not supported in Flash.")),c.imageAutoOrientation&&!c.imageTransform&&(c.imageTransform={rotate:"auto"});var d,e=new bb.XHR(c),f=k(c.files,c.postName),g=bb.defer(),h=this,i=0,j=0,n=!1,o=c.serial,p=!f.length;return W(f,function(a){i+=a.size}),e.files=[],W(f,function(a){e.files.push(a.file)}),e.total=i,e.loaded=0,e.filesLeft=f.length,c.beforeupload(e,c),g.progress(c.progress),g.done(c.success),g.fail(c.error),d=function(){var a=f.splice(0,o?1:1e5),b=o?a[0]&&a[0].file:e.files,h=!1,k=m(c);if(p&&(b=null,bb.log("[warn] FileAPI.upload() — called without files")),"abort"==e.statusText&&!e.current||!a.length&&!p){var q=200==e.status||201==e.status?!1:e.statusText||"error";q?g.reject(q,e,c):g.resolve(e,c),c.complete(q,e,c),n=!0}else p=!1,n=!1,e.currentFile=b,b&&c.prepare(b,k),l(k,a,function(l){j||(o||(a.size=i),c.upload(e,c));var m=new bb.XHR(X({},k,{upload:b?function(){o&&c.fileupload(b,m,k)}:r,progress:b?function(d){h||(h=d.total==d.loaded,o&&c.fileprogress({type:"progress",total:a.total=d.total,loaded:a.loaded=d.loaded},b,m,k),g.notify({type:"progress",total:i,loaded:e.loaded=j+a.size*(d.loaded/d.total)|0},b,m,k))}:r,complete:function(f){W(S,function(a){e[a]=m[a]}),b&&(a.loaded=a.total,this.progress(a),h=!0,j+=a.size,e.loaded=j,o&&c.filecomplete(f,m,b,k)),d()}}));e.abort=function(a){a||(f.length=0),this.current=a,m.abort()},m.send(l)})},M(d,0),e.append=function(a,b){a=bb._getFilesDataArray([].concat(a)),W(a,function(a){i+=a.size,e.files.push(a.file),b?f.unshift(a):f.push(a)}),e.statusText="",n&&d.call(h)},e.remove=function(a){for(var b,c=f.length;c--;)f[c].file==a&&(b=f.splice(c,1),i-=b.size);return b},e.error=g.fail,e.success=g.done,X(e,g)},reset:function(a,b){var c,d;return A?(d=A(a).clone(!0).insertBefore(a).val("")[0],b||A(a).remove()):(c=a.parentNode,d=c.insertBefore(a.cloneNode(!0),a),d.value="",b||c.removeChild(a),W(P[bb.uid(a)],function(b,c){W(b,function(b){Z(a,c,b),Y(d,c,b)})})),d},load:function(a,b){var c=bb.getXHR();return c?(c.open("GET",a,!0),c.overrideMimeType&&c.overrideMimeType("text/plain; charset=x-user-defined"),Y(c,"progress",function(a){a.lengthComputable&&b({type:a.type,loaded:a.loaded,total:a.total},c)}),c.onreadystatechange=function(){if(4==c.readyState)if(c.onreadystatechange=null,200==c.status){a=a.split("/");var d={name:a[a.length-1],size:c.getResponseHeader("Content-Length"),type:c.getResponseHeader("Content-Type")};d.dataURL="data:"+d.type+";base64,"+bb.encode64(c.responseBody||c.responseText),b({type:"load",result:d},c)}else b({type:"error"},c)},c.send(null)):b({type:"error"}),c},encode64:function(a){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",d=0;for("string"!=typeof a&&(a=String(a));d<a.length;){var e,f,g=255&a.charCodeAt(d++),h=255&a.charCodeAt(d++),i=255&a.charCodeAt(d++),j=g>>2,k=(3&g)<<4|h>>4;isNaN(h)?e=f=64:(e=(15&h)<<2|i>>6,f=isNaN(i)?64:63&i),c+=b.charAt(j)+b.charAt(k)+b.charAt(e)+b.charAt(f)}return c}};bb.addInfoReader(/^image/,function(a,b){if(!a.__dimensions){var c=a.__dimensions=bb.defer();bb.readAsImage(a,function(a){var b=a.target;c.resolve("load"==a.type?!1:"error",{width:b.width,height:b.height}),b=null})}a.__dimensions.then(b)}),bb.event.dnd=function(a,b,c){var d,e;c||(c=b,b=bb.F),y?(Y(a,"dragenter dragleave dragover",function(a){for(var c=o(a).types,f=c&&c.length,g=!1;f--;)if(~c[f].indexOf("File")){a[U](),e!==a.type&&(e=a.type,"dragleave"!=e&&b.call(a[T],!0,a),g=!0);break}g&&(N(d),d=M(function(){b.call(a[T],"dragleave"!=e,a)},50))}),Y(a,"drop",function(a){a[U](),e=0,b.call(a[T],!1,a),bb.getDropFiles(a,function(b){c.call(a[T],b,a)})})):bb.log("Drag'n'Drop -- not supported")},bb.event.dnd.off=function(a,b,c){Z(a,"dragenter dragleave dragover",b),Z(a,"drop",c)},A&&!A.fn.dnd&&(A.fn.dnd=function(a,b){return this.each(function(){bb.event.dnd(this,a,b)})},A.fn.offdnd=function(a,b){return this.each(function(){bb.event.dnd.off(this,a,b)})}),a.FileAPI=X(bb,a.FileAPI),bb.log("FileAPI: "+bb.version),bb.log("protocol: "+a.location.protocol),bb.log("doctype: ["+t.name+"] "+t.publicId+" "+t.systemId),W(s.getElementsByTagName("meta"),function(a){/x-ua-compatible/i.test(a.getAttribute("http-equiv"))&&bb.log("meta.http-equiv: "+a.getAttribute("content"))}),bb.flashUrl||(bb.flashUrl=bb.staticPath+"FileAPI.flash.swf"),bb.flashImageUrl||(bb.flashImageUrl=bb.staticPath+"FileAPI.flash.image.swf"),bb.flashWebcamUrl||(bb.flashWebcamUrl=bb.staticPath+"FileAPI.flash.camera.swf")}(window,void 0),function(a,b,c){"use strict";function d(b){if(b instanceof d){var c=new d(b.file);return a.extend(c.matrix,b.matrix),c}return this instanceof d?(this.file=b,this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0,quality:1,filter:0},void 0):new d(b)}var e=Math.min,f=Math.round,g=function(){return b.createElement("canvas")},h=!1,i={8:270,3:180,6:90};try{h=g().toDataURL("image/png").indexOf("data:image/png")>-1}catch(j){}d.prototype={image:!0,constructor:d,set:function(b){return a.extend(this.matrix,b),this},crop:function(a,b,d,e){return d===c&&(d=a,e=b,a=b=0),this.set({sx:a,sy:b,sw:d,sh:e||d})},resize:function(a,b,c){return"string"==typeof b&&(c=b,b=a),this.set({dw:a,dh:b,resize:c})},preview:function(a,b){return this.resize(a,b||a,"preview")},rotate:function(a){return this.set({deg:a})},filter:function(a){return this.set({filter:a})},overlay:function(a){return this.set({overlay:a})},clone:function(){return new d(this)},_load:function(b,c){var d=this;/img|video/i.test(b.nodeName)?c.call(d,null,b):a.readAsImage(b,function(a){c.call(d,"load"!=a.type,a.result)})},_apply:function(b,c){var f,h=g(),i=this.getMatrix(b),j=h.getContext("2d"),k=b.videoWidth||b.width,l=b.videoHeight||b.height,m=i.deg,n=i.dw,o=i.dh,p=k,q=l,r=i.filter,s=b,t=i.overlay,u=a.queue(function(){c(!1,h)}),v=a.renderImageToCanvas;for(b._type=this.file.type;e(p/n,q/o)>2;)p=p/2+.5|0,q=q/2+.5|0,f=g(),f.width=p,f.height=q,s!==b?(v(f,s,0,0,s.width,s.height,0,0,p,q),s=f):(s=f,v(s,b,i.sx,i.sy,i.sw,i.sh,0,0,p,q),i.sx=i.sy=i.sw=i.sh=0);h.width=m%180?o:n,h.height=m%180?n:o,h.type=i.type,h.quality=i.quality,j.rotate(m*Math.PI/180),v(h,s,i.sx,i.sy,i.sw||s.width,i.sh||s.height,180==m||270==m?-n:0,90==m||180==m?-o:0,n,o),n=h.width,o=h.height,t&&a.each([].concat(t),function(b){u.inc();var c=new window.Image,d=function(){var e=0|b.x,f=0|b.y,g=b.w||c.width,h=b.h||c.height,i=b.rel;e=1==i||4==i||7==i?(n-g+e)/2:2==i||5==i||8==i?n-(g+e):e,f=3==i||4==i||5==i?(o-h+f)/2:i>=6?o-(h+f):f,a.event.off(c,"error load abort",d);try{j.globalAlpha=b.opacity||1,j.drawImage(c,e,f,g,h)}catch(k){}u.next()};a.event.on(c,"error load abort",d),c.src=b.src,c.complete&&d()}),r&&(u.inc(),d.applyFilter(h,r,u.next)),u.check()},getMatrix:function(b){var c=a.extend({},this.matrix),d=c.sw=c.sw||b.videoWidth||b.naturalWidth||b.width,g=c.sh=c.sh||b.videoHeight||b.naturalHeight||b.height,h=c.dw=c.dw||d,i=c.dh=c.dh||g,j=d/g,k=h/i,l=c.resize;if("preview"==l){if(h!=d||i!=g){var m,n;k>=j?(m=d,n=m/k):(n=g,m=n*k),(m!=d||n!=g)&&(c.sx=~~((d-m)/2),c.sy=~~((g-n)/2),d=m,g=n)}}else l&&(d>h||g>i?"min"==l?(h=f(k>j?e(d,h):i*j),i=f(k>j?h/j:e(g,i))):(h=f(j>=k?e(d,h):i*j),i=f(j>=k?h/j:e(g,i))):(h=d,i=g));return c.sw=d,c.sh=g,c.dw=h,c.dh=i,c},_trans:function(a){this._load(this.file,function(b,c){b?a(b):this._apply(c,a)})},get:function(b){if(a.support.transform){var c=this,d=c.matrix;"auto"==d.deg?a.getInfo(c.file,function(a,e){d.deg=i[e&&e.exif&&e.exif.Orientation]||0,c._trans(b)}):c._trans(b)}else b("not_support_transform")},toData:function(a){this.get(a)}},d.exifOrientation=i,d.transform=function(b,e,f,g){function h(h,i){var j={},k=a.queue(function(a){g(a,j)});h?k.fail():a.each(e,function(a,e){if(!k.isFail()){var g=new d(i.nodeType?i:b);if("function"==typeof a?a(i,g):a.width?g[a.preview?"preview":"resize"](a.width,a.height,a.type):a.maxWidth&&(i.width>a.maxWidth||i.height>a.maxHeight)&&g.resize(a.maxWidth,a.maxHeight,"max"),a.crop){var h=a.crop;g.crop(0|h.x,0|h.y,h.w||h.width,h.h||h.height)}a.rotate===c&&f&&(a.rotate="auto"),g.set({deg:a.rotate,type:a.type||b.type||"image/png",quality:a.quality||1,overlay:a.overlay,filter:a.filter}),k.inc(),g.toData(function(a,b){a?k.fail():(j[e]=b,k.next())})}})}b.width?h(!1,b):a.getInfo(b,h)},a.each(["TOP","CENTER","BOTTOM"],function(b,c){a.each(["LEFT","CENTER","RIGHT"],function(a,e){d[b+"_"+a]=3*c+e,d[a+"_"+b]=3*c+e})}),d.toCanvas=function(a){var c=b.createElement("canvas");return c.width=a.videoWidth||a.width,c.height=a.videoHeight||a.height,c.getContext("2d").drawImage(a,0,0),c},d.fromDataURL=function(b,c,d){var e=a.newImage(b);a.extend(e,c),d(e)},d.applyFilter=function(b,c,e){"function"==typeof c?c(b,e):window.Caman&&window.Caman("IMG"==b.tagName?d.toCanvas(b):b,function(){"string"==typeof c?this[c]():a.each(c,function(a,b){this[b](a)},this),this.render(e)})},a.renderImageToCanvas=function(a,b,c,d,e,f,g,h,i,j){return a.getContext("2d").drawImage(b,c,d,e,f,g,h,i,j),a},a.support.canvas=a.support.transform=h,a.Image=d}(FileAPI,document),function(a){"use strict";a(FileAPI)}(function(a){"use strict";if(window.navigator&&window.navigator.platform&&/iP(hone|od|ad)/.test(window.navigator.platform)){var b=a.renderImageToCanvas;a.detectSubsampling=function(a){var b,c;return a.width*a.height>1048576?(b=document.createElement("canvas"),b.width=b.height=1,c=b.getContext("2d"),c.drawImage(a,-a.width+1,0),0===c.getImageData(0,0,1,1).data[3]):!1},a.detectVerticalSquash=function(a,b){var c,d,e,f,g,h=a.naturalHeight||a.height,i=document.createElement("canvas"),j=i.getContext("2d");for(b&&(h/=2),i.width=1,i.height=h,j.drawImage(a,0,0),c=j.getImageData(0,0,1,h).data,d=0,e=h,f=h;f>d;)g=c[4*(f-1)+3],0===g?e=f:d=f,f=e+d>>1;return f/h||1},a.renderImageToCanvas=function(c,d,e,f,g,h,i,j,k,l){if("image/jpeg"===d._type){var m,n,o,p,q=c.getContext("2d"),r=document.createElement("canvas"),s=1024,t=r.getContext("2d");if(r.width=s,r.height=s,q.save(),m=a.detectSubsampling(d),m&&(e/=2,f/=2,g/=2,h/=2),n=a.detectVerticalSquash(d,m),m||1!==n){for(f*=n,k=Math.ceil(s*k/g),l=Math.ceil(s*l/h/n),j=0,p=0;h>p;){for(i=0,o=0;g>o;)t.clearRect(0,0,s,s),t.drawImage(d,e,f,g,h,-o,-p,g,h),q.drawImage(r,0,0,s,s,i,j,k,l),o+=s,i+=k;p+=s,j+=l}return q.restore(),c}}return b(c,d,e,f,g,h,i,j,k,l)}}}),function(a,b){"use strict";function c(){this.items=[]}function d(b,c,d){var e=b.blob,f=b.file;if(f){if(!e.toDataURL)return a.readAsBinaryString(e,function(a){"load"==a.type&&c(b,a.result)}),void 0;var g={"image/jpeg":".jpe?g","image/png":".png"},h=g[b.type]?b.type:"image/png",i=g[h]||".png",j=e.quality||1;f.match(new RegExp(i+"$","i"))||(f+=i.replace("?","")),b.file=f,b.type=h,!d&&e.toBlob?e.toBlob(function(a){c(b,a)},h,j):c(b,a.toBinaryString(e.toDataURL(h,j)))}else c(b,e)}var e=b.FormData,f=b.document,g=b.unescape,h=b.encodeURIComponent;c.prototype={append:function(a,b,c,d){this.items.push({name:a,blob:b&&b.blob||(void 0==b?"":b),file:b&&(c||b.name),type:b&&(d||b.type)})},each:function(a){for(var b=0,c=this.items.length;c>b;b++)a.call(this,this.items[b])},toData:function(b,c){c._chunked=a.support.chunked&&c.chunkSize>0&&1==a.filter(this.items,function(a){return a.file}).length,a.support.html5?a.formData&&!this.multipart&&e?c._chunked?(a.log("FileAPI.Form.toPlainData"),this.toPlainData(b)):(a.log("FileAPI.Form.toFormData"),this.toFormData(b)):(a.log("FileAPI.Form.toMultipartData"),this.toMultipartData(b)):(a.log("FileAPI.Form.toHtmlData"),this.toHtmlData(b))},_to:function(b,c,d,e){var f=a.queue(function(){c(b)});this.each(function(a){d(a,b,f,e)}),f.check()},toHtmlData:function(b){this._to(f.createDocumentFragment(),b,function(b,c){var d,e=b.blob;b.file?(a.reset(e,!0),e.name=b.name,c.appendChild(e)):(d=f.createElement("input"),d.name=b.name,d.type="hidden",d.value=e,c.appendChild(d))})},toPlainData:function(a){this._to({},a,function(a,b,c){a.file&&(b.type=a.file),a.blob.toBlob?(c.inc(),d(a,function(a,d){b.name=a.name,b.file=d,b.size=d.length,b.type=a.type,c.next()})):a.file?(b.name=a.blob.name,b.file=a.blob,b.size=a.blob.size,b.type=a.type):(b.params||(b.params=[]),b.params.push(h(a.name)+"="+h(a.blob))),b.start=-1,b.end=b.file&&b.file.FileAPIReadPosition||-1,b.retry=0})},toFormData:function(a){this._to(new e,a,function(a,b,c){a.blob&&a.blob.toBlob?(c.inc(),d(a,function(a,d){b.append(a.name,d,a.file),c.next()})):a.file?b.append(a.name,a.blob,a.file):b.append(a.name,a.blob),a.file&&b.append("_"+a.name,a.file)})},toMultipartData:function(b){this._to([],b,function(a,b,c,e){c.inc(),d(a,function(a,d){b.push("--_"+e+'\r\nContent-Disposition: form-data; name="'+a.name+'"'+(a.file?'; filename="'+g(h(a.file))+'"':"")+(a.file?"\r\nContent-Type: "+(a.type||"application/octet-stream"):"")+"\r\n\r\n"+d+"\r\n"),c.next()},!0)},a.expando)}},a.Form=c}(FileAPI,window),function(a,b){"use strict";var c=function(){},d=a.document,e=function(a){this.uid=b.uid(),this.xhr={abort:c,getResponseHeader:c,getAllResponseHeaders:c},this.options=a},f={"":1,XML:1,Text:1,Body:1};e.prototype={status:0,statusText:"",constructor:e,getResponseHeader:function(a){return this.xhr.getResponseHeader(a)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(d,e){var f=this,g=f.options;f.end=f.abort=c,f.status=d,e&&(f.statusText=e),b.log("xhr.end:",d,e),g.complete(200==d||201==d?!1:f.statusText||"unknown",f),f.xhr&&f.xhr.node&&setTimeout(function(){var b=f.xhr.node;try{b.parentNode.removeChild(b)}catch(c){}try{delete a[f.uid]}catch(c){}a[f.uid]=f.xhr.node=null},9)},abort:function(){this.end(0,"abort"),this.xhr&&(this.xhr.aborted=!0,this.xhr.abort())},send:function(a){var b=this,c=this.options;a.toData(function(a){c.upload(c,b),b._send.call(b,c,a)},c)},_send:function(c,e){var g,h=this,i=h.uid,j=c.url;if(b.log("XHR._send:",e),c.cache||(j+=(~j.indexOf("?")?"&":"?")+b.uid()),e.nodeName){c.upload(c,h),g=d.createElement("div"),g.innerHTML='<form target="'+i+'" action="'+j+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+i+'" src="javascript:false;"></iframe><input value="'+i+'" name="callback" type="hidden"/></form>',h.xhr.abort=function(){var a=g.getElementsByTagName("iframe")[0];if(a)try{a.stop?a.stop():a.contentWindow.stop?a.contentWindow.stop():a.contentWindow.document.execCommand("Stop")}catch(b){}g=null};var k=g.getElementsByTagName("form")[0];k.appendChild(e),b.log(k.parentNode.innerHTML),d.body.appendChild(g),h.xhr.node=g,a[i]=function(a,b,c){h.readyState=4,h.responseText=c,h.end(a,b),g=null},h.readyState=2,k.submit(),k=null}else{if(this.xhr&&this.xhr.aborted)return b.log("Error: already aborted"),void 0;if(g=h.xhr=b.getXHR(),e.params&&(j+=(j.indexOf("?")<0?"?":"&")+e.params.join("&")),g.open("POST",j,!0),b.withCredentials&&(g.withCredentials="true"),c.headers&&c.headers["X-Requested-With"]||g.setRequestHeader("X-Requested-With","XMLHttpRequest"),b.each(c.headers,function(a,b){g.setRequestHeader(b,a)}),c._chunked){g.upload&&g.upload.addEventListener("progress",function(a){e.retry||c.progress({type:a.type,total:e.size,loaded:e.start+a.loaded,totalSize:e.size},h,c)},!1),g.onreadystatechange=function(){var a=parseInt(g.getResponseHeader("X-Last-Known-Byte"),10);if(h.status=g.status,h.statusText=g.statusText,h.readyState=g.readyState,4==g.readyState){for(var d in f)h["response"+d]=g["response"+d];if(g.onreadystatechange=null,!g.status||g.status-201>0)if(b.log("Error: "+g.status),(!g.status&&!g.aborted||500==g.status||416==g.status)&&++e.retry<=c.chunkUploadRetry){var i=g.status?0:b.chunkNetworkDownRetryTimeout;c.pause(e.file,c),b.log("X-Last-Known-Byte: "+a),e.end=a?a:e.start-1,setTimeout(function(){h._send(c,e)},i)}else h.end(g.status);else e.retry=0,e.end==e.size-1?h.end(g.status):(b.log("X-Last-Known-Byte: "+a),a&&(e.end=a),e.file.FileAPIReadPosition=e.end,setTimeout(function(){h._send(c,e)},0));g=null}},e.start=e.end+1,e.end=Math.max(Math.min(e.start+c.chunkSize,e.size)-1,e.start);var l;(l="slice")in e.file||(l="mozSlice")in e.file||(l="webkitSlice")in e.file,g.setRequestHeader("Content-Range","bytes "+e.start+"-"+e.end+"/"+e.size),g.setRequestHeader("Content-Disposition","attachment; filename="+encodeURIComponent(e.name)),g.setRequestHeader("Content-Type",e.type||"application/octet-stream"),l=e.file[l](e.start,e.end+1),g.send(l),l=null}else if(g.upload&&g.upload.addEventListener("progress",b.throttle(function(a){c.progress(a,h,c)},100),!1),g.onreadystatechange=function(){if(h.status=g.status,h.statusText=g.statusText,h.readyState=g.readyState,4==g.readyState){for(var a in f)h["response"+a]=g["response"+a];g.onreadystatechange=null,h.end(g.status),g=null}},b.isArray(e))if(g.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+b.expando),e=e.join("")+"--_"+b.expando+"--",g.sendAsBinary)g.sendAsBinary(e);else{var m=Array.prototype.map.call(e,function(a){return 255&a.charCodeAt(0)});g.send(new Uint8Array(m).buffer)}else g.send(e)}}},b.XHR=e}(window,FileAPI),function(a,b){"use strict";function c(a){return a>=0?a+"px":a}function d(a){var b,c=f.createElement("canvas"),d=!1;try{b=c.getContext("2d"),b.drawImage(a,0,0,1,1),d=255!=b.getImageData(0,0,1,1).data[4]}catch(e){}return d}var e=a.URL||a.webkitURL,f=a.document,g=a.navigator,h=g.getUserMedia||g.webkitGetUserMedia||g.mozGetUserMedia||g.msGetUserMedia,i=!!h;b.support.media=i;var j=function(a){this.video=a};j.prototype={isActive:function(){return!!this._active},start:function(a){var b,c,f=this,i=f.video,j=function(d){f._active=!d,clearTimeout(c),clearTimeout(b),a&&a(d,f)};h.call(g,{video:!0},function(a){f.stream=a,i.src=e.createObjectURL(a),b=setInterval(function(){d(i)&&j(null)},1e3),c=setTimeout(function(){j("timeout")},5e3),i.play()},j)},stop:function(){try{this._active=!1,this.video.pause(),this.stream.stop()}catch(a){}},shot:function(){return new k(this.video)}},j.get=function(a){return new j(a.firstChild)},j.publish=function(d,e,g){"function"==typeof e&&(g=e,e={}),e=b.extend({},{width:"100%",height:"100%",start:!0},e),d.jquery&&(d=d[0]);var h=function(a){if(a)g(a);else{var b=j.get(d);e.start?b.start(g):g(null,b)}};if(d.style.width=c(e.width),d.style.height=c(e.height),b.html5&&i){var k=f.createElement("video");k.style.width=c(e.width),k.style.height=c(e.height),a.jQuery?jQuery(d).empty():d.innerHTML="",d.appendChild(k),h()}else j.fallback(d,e,h)},j.fallback=function(a,b,c){c("not_support_camera")};var k=function(a){var c=a.nodeName?b.Image.toCanvas(a):a,d=b.Image(c);return d.type="image/png",d.width=c.width,d.height=c.height,d.size=c.width*c.height*4,d};j.Shot=k,b.Camera=j}(window,FileAPI),"function"==typeof define&&define.amd&&define("FileAPI",[],function(){return FileAPI});